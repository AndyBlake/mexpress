function pAdjust(a,b){var c;if("bh"===b){var d=a.length,e=[];for(c=d;c>0;c--)e.push(c);var f=[];for(c=0;d>c;c++)f[c]=[a[c],c];var g,h=nestedArraySort(f,!0,0);for(c=0;d>c;c++){var i=h[c][0]*d/e[c];0!==c?g>i?g=i:i=g:g=i,i>1&&(i=1),h[c][0]=i}for(h=nestedArraySort(h,!1,1),result=[],c=0;c<h.length;c++)result.push(h[c][0]);return result}}function pearsonCorrelation(a,b){var c;if(a.length!==b.length)return"failed";var d=[],e=[];for(c in b)isNaN(b[c])||isNaN(a[c])||(e.push(+b[c]),d.push(+a[c]));if(e.length>10){var f=e.length,g=0,h=0,i=0,j=0,k=0;for(c in e)g+=d[c],i+=Math.pow(d[c],2),h+=e[c],j+=Math.pow(e[c],2),k+=d[c]*e[c];var l=k-g*h/f,m=Math.sqrt(i-Math.pow(g,2)/f)*Math.sqrt(j-Math.pow(h,2)/f),n=l/m,o=e.length-2,p=Math.abs(n/Math.sqrt((1-Math.pow(n,2))/o)),q=tDistribution(o,p);return{r:n,p:q}}return"failed"}function mean(a){for(var b=a.length,c=0,d=0;b>d;d++)c+=a[d];var e=c/b;return e}function variance(a){for(var b=a.length,c=mean(a),d=0,e=0;b>e;e++)d+=Math.pow(a[e]-c,2);var f=d/b;return f}function degreesOfFreedom(a,b){var c=a.length,d=b.length,e=variance(a),f=variance(b),g=Math.pow(e/c+f/d,2),h=Math.pow(e/c,2)/(c-1)+Math.pow(f/d,2)/(d-1),i=g/h;return i}function tDistribution(a,b){var c=.049867347,d=.0211410061,e=.0032776263,f=380036e-10,g=488906e-10,h=5383e-9,i=b*(1-1/(4*a))/Math.sqrt(1+Math.pow(b,2)/(2*a)),j=2*(1/(2*Math.pow(1+c*i+d*Math.pow(i,2)+e*Math.pow(i,3)+f*Math.pow(i,4)+g*Math.pow(i,5)+h*Math.pow(i,6),16)));return j}function tTest(a,b){var c;for(c in a)isNaN(a[c])&&(a[c]=null);for(c in b)isNaN(b[c])&&(b[c]=null);if(a.some(function(a){return null!==a})){if(b.some(function(a){return null!==a})){var d=a.length,e=b.length;if(d>=3&&e>=3){var f=mean(a),g=mean(b),h=variance(a),i=variance(b),j=(f-g)/Math.sqrt(h/d+i/e);j=Math.abs(j);var k=degreesOfFreedom(a,b),l=tDistribution(k,j);return l}return"failed"}return"failed"}return"failed"}function nestedArraySort(a,b,c){return b?a.sort(function(a,b){return a=a[c],b=b[c],a===b?0:a>b?-1:1}):a.sort(function(a,b){return a=a[c],b=b[c],a===b?0:b>a?-1:1}),a}function wilcoxonRankSumTest(a,b){var c,d=[],e=[];for(c in a)a[c]&&"null"!==a[c]&&d.push(+a[c]);for(c in b)b[c]&&"null"!==b[c]&&e.push(+b[c]);var f=d.length,g=e.length;if(3>f||3>g)return"failed";var h=f*g/2,i=Math.sqrt(f*g*(f+g+1)/12),j=[];for(c in d)j.push([d[c],1]);for(c in e)j.push([e[c],2]);var k=nestedArraySort(j,!1,0),l=[],m=[];for(c in k)l.push(k[c][0]),m.push(k[c][1]);var n=[];for(c in k){var o=k[c][0],p=l.indexOf(o)+1;n.push(p)}var q=0,r=0;for(c in m){var s=m[c];1===s?q+=n[c]:r+=n[c]}var t=f*g+f*(f+1)/2-q,u=(t-h)/i;u=Math.abs(u);var v=u/Math.sqrt(2),w=1/(1+.5*v),x=w*Math.exp(-Math.pow(v,2)-1.26551223+1.00002368*w+.37409196*Math.pow(w,2)+.09678418*Math.pow(w,3)-.18628806*Math.pow(w,4)+.27886807*Math.pow(w,5)-1.13520398*Math.pow(w,6)+1.48851587*Math.pow(w,7)-.82215223*Math.pow(w,8)+.17087277*Math.pow(w,9)),y=1-x,z=2*(1-.5*(1+y));return z}function prepareSvgForDownload(a,b,c){$(".downloadButton").remove(),$(".downloadText").remove(),$(".plotInfo p").append("<div class='download'></div>"),$(".download").append("<div class='downloadButton png'>png</div>"),$(".download").append("<div class='downloadButton svg'>svg</div>"),$(".download").append("<div class='downloadText'>download a png or svg version of the figure</div>"),$(".downloadButton").css("visibility","visible").hide().fadeIn(1e3),$(".downloadButton").mouseenter(function(){$(".downloadText").css("visibility","visible").hide().fadeIn(100)}).mouseleave(function(){$(".downloadText").css("visibility","hidden")}),$(".downloadButton.png").click(function(){var d=d3.select("svg").attr("version",1.1).attr("xlmns","http://www.w3.org/2000/svg").node().parentNode.innerHTML;$(this).html("<img src='images/arrowLoader.gif'>"),downloadSvg(a,b,c,d,"png")}),$(".downloadButton.svg").click(function(){var d=d3.select("svg").attr("version",1.1).attr("xlmns","http://www.w3.org/2000/svg").node().parentNode.innerHTML;$(this).html("<img src='images/arrowLoader.gif'>"),downloadSvg(a,b,c,d,"svg")})}function createDownloadLink(a,b){var c=a.replace(/^.+\//,""),d=document.createElement("a");d["class"]="downloadLink",d.download=c,d.target="_blank",d.href=a,document.body.appendChild(d),d.click(),"png"===b?$(".downloadButton.png").html("png"):"svg"===b&&$(".downloadButton.svg").html("svg")}function downloadSvg(a,b,c,d,e){var f=encodeURIComponent(d),g=$(".containsProbeId").attr("id"),h="";if(void 0!==g){var h=g.replace(/^.+?_/,"");h=h.replace(/_.+$/,"")}$.ajax({data:"fileType="+e+"&gene="+a+"&source="+b+"&sorter="+c+"&probe="+h+"&svgHtml="+f,url:"php/svg2png.php",method:"POST",success:function(a){var b=a;b="php/"+b,createDownloadLink(b,e)}})}function removeMessages(){$(".errorMessage").length>0&&$(".errorMessage").remove(),$(".warningMessage").length>0&&$(".warningMessage").remove(),$(".infoMessage").length>0&&$(".infoMessage").remove()}function formatCorrelation(a,b){var c=a.toPrecision(3);return a>0&&(c="+"+c),c="r = "+c,.001>b?c+=" ***":.01>b?c+=" **":.05>b&&(c+=" *"),c}function numberOfLevels(a){var b=[];for(var c in a){var d=a[c];-1===$.inArray(d,b)&&null!==d&&void 0!==d&&b.push(d)}var e=b.length;return e}function sortData(a,b){var c,d,e,f,g,h,i=[],j=[],k=[];for(c in a.expressionData)j.push(c);var l=j;if("expressionData"===b){var m=[];for(c in a.expressionData){var n=a.expressionData[c];m.push({key:c,val:n})}m.sort(function(a,b){return b.val-a.val});for(d in m)i.push(m[d].key)}else if("sample type"===b){k=[];for(c in a.expressionData){var o=c.replace(/^.+_(\d\d)$/,"$1");k.push({key:c,val:o})}k.sort(function(a,b){return b.val-a.val});for(d in k)i.push(k[d].key)}else if("PAM50 subtype"===b){k=[];var p=[];for(e in j)c=j[e],c in a.pam50?k.push({key:c,val:a.pam50[c]}):p.push(c);k.sort(function(a,b){var c=a.val.toLowerCase(),d=b.val.toLowerCase();return d>c?-1:c>d?1:0});for(d in k)i.push(k[d].key);i=i.concat(p)}else{var q,r;for(f in a.annotation){q=a.annotation[f];break}for(e in a.slide){r=a.slide[e];break}var s,t,u;if(b in q){s="annotation",t=[],u=[];for(e in a[s])"numberOfAnnotationFields"!==e&&(g=a[s][e][b],void 0!==g&&null!==g?(g=+g,t.push({key:e,val:g})):u.push({key:e,val:g}));t.sort(function(a,b){return b.val-a.val}),t=t.concat(u);for(d in t){var v=t[d].key,w=RegExp(v);for(h=j.length-1;h>=0;h--){var x=j[h],y=x.match(w);if(null!==y){i.push(x);var z=$.inArray(x,l);l.splice(z,1)}}}i=i.concat(l)}else if(b in r){s="slide",t=[],u=[];for(e in a[s])"numberOfSlideFields"!==e&&(g=a[s][e][b],void 0!==g&&null!==g?(g=+g,t.push({key:e,val:g})):u.push({key:e,val:g}));t.sort(function(a,b){return b.val-a.val}),t=t.concat(u);for(d in t)for(c=t[d].key,h=j.length-1;h>=0;h--)j[h]===c&&(i.push(c),j.splice(h,1));i=i.concat(j)}}return i}function calculateStats(a,b,c,d,e,f,g,h,i){var j={};j.expressionData={},j["sample type"]={},j["PAM50 subtype"]={};var k,l;for(k in a.annotation){for(l in a.annotation[k])j[l]={};break}for(k in a.slide){for(l in a.slide[k])j[l]={};break}var m,n,o,p;for(m in j){var q={},r=[];if("expressionData"===m)q=a[m];else if(-1!==$.inArray(m,d))for(n in a.annotation)q[n]=a.annotation[n][m];else if(-1!==$.inArray(m,b))for(k in a.slide)q[k]=a.slide[k][m];else if("sample type"===m)for(o in c)k=c[o],p=k.replace(/^.+_(\d\d)$/,"$1"),"10"===p||"11"===p||"12"===p||"13"===p||"14"===p?q[k]="1":q[k]="0";else if("PAM50 subtype"===m)for(o in c)k=c[o],k in a.pam50?q[k]=a.pam50[k]:q[k]="no data";for(var s in q)r.push(q[s]);var t,u,v,w,x,y=numberOfLevels(r);if("expressionData"!==m)if(2===y){t=[],u=[];for(k in f)n=k.replace(/_\d\d$/,""),"no_annotation"!==e[n]&&(v="sample type"!==m?e[n][m]:q[k],"1"===v?t.push(f[k]):"0"===v&&u.push(f[k]));w=wilcoxonRankSumTest(t,u),j[m].expressionData={p:w}}else if(y>2&&"PAM50 subtype"!==m&&"eye_color"!==m&&"batch number"!==m){t=[],u=[];for(o in c)k=c[o],t.push(f[k]),-1!==$.inArray(m,d)?(n=k.replace(/_\d\d$/,""),u.push(q[n])):u.push(q[k]);w=pearsonCorrelation(t,u),j[m].expressionData={r:w.r,rp:w.p}}else j[m].expressionData={n:"no normals"};for(x in h)if(2===y){t=[],u=[];for(o in c)k=c[o],n=k.replace(/_\d\d$/,""),"no_annotation"!==e[n]&&(v="sample type"!==m?e[n][m]:q[k],"1"===v?t.push(g[k][h[x]]):"0"===v&&u.push(g[k][h[x]]));w=wilcoxonRankSumTest(t,u),j[m][h[x]]={p:w}}else if(y>2&&"PAM50 subtype"!==m&&"eye_color"!==m&&"batch number"!==m){t=[],u=[];for(o in c)k=c[o],t.push(g[k][h[x]]),-1!==$.inArray(m,d)?(n=k.replace(/_\d\d$/,""),u.push(q[n])):u.push(q[k]);w=pearsonCorrelation(t,u),j[m][h[x]]={r:w.r,rp:w.p}}else j[m][h[x]]={n:"failed"};var z,A;for(A in d)if(z=d[A],z!==m){var B=[];for(x in e)B.push(e[x][z]);var C=numberOfLevels(B);if(2===y)if(2===C)j[m][z]={n:"failed"};else if(C>2){t=[],u=[];for(o in c)k=c[o],n=k.replace(/_\d\d$/,""),"no_annotation"!==e[n]&&(v="sample type"!==m?e[n][m]:q[k],"1"===v?t.push(e[n][z]):"0"===v&&u.push(e[n][z]));w=wilcoxonRankSumTest(t,u),j[m][z]={p:w}}else j[m][z]={n:"failed"};else if(y>2&&"PAM50 subtype"!==m&&"eye_color"!==m&&"batch number"!==m)if(2===C){t=[],u=[];for(o in c)k=c[o],n=k.replace(/_\d\d$/,""),"no_annotation"!==e[n]&&(v=e[n][z],"1"===v?-1!==$.inArray(m,d)?q[n]&&t.push(q[n]):q[k]&&t.push(q[k]):"0"===v&&(-1!==$.inArray(m,d)?q[n]&&u.push(q[n]):q[k]&&u.push(q[k])));w=wilcoxonRankSumTest(t,u),j[m][z]={p:w}}else if(C>2){t=[],u=[];for(o in c)k=c[o],n=k.replace(/_\d\d$/,""),-1!==$.inArray(m,d)?q[n]&&(t.push(q[n]),u.push(e[n][z])):q[k]&&(t.push(q[k]),u.push(e[n][z]));w=pearsonCorrelation(t,u),j[m][z]={r:w.r,rp:w.p}}else j[m][z]={n:"failed"};else j[m][z]={n:"failed"}}for(o in b)if(z=b[o],z!==m)if(2===y){t=[],u=[];for(o in c)k=c[o],n=k.replace(/_\d\d$/,""),v="sample type"!==m?e[n][m]:q[k],"1"===v?t.push(i[k][z]):"0"===v&&u.push(i[k][z]);w=wilcoxonRankSumTest(t,u),j[m][z]={p:w}}else if(y>2&&"PAM50 subtype"!==m&&"eye_color"!==m&&"batch number"!==m){t=[],u=[];for(o in c)k=c[o],n=k.replace(/_\d\d$/,""),-1!==$.inArray(m,d)?q[n]&&(t.push(q[n]),u.push(i[k][z])):(t.push(q[k]),u.push(i[k][z]));w=pearsonCorrelation(t,u),j[m][z]={r:w.r,rp:w.p}}else j[m][z]={n:"failed"};if("sample type"!==m){var D={},E=[];for(o in c)k=c[o],p=k.replace(/^.+_(\d\d)$/,"$1"),"10"===p||"11"===p||"12"===p||"13"===p||"14"===p?(D[k]="1",E.push("1")):(D[k]="0",E.push("0"));var F=numberOfLevels(E);if(2===F){if(2===y)j[m]["sample type"]={n:"failed"};else if(y>2&&"PAM50 subtype"!==m&&"eye_color"!==m&&"batch number"!==m){t=[],u=[];for(o in c){k=c[o],n=k.replace(/_\d\d$/,"");var G=D[k];"1"===G?-1!==$.inArray(m,d)?q[n]&&t.push(q[n]):q[k]&&t.push(q[k]):"0"===G&&(-1!==$.inArray(m,d)?q[n]&&u.push(q[n]):q[k]&&u.push(q[k]))}w=wilcoxonRankSumTest(t,u),j[m]["sample type"]={p:w}}}else j[m]["sample type"]={n:"no normal samples"}}}return j}function drawLegend(a,b,c,d,e,f,g,h,j,k,l,m,n,o,p,q,r,s,t,u){var v,w;if(v=-c+1,w=-d+24,b.append("text").attr("x",v).attr("y",w).attr("font-weight","bold").text("annotation"),b.append("rect").attr("fill",e).attr("x",v).attr("y",w+8).attr("width",3).attr("height",12),b.append("text").attr("x",v+8).attr("y",w+18).text("gene"),b.append("rect").attr("fill",f).attr("x",v).attr("y",w+8+18).attr("width",3).attr("height",12),b.append("text").attr("x",v+8).attr("y",w+36).text("transcript"),b.append("rect").attr("fill",g).attr("x",v).attr("y",w+8+36).attr("width",3).attr("height",12),b.append("text").attr("x",v+8).attr("y",w+54).text("CpG island"),v+=90,b.append("text").attr("x",v).attr("y",w).attr("font-weight","bold").text("data"),b.append("rect").attr("fill",h).attr("x",v).attr("y",w+8).attr("width",3).attr("height",12),b.append("text").attr("x",v+8).attr("y",w+18).text("RNA-seq v2 (log2)"),b.append("rect").attr("fill",j).attr("x",v).attr("y",w+8+18).attr("width",3).attr("height",12),b.append("text").attr("x",v+8).attr("y",w+36).text(a.platform),b.append("rect").attr("fill",k).attr("x",v).attr("y",w+8+36).attr("width",3).attr("height",12),b.append("text").attr("x",v+8).attr("y",w+54).text("slide/clinical data"),b.append("rect").attr("fill",l).attr("x",v).attr("y",w+8+54).attr("width",3).attr("height",12),b.append("text").attr("x",v+8).attr("y",w+72).text("missing data"),v+=120,m&&(b.append("text").attr("x",v).attr("y",w).attr("font-weight","bold").text("gender"),b.append("rect").attr("fill",n).attr("x",v).attr("y",w+8).attr("width",3).attr("height",12),b.append("text").attr("x",v+8).attr("y",w+18).text("female"),b.append("rect").attr("fill",o).attr("x",v).attr("y",w+8+18).attr("width",3).attr("height",12),b.append("text").attr("x",v+8).attr("y",w+36).text("male"),v+=70),b.append("text").attr("x",v).attr("y",w).attr("font-weight","bold").text("statistics"),b.append("text").attr("x",v).attr("y",w+18).attr("font-size","14px").attr("font-family",p).text("p"),b.append("text").attr("x",v+16).attr("y",w+18).text("Wilcoxon rank-sum test"),b.append("text").attr("x",v+16).attr("y",w+18+14).attr("font-weight","bold").attr("font-size","11px").attr("font-family",p).text("p < 0.05"),b.append("text").attr("x",v+16+72).attr("y",w+18+14).attr("fill","#aaa").attr("font-size","11px").attr("font-family",p).text("p ≥ 0.05"),b.append("text").attr("x",v).attr("y",w+54).attr("font-size","14px").attr("font-family",p).text("r"),b.append("text").attr("x",v+16).attr("y",w+54).text("Pearson correlation"),b.append("text").attr("x",v+16).attr("y",w+54+14).attr("font-weight","bold").attr("font-size","11px").attr("font-family",p).text("***"),b.append("text").attr("x",v+16+32).attr("y",w+54+14).attr("font-weight","bold").attr("font-size","11px").attr("font-family",p).text("p < 0.001"),b.append("text").attr("x",v+16).attr("y",w+54+28).attr("font-weight","bold").attr("font-size","11px").attr("font-family",p).text("**"),b.append("text").attr("x",v+16+32).attr("y",w+54+28).attr("font-weight","bold").attr("font-size","11px").attr("font-family",p).text("p < 0.01"),b.append("text").attr("x",v+16).attr("y",w+54+42).attr("font-weight","bold").attr("font-size","11px").attr("font-family",p).text("*"),b.append("text").attr("x",v+16+32).attr("y",w+54+42).attr("font-weight","bold").attr("font-size","11px").attr("font-family",p).text("p < 0.05"),b.append("text").attr("x",v+16+32).attr("y",w+54+56).attr("fill","#aaa").attr("font-size","11px").attr("font-family",p).text("p ≥ 0.05"),v+=160,"BRCA breast invasive carcinoma"===q){b.append("text").attr("x",v).attr("y",w).attr("font-weight","bold").text("BRCA subtype"),i=0;for(var x in r)"no data"!==x&&(b.append("rect").attr("fill",r[x]).attr("x",v).attr("y",w+8+18*i).attr("width",3).attr("height",12),b.append("text").attr("x",v+8).attr("y",w+18*(i+1)).text(x),i++);v+=106}b.append("text").attr("x",v).attr("y",w).attr("font-weight","bold").text("sample type");var y=0;for(var z in s){var A=s[z],B=t[A];B.length>26&&(B=B.substring(0,23),B+="..."),b.append("rect").attr("fill",u[A]).attr("x",v).attr("y",w+8+18*y).attr("width",3).attr("height",12),b.append("text").attr("x",v+8).attr("y",w+18*(y+1)).text(B+" ("+A+")"),y++}}function updatePlot(a,b,c,d,e){$(".plotInfo").empty(),$(".plotWindow").empty(),createPlot(a,b,c,d,e)}function createPlot(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K=$(window).width(),L=$(".userInput").outerWidth(),M=K-L-28,N=18,O=14,P=4,Q=3,R=2,S="11px",T="Courier New",U="#f59322",V="#4bc722",W="#ffedc2",X="#ffc842",Y="#999",Z="#acd2f2",_="#1a70ba",aa="#f9f9f9",ba="#ffd57a",ca="#f59322",da="#ffd161",ea="#aad5fa",fa="#4999de",ga="#63aceb",ha="#14568f",ia="#b6d3f2",ja="#dce1e6",ka="#c5ccd4",la="#fa89ca",ma="#f272bb",na="#98d3fa",oa="#7fc3f0",pa="#98d3fa",qa="#4999de",ra="#944e07",sa="#693705",ta="#73cc5b",ua="#37ac19",va={Normal:"#4999de",Basal:"#ffc03b",Her2:"#ff983b",LumA:"#73cc5b",LumB:"#37ac19","no data":aa},wa={"01":"primary solid tumor","02":"recurrent solid tumor","03":"primary blood derived cancer - peripheral blood","04":"recurrent blood derived cancer - bone marrow","05":"additional - new primary","06":"metastatic","07":"additional metastatic","08":"human tumor original cells","09":"primary blood derived cancer - bone marrow",10:"blood derived normal",11:"solid tissue normal",12:"buccal cell normal",13:"EBV immortalized normal",14:"bone marrow normal",20:"control analyte",40:"recurrent blood derived cancer - peripheral blood",50:"cell lines",60:"primary xenograft tissue",61:"cell line derived xenograft tissue"},xa={"01":"#98d3fa","02":"#f7a972","03":"#f2766f","04":"#db7346","05":"#3fd19b","06":"#ffd161","07":"#d13f75","08":"#6ff0f2","09":"#f29b6f",10:"#9dc9f5",11:"#4999de",12:"#4198f0",13:"#0f73d6",14:"#90d8f5",20:"#46bff0",40:"#db4e46",50:"#f07746",60:"#a17fad",61:"#8a38a8"},ya=a.numberOfProbes,za=a.geneInfo,Aa=+za.start,Ba=+za.end,Ca=za.strand,Da=a.transcripts,Ea=a.cpgi,Fa=0,Ga=!1,Ha={},Ia=[];n=+a.annotation.numberOfAnnotationFields,n>Fa&&(Fa=n);for(D in a.annotation)for(g in a.annotation[D])-1===$.inArray(g,Ia)&&Ia.push(g),"gender"===g&&(Ga=!0),i=parseFloat(a.annotation[D][g]),isNaN(i)?Ha.hasOwnProperty(g)||(Ha[g]=0):Ha.hasOwnProperty(g)?i>Ha[g]&&(Ha[g]=i):Ha[g]=i;Fa++;var Ja=0,Ka=[];if("no_data"!==a.slide){n=+a.slide.numberOfSlideFields,n>Ja&&(Ja=n);for(D in a.slide)if("numberOfSlideFields"!==D){for(q in a.slide[D])Ka.push(q);break}}Fa+=Ja,"BRCA breast invasive carcinoma"===c&&Fa++;var La=0;for(D in a.expressionData)expr=+a.expressionData[D],expr>La&&(La=expr);var Ma=sortData(a,e),Na=[],Oa=[],Pa=[],Qa=[],Ra=[];for(D in a.methylationData){for(y in a.methylationData[D])Ra.push(y);break}var Sa={};for(y in Ra)Sa[Ra[y]]=[];var Ta=[];for(C in Ma)if(D=Ma[C],a.methylationData[D]){Ta.push(D),Na[D]=a.methylationData[D];for(y in Ra)Sa[Ra[y]].push(a.methylationData[D][Ra[y]]);w=D.replace(/_\d\d$/,""),a.annotation[w]?Pa[w]=a.annotation[w]:Pa[w]="no_annotation",a.slide[D]?Qa[D]=a.slide[D]:Qa[D]="no_data",r=a.expressionData[D],Oa[D]=r}var Ua=calculateStats(a,Ka,Ta,Ia,Pa,Oa,Na,Ra,Qa),Va=[],Wa=[];for(o in Ua[e])p=Ua[e][o],p.rp&&"failed"!==p.rp?(Va.push(p.rp),Wa.push(o)):p.p&&"failed"!==p.p&&(Va.push(p.p),Wa.push(o));var Xa=pAdjust(Va,"bh");for(u=0;u<Xa.length;u++){var Ya=Xa[u];Ya=+Ya.toPrecision(3);var Za=1e3*Ya;1>Za&&(Ya=Ya.toExponential()),p=Wa[u],Ua[e][p].rp?Ua[e][p].rp=Ya:Ua[e][p].p&&(Ua[e][p].p=Ya)}Cb=0;var $a;for($a in Da)Da.hasOwnProperty($a)&&Cb++;Ab=0;for($a in Ea)Ea.hasOwnProperty($a)&&Ab++;var _a=8+4*Cb;Ab>0&&(_a+=5);var ab=Math.abs(Aa-Ba),bb=148,cb=[];if("no_annotation"!==a.annotation)for(C in Ta)D=Ta[C],k=D.replace(/^.+_(\d\d)$/,"$1"),-1===$.inArray(k,cb)&&cb.push(k);cb.length>7&&(bb=148+18*cb.length);var db,eb=10+La/20*N*3+10+(O+1)*Fa+20+bb,fb=170+_a,gb=110,hb={top:eb,left:fb,bottom:40,right:gb},ib=M-fb-gb,jb=600;Ga&&(jb=750),jb>ib&&(ib=jb),db=10>ya?10*N:ab>1e5&&40>ya?40*N:ya*N;var kb=Math.floor(ib/d);1>kb?kb=1:kb>6&&(kb=6),ib=kb*d;var lb=d3.scale.linear().range([0,ib]),mb=d3.scale.linear().range([db,0]),nb=(d3.svg.axis().scale(lb).orient("top"),d3.svg.line().defined(function(a){return null!==a}).x(function(a,b){return lb(b)+kb/2}).y(function(a){return a}));$(".plotWindow").removeClass("hidden");var ob=d3.select(".plotWindow").append("svg").attr("width",ib+hb.left+hb.right).attr("height",db+hb.top+hb.bottom).attr("text-rendering","geometricPrecision").attr("font-family","arial").attr("font-size","12px").attr("fill","#666").append("g").attr("transform","translate("+hb.left+","+hb.top+")");lb.domain([0,d]),mb.domain([0,ya]);var pb=1e3;ab/10>1e3&&(pb=ab/10),pb>5e3&&(pb=5e3);var qb,rb,sb=Aa-pb,tb=Ba+pb,ub=(tb-sb)/ya,vb=(Aa-sb)/ub,wb=(Ba-sb)/ub;"1"===Ca?(qb=Aa-1e3,rb=Aa+500):(qb=Ba-500,rb=Ba+1e3),drawLegend(a,ob,fb,eb,U,W,V,ba,ea,ja,aa,Ga,la,na,T,c,va,cb,wa,xa);var xb,yb;for(D in a.methylationData){yb=0;for(y in a.methylationData[D]){yb++,xb="",y>=qb&&rb>=y&&(xb="prom");var zb=(y-sb)/ub;ob.append("line").attr("x1",-fb).attr("x2",-fb+_a+80).attr("y1",db-mb(zb)).attr("y2",db-mb(zb)).attr("stroke",Z).attr("stroke-opacity",.5).attr("stroke-width",1).attr("class",xb).attr("id","annotationLine"+y),ob.append("line").attr("x1",-fb+_a+80).attr("x2",lb(1)).attr("y1",db-mb(zb)).attr("y2",db-mb(yb-1)+N/2).attr("stroke",Z).attr("stroke-opacity",.5).attr("stroke-width",1).attr("class",xb)}break}ob.append("rect").attr("fill",U).attr("x",-fb+7).attr("y",db-mb(vb)).attr("width",P).attr("height",mb(ya-(wb-vb))),"1"===Ca?(ob.append("line").attr("x1",-fb+4).attr("x2",-fb+9).attr("y1",mb(ya-(wb-vb))+db-mb(vb)-7).attr("y2",mb(ya-(wb-vb))+db-mb(vb)).style("stroke",U).attr("stroke-width",P-1).attr("stroke-linecap","round"),ob.append("line").attr("x1",-fb+9).attr("x2",-fb+14).attr("y1",mb(ya-(wb-vb))+db-mb(vb)).attr("y2",mb(ya-(wb-vb))+db-mb(vb)-7).style("stroke",U).attr("stroke-width",P-1).attr("stroke-linecap","round")):(ob.append("line").attr("x1",-fb+4).attr("x2",-fb+9).attr("y1",db-mb(vb)+7).attr("y2",db-mb(vb)).style("stroke",U).attr("stroke-width",P-1).attr("stroke-linecap","round"),ob.append("line").attr("x1",-fb+9).attr("x2",-fb+14).attr("y1",db-mb(vb)).attr("y2",db-mb(vb)+7).style("stroke",U).attr("stroke-width",P-1).attr("stroke-linecap","round"));var Ab=0;for(var Bb in Ea)Ab++,cStart=Ea[Bb].start,cEnd=Ea[Bb].end,cStart<sb&&(cStart=sb),cEnd>tb&&(cEnd=tb),cStartPlot=(cStart-sb)/ub,cEndPlot=(cEnd-sb)/ub,ob.append("rect").attr("fill",V).attr("x",-fb+18).attr("y",db-mb(cStartPlot)).attr("width",Q).attr("height",mb(ya-(cEndPlot-cStartPlot)));var Cb=0;for(var Db in Da){Cb++;var Eb=+Da[Db].start,Fb=+Da[Db].end,Gb=(Eb-sb)/ub,Hb=(Fb-sb)/ub;ob.append("rect").attr("fill",W).attr("x",-fb+22+6*Cb).attr("y",db-mb(Gb)).attr("width",R).attr("height",mb(ya-(Hb-Gb))).html("<title>"+Db+"</title");var Ib=a.transcripts[Db].exons;for(o in Ib){var Jb=+Ib[o].start,Kb=+Ib[o].end;eStartPlot=(Jb-sb)/ub,eEndPlot=(Kb-sb)/ub,ob.append("rect").attr("fill",X).attr("x",-fb+22+6*Cb).attr("y",db-mb(eStartPlot)).attr("width",R).attr("height",mb(ya-(eEndPlot-eStartPlot)))}}var Lb=Math.round(Math.log(ab)/Math.log(10)),Mb=Math.pow(10,Lb-1);1e3>Mb&&5e3>ab&&(Mb=1e3);var Nb,Ob;"1"===Ca?(Nb=Aa-Mb/2,Ob=Aa+Mb/2):(Nb=Ba-Mb/2,Ob=Ba+Mb/2);var Pb=(Nb-sb)/ub,Qb=(Ob-sb)/ub;ob.append("rect").attr("fill",Y).attr("x",-fb+2).attr("y",db-mb(Pb)).attr("width",2).attr("id","scaleBar").attr("height",mb(ya-(Qb-Pb)));var Rb=Mb/1e3;Rb+="kb";var Sb;Sb="1"==Ca?mb(Pb)+2:mb(Qb)-10,ob.append("text").attr("x",-fb+1).attr("y",db-Sb).attr("font-size","9px").attr("fill",Y).text(Rb);var Tb=[];for(C in Ta)D=Ta[C],r=Oa[D],Tb.push(db-mb(0)-r/20*N*3-10);var Ub=0;100>d?Ub=2:200>d&&(Ub=1);var Vb=d3.svg.area().defined(function(a){return a}).x(function(a,b){return lb(b)+Ub}).y1(function(a){return a}).y0(db-mb(0)-10);ob.append("path").attr("d",Vb(Tb)).attr("fill",ba),ob.append("line").attr("x1",lb(1)).attr("x2",lb(d)).attr("y1",db-mb(0)-La/20*N*3-10).attr("y2",db-mb(0)-La/20*N*3-10).style("stroke",da).attr("stroke-width",1).attr("shape-rendering","crispEdges").attr("stroke-dasharray","5,5"),ob.append("path").attr("d",nb(Tb)).style("stroke",ca).attr("stroke-width",1).attr("fill","none"),ob.append("text").attr("x",-4).attr("y",db-mb(0)-10-La/20*N).attr("class","clickable").attr("id","expressionData").attr("text-anchor","end").attr("font-size","12px").attr("fill","#aaa").text("expression").on("mouseup",function(){"expressionData"!==e&&updatePlot(a,b,c,d,"expressionData")});var Wb=0;for(y in Sa){Wb++;var Xb=Sa[y],Yb=[];for(C in Xb){var Zb=Xb[C];if(isNaN(Zb))Yb.push(null);else{var $b=db-mb(Wb-1)+(1-Zb)*N;Yb.push($b)}}if(xb="",y>=qb&&rb>=y&&(xb="prom"),Yb.some(function(a){return null!==a})){var _b=d3.svg.area().defined(function(a){return a}).x(function(a,b){return lb(b)+Ub}).y1(function(a){return a}).y0(db-mb(Wb-1)+N);ob.append("path").attr("d",_b(Yb)).attr("class",xb).attr("fill",ea),ob.append("path").attr("d",nb(Yb)).attr("stroke",fa).attr("class",xb+" line").attr("stroke-width",1).attr("fill","none")}else ob.append("text").attr("x",4).attr("y",db-mb(Wb-1)+.75*N).attr("text-anchor","start").attr("font-size","9px").attr("class",xb).attr("fill",ia).text("no data")}var ac=[];for(C in Ta)if(D=Ta[C],yb=0,Na[D]){for(y in Na[D]){yb++,ac.push(y);var bc=a.probeIds[y];ob.append("rect").attr("fill","#fff").attr("fill-opacity",0).attr("x",lb(0)).attr("y",db-mb(yb-1)).attr("width",kb*d).attr("height",N).attr("id",y+"_"+bc+"_"+yb).attr("class","clickable").on("mouseover",function(){var a=$(this).attr("id"),b=a.replace(/_.+$/,""),c=a.replace(/^.+?_/,"");c=c.replace(/_.+$/,"");var d=(b-sb)/ub;ob.append("text").attr("x",-74).attr("y",db-mb(d)-6).attr("text-anchor","end").attr("class","probeId").attr("font-size","11px").attr("stroke","#fff").attr("stroke-width",4).text(c),ob.append("text").attr("x",-74).attr("y",db-mb(d)-6).attr("text-anchor","end").attr("class","probeId").attr("font-size","11px").attr("fill",fa).text(c),ob.append("line").attr("x1",-fb).attr("x2",-fb+_a+80).attr("y1",db-mb(d)).attr("y2",db-mb(d)).style("stroke",fa).attr("stroke-width",2).attr("class","focusLine")}).on("mouseout",function(){$(".focusLine").remove(),$(".probeId").remove()}).on("mouseup",function(){var b=$(this).attr("id"),c=$(".probeIdClicked").attr("id");if($(".focusLineClicked").remove(),$(".probeIdClicked").remove(),$(".probeInfo").remove(),c!==b){var d=a.geneInfo.chr,e=b.replace(/_.+$/,""),f=b.replace(/^.+?_/,"");f=f.replace(/_.+$/,"");var g=b.replace(/^.+_/,""),h=(e-sb)/ub;ob.append("text").attr("x",-74).attr("y",db-mb(h)-6).attr("text-anchor","end").attr("class","probeIdClicked containsProbeId").attr("id",b).attr("font-size","11px").attr("stroke","#fff").attr("stroke-width",4).text(f),ob.append("text").attr("x",-74).attr("y",db-mb(h)-6).attr("text-anchor","end").attr("class","probeIdClicked clickable").attr("font-size","11px").attr("fill",fa).text(f).on("mouseup",function(){var b=a.probeAnnotation[e];b=b.replace(/-/g," ± ");var c=140;b.length>20&&(c=180),ob.append("rect").attr("x",-142).attr("y",db-mb(h)-24).attr("width",c).attr("height",66).attr("fill","#fff").attr("stroke",fa).attr("stroke-width",2).attr("class","probeInfo clickable").on("mouseup",function(){$(".probeInfo").remove()}),ob.append("text").attr("x",-136).attr("y",db-mb(h)-6).attr("class","probeInfo").attr("font-weight","bold").text(f),ob.append("text").attr("x",-136).attr("y",db-mb(h)+14).attr("class","probeInfo").text("chr"+d+":"+e),ob.append("text").attr("x",-136).attr("y",db-mb(h)+30).attr("class","probeInfo").text(b),ob.append("text").attr("x",-142+c-20).attr("y",db-mb(h)-4).attr("class","probeInfo clickable").attr("font-size","18px").attr("font-weight","bold").attr("fill",fa).text("×").on("mouseup",function(){$(".probeInfo").remove()})}),ob.append("line").attr("x1",-fb).attr("x2",-fb+_a+80).attr("y1",db-mb(h)).attr("y2",db-mb(h)).style("stroke",fa).attr("stroke-width",2).attr("class","focusLineClicked"),ob.append("line").attr("x1",-fb+_a+80).attr("x2",lb(1)).attr("y1",db-mb(h)).attr("y2",db-mb(g-1)+N/2).style("stroke",fa).attr("stroke-width",2).attr("class","focusLineClicked")}})}break}if(yb=0,"expressionData"===e)for(y in ac)yb++,J=Ua[e][ac[y]],J.r&&(z=J.r,"failed"!==z&&(v=parseFloat(J.rp),B=formatCorrelation(z,v),l="#aaa",m="normal",.05>v&&(l="#666",m="bold"),ob.append("text").attr("x",lb(d)+4*kb).attr("y",db-mb(yb-1)+N-4).attr("font-size",S).attr("font-weight",m).attr("font-family",T).attr("fill",l).text(B)));else for(y in ac)yb++,J=Ua[e][ac[y]],J.p||0===J.p?(v=J.p,"failed"!==v&&(F="#aaa",G="normal",x=parseFloat(v),.05>x&&(F="#666",G="bold"),v=x<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+v,ob.append("text").attr("x",lb(d)+4*kb).attr("y",db-mb(yb-1)+N-4).attr("font-size",S).attr("font-weight",G).attr("font-family",T).attr("fill",F).text(v))):J.r&&(z=J.r,"failed"!==z&&(v=parseFloat(J.rp),B=formatCorrelation(z,v),l="#aaa",m="normal",.05>v&&(l="#666",m="bold"),ob.append("text").attr("x",lb(d)+4*kb).attr("y",db-mb(yb-1)+N-4).attr("font-size",S).attr("font-weight",m).attr("font-family",T).attr("fill",l).text(B)));if("no_annotation"!==a.annotation){E=0;for(C in Ta){D=Ta[C],w=D.replace(/_\d\d$/,"");var cc;cc=E%2===0?ja:ka,k=D.replace(/^.+_(\d\d)$/,"$1");var dc=(wa[k],xa[k]);if(h=1,ob.append("rect").attr("fill",dc).attr("x",lb(E)).attr("y",db-mb(0)-10-La/20*N*3-10-(O+1)*h).attr("width",kb).attr("height",O),"BRCA breast invasive carcinoma"===c){h++;var ec;ec=D in a.pam50?a.pam50[D]:"no data";var fc=va[ec];ob.append("rect").attr("fill",fc).attr("x",lb(E)).attr("y",db-mb(0)-10-La/20*N*3-10-(O+1)*h).attr("width",kb).attr("height",O)}if("no_annotation"!==Pa[w])for(g in Pa[w]){i=Pa[w][g];var gc;"gender"===g&&(gc=1==i?E%2===0?la:ma:E%2===0?na:oa);var hc;"eye_color"===g&&(hc=1==i?E%2===0?pa:qa:2==i?E%2===0?ra:sa:E%2===0?ta:ua);var ic=Ha[g];h++,null===i?ob.append("rect").attr("fill",aa).attr("x",lb(E)).attr("y",db-mb(0)-10-La/20*N*3-10-(O+1)*h).attr("width",kb).attr("height",O):"gender"===g?(A=O,yPos=db-mb(0)-10-La/20*N*3-10-(O+1)*h+(O-A),ob.append("rect").attr("fill",gc).attr("x",lb(E)).attr("y",yPos).attr("width",kb).attr("height",A)):"eye_color"===g?(A=O,yPos=db-mb(0)-10-La/20*N*3-10-(O+1)*h+(O-A),ob.append("rect").attr("fill",hc).attr("x",lb(E)).attr("y",yPos).attr("width",kb).attr("height",A)):(A=O/ic*i,yPos=db-mb(0)-10-La/20*N*3-10-(O+1)*h+(O-A),ob.append("rect").attr("fill",cc).attr("x",lb(E)).attr("y",yPos).attr("width",kb).attr("height",A))}else ob.append("rect").attr("fill",aa).attr("x",lb(E)).attr("y",db-mb(0)-10-La/20*N*3-10-(O+1)*(Fa-Ja)).attr("width",kb).attr("height",(O+1)*(Fa-1-Ja)-1);E++}if("expressionData"===e){h=0,J=Ua[e]["sample type"],(J.p||0===J.p)&&(v=J.p,"failed"!==v&&(F="#aaa",G="normal",x=parseFloat(v),.05>x&&(F="#666",G="bold"),v=x<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+v,ob.append("text").attr("x",lb(d)+4*kb).attr("y",db-mb(0)-10-La/20*N*3-10-(O+1)*h-4).attr("font-size",S).attr("font-weight",G).attr("font-family",T).attr("fill",F).text(v))),"BRCA breast invasive carcinoma"===c&&h++;for(g in Ha)h++,J=Ua[e][g],J.p||0===J.p?(v=J.p,"failed"!==v&&(F="#aaa",G="normal",x=parseFloat(v),.05>x&&(F="#666",G="bold"),v=x<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+v,ob.append("text").attr("x",lb(d)+4*kb).attr("y",db-mb(0)-10-La/20*N*3-10-(O+1)*h-4).attr("font-size",S).attr("font-weight",G).attr("font-family",T).attr("fill",F).text(v))):J.r&&(z=J.r,"failed"!==z&&(v=parseFloat(J.rp),B=formatCorrelation(z,v),l="#aaa",m="normal",.05>v&&(l="#666",m="bold"),ob.append("text").attr("x",lb(d)+4*kb).attr("y",db-mb(0)-10-La/20*N*3-10-(O+1)*h-4).attr("font-size",S).attr("font-weight",m).attr("font-family",T).attr("fill",l).text(B)));I=Fa-Ja;for(s in Ka)t=Ka[s],J=Ua.expressionData[t],J.r&&(z=J.r,"failed"!==z&&(v=parseFloat(J.rp),B=formatCorrelation(z,v),l="#aaa",m="normal",.05>v&&(l="#666",m="bold"),ob.append("text").attr("x",lb(E)+4*kb).attr("y",db-mb(0)-10-La/20*N*3-10-(O+1)*I-4).attr("class",t).attr("font-size",S).attr("font-weight",m).attr("font-family",T).attr("fill",l).text(B))),I++}else if("sample type"===e){J=Ua[e].expressionData,J.n?(j=J.n,ob.append("text").attr("x",lb(d)+4*kb).attr("y",db-mb(0)-10-La/20*N).attr("font-size",S).attr("font-family",T).attr("fill","#aaa").text(j)):(J.p||0===J.p)&&(v=J.p,"failed"!==v&&(F="#aaa",G="normal",x=parseFloat(v),.05>x&&(F="#666",G="bold"),v=x<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+v,ob.append("text").attr("x",lb(d)+4*kb).attr("y",db-mb(0)-10-La/20*N).attr("font-size",S).attr("font-weight",G).attr("font-family",T).attr("fill",F).text(v))),yb=0;for(y in ac)yb++,J=Ua[e][ac[y]],(J.p||0===J.p)&&(v=J.p,"failed"!==v&&(F="#aaa",G="normal",x=parseFloat(v),.05>x&&(F="#666",G="bold"),v=x<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+v,ob.append("text").attr("x",lb(d)+4*kb).attr("y",db-mb(yb-1)+N-4).attr("font-size",S).attr("font-weight",G).attr("font-family",T).attr("fill",F).text(v)))}else J=Ua[e].expressionData,J.p||0===J.p?(v=J.p,"failed"!==v&&(F="#aaa",G="normal",x=parseFloat(v),.05>x&&(F="#666",G="bold"),v=x<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+v,ob.append("text").attr("x",lb(d)+4*kb).attr("y",db-mb(0)-10-La/20*N).attr("font-size",S).attr("font-weight",G).attr("font-family",T).attr("fill",F).text(v))):J.r&&(z=J.r,"failed"!==z&&(v=parseFloat(J.rp),B=formatCorrelation(z,v),l="#aaa",m="normal",.05>v&&(l="#666",m="bold"),ob.append("text").attr("x",lb(d)+4*kb).attr("y",db-mb(0)-10-La/20*N).attr("font-size",S).attr("font-weight",m).attr("font-family",T).attr("fill",l).text(B)));h=0,ob.append("text").attr("x",-4).attr("y",db-mb(0)-10-La/20*N*3-10-(N+1)*h-4).attr("class","clickable").attr("font-size","12px").attr("fill","#aaa").attr("id","sample type").attr("text-anchor","end").text("sample type").on("mouseup",function(){
var f=$(this).text();f=f.replace(/\u2192 /,""),f!==e&&updatePlot(a,b,c,d,f)}),"BRCA breast invasive carcinoma"===c&&(h++,ob.append("text").attr("x",-4).attr("y",db-mb(0)-10-La/20*N*3-10-(N+1)*h).attr("class","clickable").attr("font-size","12px").attr("fill","#aaa").attr("id","PAM50 subtype").attr("text-anchor","end").text("PAM50 subtype").on("mouseup",function(){var f=$(this).text();f=f.replace(/\u2192 /,""),f!==e&&updatePlot(a,b,c,d,f)}));for(g in Ha)h++,g=g.replace(/_/g," "),ob.append("text").attr("x",-4).attr("y",db-mb(0)-10-La/20*N*3-10-(O+1)*h-4).attr("class","clickable").attr("font-size","12px").attr("fill","#aaa").attr("id",g.replace(/ /g,"_")).attr("text-anchor","end").text(g).on("mouseup",function(){var f=$(this).text();f=f.replace(/ /g,"_"),f=f.replace(/\u2192_/,""),f!==e&&updatePlot(a,b,c,d,f)}),f=g.replace(/ /g,"_"),f!==e&&"expressionData"!==e&&(J=Ua[e][f],J.p||0===J.p?(v=J.p,"failed"!==v&&(F="#aaa",G="normal",x=parseFloat(v),.05>x&&(F="#666",G="bold"),v=x<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+v,ob.append("text").attr("x",lb(d)+4*kb).attr("y",db-mb(0)-10-La/20*N*3-10-(O+1)*h-4).attr("font-size",S).attr("font-weight",G).attr("font-family",T).attr("fill",F).text(v))):J.r&&(z=J.r,"failed"!==z&&(v=parseFloat(J.rp),B=formatCorrelation(z,v),l="#aaa",m="normal",.05>v&&(l="#666",m="bold"),ob.append("text").attr("x",lb(d)+4*kb).attr("y",db-mb(0)-10-La/20*N*3-10-(O+1)*h-4).attr("font-size",S).attr("font-weight",m).attr("font-family",T).attr("fill",l).text(B))))}if("no_data"!==a.slide){E=0;a.slide.numberOfSlideFields;Ka=[];for(C in Ta)if(D=Ta[C],"no_data"!==Qa[D]){for(H in Qa[D])-1===$.inArray(H,Ka)&&Ka.push(H);break}for(C in Ta){if(D=Ta[C],"no_data"!==Qa[D]){var jc;jc=E%2===0?ja:ka,I=Fa-Ja;for(H in Qa[D])I++,slideFieldValue=Qa[D][H],"undefined"!=typeof Qa[D][H]&&(A=O/100*slideFieldValue,yPos=db-mb(0)-10-La/20*N*3-10-(O+1)*I+(O-A),ob.append("rect").attr("fill",jc).attr("x",lb(E)).attr("y",yPos).attr("width",kb).attr("height",A).attr("class",H))}else{I=Fa-Ja;for(s in Ka)I++,ob.append("rect").attr("fill",aa).attr("x",lb(E)).attr("y",db-mb(0)-10-La/20*N*3-10-(O+1)*I-1).attr("width",kb).attr("height",O+1).attr("class",Ka[s])}E++}I=Fa-Ja;for(s in Ka)t=Ka[s],g=t.replace(/_/g," "),ob.append("text").attr("x",-4).attr("y",db-mb(0)-10-La/20*N*3-10-(O+1)*I-4).attr("class",t+" clickable").attr("font-size","12px").attr("fill","#aaa").attr("id",t).attr("text-anchor","end").text(g).on("mouseup",function(){var f=$(this).text();f=f.replace(/ /g,"_"),f=f.replace(/\u2192_/,""),f!==e&&updatePlot(a,b,c,d,f)});I=Fa-Ja;for(s in Ka)t=Ka[s],t!==e&&"expressionData"!==e&&(J=Ua[e][t],J.r?(z=J.r,"failed"!==z&&(v=parseFloat(J.rp),B=formatCorrelation(z,v),l="#aaa",m="normal",.05>v&&(l="#666",m="bold"),ob.append("text").attr("x",lb(E)+4*kb).attr("y",db-mb(0)-10-La/20*N*3-10-(O+1)*I-4).attr("class",t).attr("font-size",S).attr("font-weight",m).attr("font-family",T).attr("fill",l).text(B))):(J.p||0===J.p)&&(v=J.p,"failed"!==v&&(F="#aaa",G="normal",x=parseFloat(v),.05>x&&(F="#666",G="bold"),v=x<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+v,ob.append("text").attr("x",lb(d)+4*kb).attr("y",db-mb(0)-10-La/20*N*3-10-(O+1)*I-4).attr("class",t).attr("font-size",S).attr("font-weight",G).attr("font-family",T).attr("fill",F).text(v)))),I++}document.getElementById(e).setAttribute("font-weight","bold"),document.getElementById(e).setAttribute("font-size","13px"),document.getElementById(e).setAttribute("fill","rgb(100,100,100)");var kc=e.replace(/_/g," ");kc=kc.replace(/Data/,"");var lc=document.getElementById(e).firstChild;lc.nodeValue="► "+kc,ob.append("text").attr("x",ib+gb-12).attr("y",db-mb(0)-10-La/20*N*3-10-(O+1)*Fa-14).attr("font-size",S).attr("font-family",T).attr("text-anchor","end").attr("fill","#aaa").text("comparison to: "+kc),ob.append("line").attr("x1",ib+gb-12).attr("x2",ib+gb-12-6.6*kc.length).attr("y1",db-mb(0)-10-La/20*N*3-10-(O+1)*Fa-10).attr("y2",db-mb(0)-10-La/20*N*3-10-(O+1)*Fa-10).style("stroke","#aaa").attr("stroke-width",1).attr("shape-rendering","crispEdges");var mc=a.geneInfo.ensembl,nc=a.geneInfo.hgnc,oc=a.geneInfo.chr,pc=a.geneInfo.start;pc=pc.toString();for(var qc="";pc.length>=3;)qc=pc.substring(pc.length-3)+","+qc,pc=pc.substring(0,pc.length-3);qc=pc+","+qc,qc=qc.replace(/,$/,""),qc=qc.replace(/^,/,"");var rc=a.geneInfo.end;rc=rc.toString();for(var sc="";rc.length>=3;)sc=rc.substring(rc.length-3)+","+sc,rc=rc.substring(0,rc.length-3);sc=rc+","+sc,sc=sc.replace(/,$/,""),sc=sc.replace(/^,/,"");var tc="chr"+oc+":"+qc+"-"+sc;""===nc?$(".plotInfo").html("<p><strong>"+mc+'</strong> <a href="http://genome.ucsc.edu/cgi-bin/hgTracks?db=hg19&position='+tc+'" target="_blank" title="This link will take you to the UCSC Genome Browser">'+tc+"</a></p>"):$(".plotInfo").html('<p><strong><a href="http://www.genecards.org/cgi-bin/carddisp.pl?gene='+nc+'" target="_blank" title="This link will take you to the GeneCards.org page for '+nc+'.">'+nc+'</a></strong> <span class="ensembl">'+mc+'</span> <a href="http://genome.ucsc.edu/cgi-bin/hgTracks?db=hg19&position='+tc+'" target="_blank" title="This link will take you to the UCSC Genome Browser">'+tc+"</a></p>"),$(".plotInfo").append('<div class="promoterSelectionButton noselect">highlight promoter probes</div>'),$(".promoterSelectionButton").on("click",function(){$(".prom").each(function(){var a,b=$(this);b.is("path")?b.attr("class").match(/line/)?(a=b.attr("stroke"),a===fa?b.attr("stroke",ha):b.attr("stroke",fa)):(a=b.attr("fill"),a===ea?b.attr("fill",ga):b.attr("fill",ea)):b.is("text")?(a=b.attr("fill"),a===ia?b.attr("fill",ha):b.attr("fill",ia)):b.is("line")&&(a=b.attr("stroke"),a===Z?b.attr("stroke",_):b.attr("stroke",Z))})}),prepareSvgForDownload(b,c,e)}function checkUserInput(){$("#userInputForm .inputButton").toggleClass("inactive"),removeMessages();var a=$("#gene").val();a=a.replace(/[<>\\\/;'"()=\[\]\{\}]/g,"");var b=$(".sampleSelectionList").find(".selectedSample").text();""===a?($("#userInputForm .inputButton").toggleClass("inactive"),$("#userInputForm .inputButton").click(!0),$("#gene").focus(),$('<div class="warningMessage">Don\'t forget to enter a gene name!</div>').hide().appendTo("#userInputForm").fadeIn(200)):""===b?($("#userInputForm .inputButton").toggleClass("inactive"),$("#userInputForm .inputButton").click(!0),$('<div class="warningMessage">Don\'t forget to select a source!</div>').hide().appendTo("#userInputForm").fadeIn(200)):""!==a&&""!==b&&plotPreparation()}function plotPreparation(){removeMessages();var a=$("#gene").val();a=a.replace(/[<>\\\/;'"()=\[\]\{\}]/g,"");var b=$(".sampleSelectionList").find(".selectedSample").find(".sourceName").text(),c=$(".sampleSelectionList").find(".selectedSample").find(".fullSourceName").attr("title"),d=b+" "+c;$(".downloadButton").remove(),$(".loadingAnimation").show(),$(".plotContainer").css("background","#fff"),$(".plotContainer").css("border","none"),$(".plotWindow").toggleClass("transparent"),$(".plotInfo").toggleClass("transparent"),$("svg").length&&($(".plotInfo").empty(),$(".plotWindow").empty());$.ajax({type:"POST",url:"php/numberOfSamples.php?source="+d,dataType:"json",success:function(b){var c=b.nrow;$('<div class="infoMessage">'+c+" samples selected</div>").hide().appendTo("#userInputForm").fadeIn(500),createNewPlot(a,d,c)},error:function(){$('<div class="errorMessage">Database error.<br>(could not retrieve the number of samples)</div>').hide().appendTo("#userInputForm").fadeIn(500),$(".plotWindow").toggleClass("hidden"),$("#userInputForm .inputButton").toggleClass("inactive"),$(".loadingAnimation").hide(),$(".plotContainer").css("background","#f6f6f6"),$(".plotContainer").css("border","4px solid #efefef")}})}function createNewPlot(a,b,c){d3.json("php/geneNameQuery.php?gene="+a+"&source="+b,function(d,e){var f=e,g=f.success;if(g){var h="expressionData";createPlot(f,a,b,c,h)}else{var i=f.message;$('<div class="errorMessage">'+i+"</div>").hide().appendTo("#userInputForm").fadeIn(200),$(".plotWindow").toggleClass("hidden"),$(".plotContainer").css("background","#f6f6f6"),$(".plotContainer").css("border-bottom","4px solid #efefef;")}$(".loadingAnimation").hide(),$(".plotWindow").toggleClass("transparent"),$(".plotInfo").toggleClass("transparent"),$("#userInputForm .inputButton").toggleClass("inactive"),$("#extraSelectionForm .inputButton").toggleClass("inactive")})}$(function(){$(window).scroll(function(){$("header").css({left:$(this).scrollLeft()})}),$("input[type=text]").focus(),windowWidth=$(window).width(),inputWidth=$(".userInput").outerWidth(),plotWidth=windowWidth-inputWidth-28,$(".plotContainer").width(plotWidth);var a,b;$(function(){a={serviceUrl:"php/autocomplete.php",minChars:1,maxHeight:200,deferResquestBy:0},b=$("#gene").autocomplete(a)}),$(".sampleSelectionElement").click(function(){var a=$(this);$(".sampleSelectionElement").each(function(){$(this).hasClass("selectedSample")&&$(this).toggleClass("selectedSample")}),a.toggleClass("selectedSample")})});