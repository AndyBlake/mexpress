function pAdjust(a,b){var c;if("bh"===b){var d=a.length,e=[];for(c=d;c>0;c--)e.push(c);var f=[];for(c=0;d>c;c++)f[c]=[a[c],c];var g,h=nestedArraySort(f,!0,0);for(c=0;d>c;c++){var i=h[c][0]*d/e[c];0!==c?g>i?g=i:i=g:g=i,i>1&&(i=1),h[c][0]=i}for(h=nestedArraySort(h,!1,1),result=[],c=0;c<h.length;c++)result.push(h[c][0]);return result}}function pearsonCorrelation(a,b){var c;if(a.length!==b.length)return"failed";var d=[],e=[];for(c in b)isNaN(b[c])||isNaN(a[c])||(e.push(+b[c]),d.push(+a[c]));if(e.length>10){var f=e.length,g=0,h=0,i=0,j=0,k=0;for(c in e)g+=d[c],i+=Math.pow(d[c],2),h+=e[c],j+=Math.pow(e[c],2),k+=d[c]*e[c];var l=k-g*h/f,m=Math.sqrt(i-Math.pow(g,2)/f)*Math.sqrt(j-Math.pow(h,2)/f),n=l/m,o=e.length-2,p=Math.abs(n/Math.sqrt((1-Math.pow(n,2))/o)),q=tDistribution(o,p);return{r:n,p:q}}return"failed"}function mean(a){for(var b=a.length,c=0,d=0;b>d;d++)c+=a[d];var e=c/b;return e}function variance(a){for(var b=a.length,c=mean(a),d=0,e=0;b>e;e++)d+=Math.pow(a[e]-c,2);var f=d/b;return f}function degreesOfFreedom(a,b){var c=a.length,d=b.length,e=variance(a),f=variance(b),g=Math.pow(e/c+f/d,2),h=Math.pow(e/c,2)/(c-1)+Math.pow(f/d,2)/(d-1),i=g/h;return i}function tDistribution(a,b){var c=.049867347,d=.0211410061,e=.0032776263,f=380036e-10,g=488906e-10,h=5383e-9,i=b*(1-1/(4*a))/Math.sqrt(1+Math.pow(b,2)/(2*a)),j=2*(1/(2*Math.pow(1+c*i+d*Math.pow(i,2)+e*Math.pow(i,3)+f*Math.pow(i,4)+g*Math.pow(i,5)+h*Math.pow(i,6),16)));return j}function tTest(a,b){var c;for(c in a)isNaN(a[c])&&(a[c]=null);for(c in b)isNaN(b[c])&&(b[c]=null);if(a.some(function(a){return null!==a})){if(b.some(function(a){return null!==a})){var d=a.length,e=b.length;if(d>=3&&e>=3){var f=mean(a),g=mean(b),h=variance(a),i=variance(b),j=(f-g)/Math.sqrt(h/d+i/e);j=Math.abs(j);var k=degreesOfFreedom(a,b),l=tDistribution(k,j);return l}return"failed"}return"failed"}return"failed"}function nestedArraySort(a,b,c){return b?a.sort(function(a,b){return a=a[c],b=b[c],a===b?0:a>b?-1:1}):a.sort(function(a,b){return a=a[c],b=b[c],a===b?0:b>a?-1:1}),a}function wilcoxonRankSumTest(a,b){var c,d=[],e=[];for(c in a)a[c]&&"null"!==a[c]&&d.push(+a[c]);for(c in b)b[c]&&"null"!==b[c]&&e.push(+b[c]);var f=d.length,g=e.length;if(3>f||3>g)return"failed";var h=f*g/2,i=Math.sqrt(f*g*(f+g+1)/12),j=[];for(c in d)j.push([d[c],1]);for(c in e)j.push([e[c],2]);var k=nestedArraySort(j,!1,0),l=[],m=[];for(c in k)l.push(k[c][0]),m.push(k[c][1]);var n=[];for(c in k){var o=k[c][0],p=l.indexOf(o)+1;n.push(p)}var q=0,r=0;for(c in m){var s=m[c];1===s?q+=n[c]:r+=n[c]}var t=f*g+f*(f+1)/2-q,u=(t-h)/i;u=Math.abs(u);var v=u/Math.sqrt(2),w=1/(1+.5*v),x=w*Math.exp(-Math.pow(v,2)-1.26551223+1.00002368*w+.37409196*Math.pow(w,2)+.09678418*Math.pow(w,3)-.18628806*Math.pow(w,4)+.27886807*Math.pow(w,5)-1.13520398*Math.pow(w,6)+1.48851587*Math.pow(w,7)-.82215223*Math.pow(w,8)+.17087277*Math.pow(w,9)),y=1-x,z=2*(1-.5*(1+y));return z}function prepareSvgForDownload(a,b,c){$(".downloadButton").remove(),$(".downloadText").remove(),$(".plotInfo p").append("<div class='download'></div>"),$(".download").append("<div class='downloadButton png'>png</div>"),$(".download").append("<div class='downloadButton svg'>svg</div>"),$(".download").append("<div class='downloadText'>download a png or svg version of the figure</div>"),$(".downloadButton").css("visibility","visible").hide().fadeIn(1e3),$(".downloadButton").mouseenter(function(){$(".downloadText").css("visibility","visible").hide().fadeIn(100)}).mouseleave(function(){$(".downloadText").css("visibility","hidden")}),$(".downloadButton.png").click(function(){var d=d3.select("svg").attr("version",1.1).attr("xlmns","http://www.w3.org/2000/svg").node().parentNode.innerHTML;$(this).html("<img src='images/arrowLoader.gif'>"),downloadSvg(a,b,c,d,"png")}),$(".downloadButton.svg").click(function(){var d=d3.select("svg").attr("version",1.1).attr("xlmns","http://www.w3.org/2000/svg").node().parentNode.innerHTML;$(this).html("<img src='images/arrowLoader.gif'>"),downloadSvg(a,b,c,d,"svg")})}function createDownloadLink(a,b){var c=a.replace(/^.+\//,""),d=document.createElement("a");d["class"]="downloadLink",d.download=c,d.target="_blank",d.href=a,document.body.appendChild(d),d.click(),"png"===b?$(".downloadButton.png").html("png"):"svg"===b&&$(".downloadButton.svg").html("svg")}function downloadSvg(a,b,c,d,e){var f=encodeURIComponent(d),g=$(".containsProbeId").attr("id"),h="";if(void 0!==g){var h=g.replace(/^.+?_/,"");h=h.replace(/_.+$/,"")}$.ajax({data:"fileType="+e+"&gene="+a+"&source="+b+"&sorter="+c+"&probe="+h+"&svgHtml="+f,url:"php/svg2png.php",method:"POST",success:function(a){var b=a;b="php/"+b,createDownloadLink(b,e)}})}function createNewPlot(a,b,c){d3.json("php/geneNameQuery.php?gene="+a+"&source="+b,function(d,e){var f=e,g=f.success;if(g){var h="expressionData";createPlot(f,a,b,c,h)}else{var i=f.message;$('<div class="errorMessage">'+i+"</div>").hide().appendTo("#userInputForm").fadeIn(200),$(".plotWindow").toggleClass("hidden"),$(".plotContainer").css("background","#F6F6F6"),$(".plotContainer").css("border-bottom","4px solid #EFEFEF;")}$(".loadingAnimation").hide(),$(".plotWindow").toggleClass("transparent"),$(".plotInfo").toggleClass("transparent"),$("#userInputForm .inputButton").toggleClass("inactive"),$("#extraSelectionForm .inputButton").toggleClass("inactive")})}function formatCorrelation(a,b){var c=a.toPrecision(3);return a>0&&(c="+"+c),c="r = "+c,.001>b?c+=" ***":.01>b?c+=" **":.05>b&&(c+=" *"),c}function sortData(a,b){var c,d,e,f,g,h,i=[],j=[];for(c in a.expressionData)j.push(c);var k=j,l=[];if("expressionData"===b){var m=[];for(c in a.expressionData){var n=a.expressionData[c];m.push({key:c,val:n})}m.sort(function(a,b){return b.val-a.val});for(d in m)i.push(m[d].key)}else if("sample type"===b){l=[];for(c in a.expressionData){var o=c.replace(/^.+_(\d\d)$/,"$1");l.push({key:c,val:o})}l.sort(function(a,b){return b.val-a.val});for(d in l)i.push(l[d].key)}else if("PAM50 subtype"===b){l=[];var p=[];for(e in j)c=j[e],c in a.pam50?l.push({key:c,val:a.pam50[c]}):p.push(c);l.sort(function(a,b){var c=a.val.toLowerCase(),d=b.val.toLowerCase();return d>c?-1:c>d?1:0});for(d in l)i.push(l[d].key);i=i.concat(p)}else{var q,r;for(f in a.annotation){q=a.annotation[f];break}for(e in a.slide){r=a.slide[e];break}var s,t,u;if(b in q){s="annotation",t=[],u=[];for(e in a[s])"numberOfAnnotationFields"!==e&&(g=a[s][e][b],void 0!==g&&null!==g?(g=+g,t.push({key:e,val:g})):u.push({key:e,val:g}));t.sort(function(a,b){return b.val-a.val}),t=t.concat(u);for(d in t){var v=t[d].key,w=RegExp(v);for(h=j.length-1;h>=0;h--){var x=j[h],y=x.match(w);if(null!==y){i.push(x);var z=$.inArray(x,k);k.splice(z,1)}}}i=i.concat(k)}else if(b in r){s="slide",t=[],u=[];for(e in a[s])"numberOfSlideFields"!==e&&(g=a[s][e][b],void 0!==g&&null!==g?(g=+g,t.push({key:e,val:g})):u.push({key:e,val:g}));t.sort(function(a,b){return b.val-a.val}),t=t.concat(u);for(d in t)for(c=t[d].key,h=j.length-1;h>=0;h--)j[h]===c&&(i.push(c),j.splice(h,1));i=i.concat(j)}}return i}function updatePlot(a,b,c,d,e){$(".plotInfo").empty(),$(".plotWindow").empty(),createPlot(a,b,c,d,e)}function createPlot(a,b,c,d,e){var f=$(window).width(),g=$(".userInput").outerWidth(),h=f-g-28,i=18,j=14,k=4,l=3,m=2,o="11px",p="Courier New",q="#F59322",r="#4BC722",s="#FFEDC2",t="#FFC842",u="#999",v="#ACD2F2",w="#1A70BA",x="#F9F9F9",y="#FFD57A",z="#F59322",A="#FFD161",B="#AAD5FA",C="#4999DE",D="#63ACEB",E="#14568F",F="#b6d3f2",G="#DCE1E6",H="#C5CCD4",I="#FA89CA",J="#F272BB",K="#98D3FA",L="#7FC3F0",M="#98D3FA",N="#4999DE",O="#944E07",P="#693705",Q="#73CC5B",R="#37AC19",S={Normal:"#4999DE",Basal:"#FFC03B",Her2:"#FF983B",LumA:"#73CC5B",LumB:"#37AC19","no data":x},T={"01":"primary solid tumor","02":"recurrent solid tumor","03":"primary blood derived cancer - peripheral blood","04":"recurrent blood derived cancer - bone marrow","05":"additional - new primary","06":"metastatic","07":"additional metastatic","08":"human tumor original cells","09":"primary blood derived cancer - bone marrow",10:"blood derived normal",11:"solid tissue normal",12:"buccal cell normal",13:"EBV immortalized normal",14:"bone marrow normal",20:"control analyte",40:"recurrent blood derived cancer - peripheral blood",50:"cell lines",60:"primary xenograft tissue",61:"cell line derived xenograft tissue"},U={"01":"#98D3FA","02":"#F7A972","03":"#F2766F","04":"#DB7346","05":"#3FD19B","06":"#FFD161","07":"#D13F75","08":"#6FF0F2","09":"#F29B6F",10:"#9DC9F5",11:"#4999DE",12:"#4198F0",13:"#0F73D6",14:"#90D8F5",20:"#46BFF0",40:"#DB4E46",50:"#F07746",60:"#A17FAD",61:"#8A38A8"},V=a.numberOfProbes,W=a.geneInfo,X=+W.start,Y=+W.end,Z=W.strand,_=a.transcripts,aa=a.cpgi,ba=0,ca=!1,da={},ea=[];n=+a.annotation.numberOfAnnotationFields,n>ba&&(ba=n);var fa,ga,ha,ia,ja,ka,la,ma,na,oa;for(fa in a.annotation)for(na in a.annotation[fa])-1===$.inArray(na,ea)&&ea.push(na),"gender"===na&&(ca=!0),ka=parseFloat(a.annotation[fa][na]),isNaN(ka)?da.hasOwnProperty(na)||(da[na]=0):da.hasOwnProperty(na)?ka>da[na]&&(da[na]=ka):da[na]=ka;ba++;var pa=0,qa=[];if("no_data"!==a.slide){n=+a.slide.numberOfSlideFields,n>pa&&(pa=n);for(fa in a.slide)if("numberOfSlideFields"!==fa){for(ha in a.slide[fa])qa.push(ha);break}}ba+=pa,"BRCA breast invasive carcinoma"===c&&ba++;var ra=0;for(fa in a.expressionData)expr=+a.expressionData[fa],expr>ra&&(ra=expr);var sa=sortData(a,e),ta=[],ua=[],va=[],wa=[],xa=[];for(fa in a.methylationData){for(ga in a.methylationData[fa])xa.push(ga);break}var ya={};for(ga in xa)ya[xa[ga]]=[];var za=[];for(ja in sa)if(fa=sa[ja],a.methylationData[fa]){za.push(fa),ta[fa]=a.methylationData[fa];for(ga in xa)ya[xa[ga]].push(a.methylationData[fa][xa[ga]]);ia=fa.replace(/_\d\d$/,""),a.annotation[ia]?va[ia]=a.annotation[ia]:va[ia]="no_annotation",a.slide[fa]?wa[fa]=a.slide[fa]:wa[fa]="no_data",ma=a.expressionData[fa],ua[fa]=ma}var Aa,Ba,Ca,Da={};Da.expressionData={},Da["sample type"]={},Da["PAM50 subtype"]={};for(fa in a.annotation){for(Aa in a.annotation[fa])Da[Aa]={};break}for(fa in a.slide){for(Aa in a.slide[fa])Da[Aa]={};break}for(ha in Da){var Ea={},Fa=[];if("expressionData"===ha)Ea=a[ha];else if(-1!==$.inArray(ha,ea))for(ia in a.annotation)Ea[ia]=a.annotation[ia][ha];else if(-1!==$.inArray(ha,qa))for(fa in a.slide)Ea[fa]=a.slide[fa][ha];else if("sample type"===ha)for(ja in za)fa=za[ja],Ba=fa.replace(/^.+_(\d\d)$/,"$1"),"10"===Ba||"11"===Ba||"12"===Ba||"13"===Ba||"14"===Ba?Ea[fa]="1":Ea[fa]="0";else if("PAM50 subtype"===ha)for(ja in za)fa=za[ja],fa in a.pam50?Ea[fa]=a.pam50[fa]:Ea[fa]="no data";for(la in Ea)Fa.push(Ea[la]);var Ga,Ha,Ia=numberOfLevels(Fa);if("expressionData"!==ha)if(2===Ia){Ga=[],Ha=[];for(fa in ua)ia=fa.replace(/_\d\d$/,""),"no_annotation"!==va[ia]&&(ka="sample type"!==ha?va[ia][ha]:Ea[fa],"1"===ka?Ga.push(ua[fa]):"0"===ka&&Ha.push(ua[fa]));oa=wilcoxonRankSumTest(Ga,Ha),Da[ha].expressionData={p:oa}}else if(Ia>2&&"PAM50 subtype"!==ha&&"eye_color"!==ha&&"batch number"!==ha){Ga=[],Ha=[];for(ja in za)fa=za[ja],Ga.push(ua[fa]),-1!==$.inArray(ha,ea)?(ia=fa.replace(/_\d\d$/,""),Ha.push(Ea[ia])):Ha.push(Ea[fa]);oa=pearsonCorrelation(Ga,Ha),Da[ha].expressionData={r:oa.r,rp:oa.p}}else Da[ha].expressionData={n:"no normals"};for(Ca in xa)if(2===Ia){Ga=[],Ha=[];for(ja in za)fa=za[ja],ia=fa.replace(/_\d\d$/,""),"no_annotation"!==va[ia]&&(ka="sample type"!==ha?va[ia][ha]:Ea[fa],"1"===ka?Ga.push(ta[fa][xa[Ca]]):"0"===ka&&Ha.push(ta[fa][xa[Ca]]));oa=wilcoxonRankSumTest(Ga,Ha),Da[ha][xa[Ca]]={p:oa}}else if(Ia>2&&"PAM50 subtype"!==ha&&"eye_color"!==ha&&"batch number"!==ha){Ga=[],Ha=[];for(ja in za)fa=za[ja],Ga.push(ta[fa][xa[Ca]]),-1!==$.inArray(ha,ea)?(ia=fa.replace(/_\d\d$/,""),Ha.push(Ea[ia])):Ha.push(Ea[fa]);oa=pearsonCorrelation(Ga,Ha),Da[ha][xa[Ca]]={r:oa.r,rp:oa.p}}else Da[ha][xa[Ca]]={n:"failed"};var Ja;for(var Ka in ea)if(Ja=ea[Ka],Ja!==ha){var La=[];for(Ca in va)La.push(va[Ca][Ja]);var Ma=numberOfLevels(La);if(2===Ia)if(2===Ma)Da[ha][Ja]={n:"failed"};else if(Ma>2){Ga=[],Ha=[];for(ja in za)fa=za[ja],ia=fa.replace(/_\d\d$/,""),"no_annotation"!==va[ia]&&(ka="sample type"!==ha?va[ia][ha]:Ea[fa],"1"===ka?Ga.push(va[ia][Ja]):"0"===ka&&Ha.push(va[ia][Ja]));oa=wilcoxonRankSumTest(Ga,Ha),Da[ha][Ja]={p:oa}}else Da[ha][Ja]={n:"failed"};else if(Ia>2&&"PAM50 subtype"!==ha&&"eye_color"!==ha&&"batch number"!==ha)if(2===Ma){Ga=[],Ha=[];for(ja in za)fa=za[ja],ia=fa.replace(/_\d\d$/,""),"no_annotation"!==va[ia]&&(ka=va[ia][Ja],"1"===ka?-1!==$.inArray(ha,ea)?Ea[ia]&&Ga.push(Ea[ia]):Ea[fa]&&Ga.push(Ea[fa]):"0"===ka&&(-1!==$.inArray(ha,ea)?Ea[ia]&&Ha.push(Ea[ia]):Ea[fa]&&Ha.push(Ea[fa])));oa=wilcoxonRankSumTest(Ga,Ha),Da[ha][Ja]={p:oa}}else if(Ma>2){Ga=[],Ha=[];for(ja in za)fa=za[ja],ia=fa.replace(/_\d\d$/,""),-1!==$.inArray(ha,ea)?Ea[ia]&&(Ga.push(Ea[ia]),Ha.push(va[ia][Ja])):Ea[fa]&&(Ga.push(Ea[fa]),Ha.push(va[ia][Ja]));oa=pearsonCorrelation(Ga,Ha),Da[ha][Ja]={r:oa.r,rp:oa.p}}else Da[ha][Ja]={n:"failed"};else Da[ha][Ja]={n:"failed"}}for(ja in qa)if(Ja=qa[ja],Ja!==ha)if(2===Ia){Ga=[],Ha=[];for(ja in za)fa=za[ja],ia=fa.replace(/_\d\d$/,""),ka="sample type"!==ha?va[ia][ha]:Ea[fa],"1"===ka?Ga.push(wa[fa][Ja]):"0"===ka&&Ha.push(wa[fa][Ja]);oa=wilcoxonRankSumTest(Ga,Ha),Da[ha][Ja]={p:oa}}else if(Ia>2&&"PAM50 subtype"!==ha&&"eye_color"!==ha&&"batch number"!==ha){Ga=[],Ha=[];for(ja in za)fa=za[ja],ia=fa.replace(/_\d\d$/,""),-1!==$.inArray(ha,ea)?Ea[ia]&&(Ga.push(Ea[ia]),Ha.push(wa[fa][Ja])):(Ga.push(Ea[fa]),Ha.push(wa[fa][Ja]));oa=pearsonCorrelation(Ga,Ha),Da[ha][Ja]={r:oa.r,rp:oa.p}}else Da[ha][Ja]={n:"failed"};if("sample type"!==ha){var Na={},Oa=[];for(ja in za)fa=za[ja],Ba=fa.replace(/^.+_(\d\d)$/,"$1"),"10"===Ba||"11"===Ba||"12"===Ba||"13"===Ba||"14"===Ba?(Na[fa]="1",Oa.push("1")):(Na[fa]="0",Oa.push("0"));var Pa=numberOfLevels(Oa);if(2===Pa){if(2===Ia)Da[ha]["sample type"]={n:"failed"};else if(Ia>2&&"PAM50 subtype"!==ha&&"eye_color"!==ha&&"batch number"!==ha){Ga=[],Ha=[];for(ja in za){fa=za[ja],ia=fa.replace(/_\d\d$/,"");var Qa=Na[fa];"1"===Qa?-1!==$.inArray(ha,ea)?Ea[ia]&&Ga.push(Ea[ia]):Ea[fa]&&Ga.push(Ea[fa]):"0"===Qa&&(-1!==$.inArray(ha,ea)?Ea[ia]&&Ha.push(Ea[ia]):Ea[fa]&&Ha.push(Ea[fa]))}oa=wilcoxonRankSumTest(Ga,Ha),Da[ha]["sample type"]={p:oa}}}else Da[ha]["sample type"]={n:"no normal samples"}}}var Ra,Sa,Ta=[],Ua=[];for(la in Da[e])Ra=Da[e][la],Ra.rp&&"failed"!==Ra.rp?(Ta.push(Ra.rp),Ua.push(la)):Ra.p&&"failed"!==Ra.p&&(Ta.push(Ra.p),Ua.push(la));var Va=pAdjust(Ta,"bh");for(Sa=0;Sa<Va.length;Sa++){var Wa=Va[Sa];Wa=+Wa.toPrecision(3);var Xa=1e3*Wa;1>Xa&&(Wa=Wa.toExponential()),Ra=Ua[Sa],Da[e][Ra].rp?Da[e][Ra].rp=Wa:Da[e][Ra].p&&(Da[e][Ra].p=Wa)}Fb=0;var Ya;for(Ya in _)_.hasOwnProperty(Ya)&&Fb++;Db=0;for(Ya in aa)aa.hasOwnProperty(Ya)&&Db++;var Za=8+4*Fb;Db>0&&(Za+=5);var $a=Math.abs(X-Y),_a=148,ab=[];if("no_annotation"!==a.annotation)for(ja in za)fa=za[ja],Ba=fa.replace(/^.+_(\d\d)$/,"$1"),-1===$.inArray(Ba,ab)&&ab.push(Ba);ab.length>7&&(_a=148+18*ab.length);var bb,cb=10+ra/20*i*3+10+(j+1)*ba+20+_a,db=170+Za,eb=110,fb={top:cb,left:db,bottom:40,right:eb},gb=h-db-eb,hb=600;ca&&(hb=750),hb>gb&&(gb=hb),bb=10>V?10*i:$a>1e5&&40>V?40*i:V*i;var ib=Math.floor(gb/d);1>ib?ib=1:ib>6&&(ib=6),gb=ib*d;var jb=d3.scale.linear().range([0,gb]),kb=d3.scale.linear().range([bb,0]),lb=(d3.svg.axis().scale(jb).orient("top"),d3.svg.line().defined(function(a){return null!==a}).x(function(a,b){return jb(b)+ib/2}).y(function(a){return a}));$(".plotWindow").removeClass("hidden");var mb=d3.select(".plotWindow").append("svg").attr("width",gb+fb.left+fb.right).attr("height",bb+fb.top+fb.bottom).attr("text-rendering","geometricPrecision").attr("font-family","arial").attr("font-size","12px").attr("fill","#666").append("g").attr("transform","translate("+fb.left+","+fb.top+")");jb.domain([0,d]),kb.domain([0,V]);var nb=1e3;$a/10>1e3&&(nb=$a/10),nb>5e3&&(nb=5e3);var ob,pb,qb=X-nb,rb=Y+nb,sb=(rb-qb)/V,tb=(X-qb)/sb,ub=(Y-qb)/sb;"1"===Z?(ob=X-1e3,pb=X+500):(ob=Y-500,pb=Y+1e3);var vb,wb;if(vb=-db+1,wb=-cb+24,mb.append("text").attr("x",vb).attr("y",wb).attr("font-weight","bold").text("annotation"),mb.append("rect").attr("fill",q).attr("x",vb).attr("y",wb+8).attr("width",3).attr("height",12),mb.append("text").attr("x",vb+8).attr("y",wb+18).text("gene"),mb.append("rect").attr("fill",s).attr("x",vb).attr("y",wb+8+18).attr("width",3).attr("height",12),mb.append("text").attr("x",vb+8).attr("y",wb+36).text("transcript"),mb.append("rect").attr("fill",r).attr("x",vb).attr("y",wb+8+36).attr("width",3).attr("height",12),mb.append("text").attr("x",vb+8).attr("y",wb+54).text("CpG island"),vb+=90,mb.append("text").attr("x",vb).attr("y",wb).attr("font-weight","bold").text("data"),mb.append("rect").attr("fill",y).attr("x",vb).attr("y",wb+8).attr("width",3).attr("height",12),mb.append("text").attr("x",vb+8).attr("y",wb+18).text("RNA-seq v2 (log2)"),mb.append("rect").attr("fill",B).attr("x",vb).attr("y",wb+8+18).attr("width",3).attr("height",12),mb.append("text").attr("x",vb+8).attr("y",wb+36).text(a.platform),mb.append("rect").attr("fill",G).attr("x",vb).attr("y",wb+8+36).attr("width",3).attr("height",12),mb.append("text").attr("x",vb+8).attr("y",wb+54).text("slide/clinical data"),mb.append("rect").attr("fill",x).attr("x",vb).attr("y",wb+8+54).attr("width",3).attr("height",12),mb.append("text").attr("x",vb+8).attr("y",wb+72).text("missing data"),vb+=120,ca&&(mb.append("text").attr("x",vb).attr("y",wb).attr("font-weight","bold").text("gender"),mb.append("rect").attr("fill",I).attr("x",vb).attr("y",wb+8).attr("width",3).attr("height",12),mb.append("text").attr("x",vb+8).attr("y",wb+18).text("female"),mb.append("rect").attr("fill",K).attr("x",vb).attr("y",wb+8+18).attr("width",3).attr("height",12),mb.append("text").attr("x",vb+8).attr("y",wb+36).text("male"),vb+=70),mb.append("text").attr("x",vb).attr("y",wb).attr("font-weight","bold").text("statistics"),mb.append("text").attr("x",vb).attr("y",wb+18).attr("font-size","14px").attr("font-family",p).text("p"),mb.append("text").attr("x",vb+16).attr("y",wb+18).text("Wilcoxon rank-sum test"),mb.append("text").attr("x",vb+16).attr("y",wb+18+14).attr("font-weight","bold").attr("font-size","11px").attr("font-family",p).text("p < 0.05"),mb.append("text").attr("x",vb+16+72).attr("y",wb+18+14).attr("fill","#aaa").attr("font-size","11px").attr("font-family",p).text("p ≥ 0.05"),mb.append("text").attr("x",vb).attr("y",wb+54).attr("font-size","14px").attr("font-family",p).text("r"),mb.append("text").attr("x",vb+16).attr("y",wb+54).text("Pearson correlation"),mb.append("text").attr("x",vb+16).attr("y",wb+54+14).attr("font-weight","bold").attr("font-size","11px").attr("font-family",p).text("***"),mb.append("text").attr("x",vb+16+32).attr("y",wb+54+14).attr("font-weight","bold").attr("font-size","11px").attr("font-family",p).text("p < 0.001"),mb.append("text").attr("x",vb+16).attr("y",wb+54+28).attr("font-weight","bold").attr("font-size","11px").attr("font-family",p).text("**"),mb.append("text").attr("x",vb+16+32).attr("y",wb+54+28).attr("font-weight","bold").attr("font-size","11px").attr("font-family",p).text("p < 0.01"),mb.append("text").attr("x",vb+16).attr("y",wb+54+42).attr("font-weight","bold").attr("font-size","11px").attr("font-family",p).text("*"),mb.append("text").attr("x",vb+16+32).attr("y",wb+54+42).attr("font-weight","bold").attr("font-size","11px").attr("font-family",p).text("p < 0.05"),mb.append("text").attr("x",vb+16+32).attr("y",wb+54+56).attr("fill","#aaa").attr("font-size","11px").attr("font-family",p).text("p ≥ 0.05"),vb+=160,"BRCA breast invasive carcinoma"===c){mb.append("text").attr("x",vb).attr("y",wb).attr("font-weight","bold").text("BRCA subtype"),Sa=0;for(var xb in S)"no data"!==xb&&(mb.append("rect").attr("fill",S[xb]).attr("x",vb).attr("y",wb+8+18*Sa).attr("width",3).attr("height",12),mb.append("text").attr("x",vb+8).attr("y",wb+18*(Sa+1)).text(xb),Sa++);vb+=106}mb.append("text").attr("x",vb).attr("y",wb).attr("font-weight","bold").text("sample type");var yb=0;for(ja in ab){Ba=ab[ja];var zb=T[Ba];zb.length>26&&(zb=zb.substring(0,23),zb+="..."),mb.append("rect").attr("fill",U[Ba]).attr("x",vb).attr("y",wb+8+18*yb).attr("width",3).attr("height",12),mb.append("text").attr("x",vb+8).attr("y",wb+18*(yb+1)).text(zb+" ("+Ba+")"),yb++}var Ab,Bb;for(fa in a.methylationData){Bb=0;for(ga in a.methylationData[fa]){Bb++,Ab="",ga>=ob&&pb>=ga&&(Ab="prom");var Cb=(ga-qb)/sb;mb.append("line").attr("x1",-db).attr("x2",-db+Za+80).attr("y1",bb-kb(Cb)).attr("y2",bb-kb(Cb)).attr("stroke",v).attr("stroke-opacity",.5).attr("stroke-width",1).attr("class",Ab).attr("id","annotationLine"+ga),mb.append("line").attr("x1",-db+Za+80).attr("x2",jb(1)).attr("y1",bb-kb(Cb)).attr("y2",bb-kb(Bb-1)+i/2).attr("stroke",v).attr("stroke-opacity",.5).attr("stroke-width",1).attr("class",Ab)}break}mb.append("rect").attr("fill",q).attr("x",-db+7).attr("y",bb-kb(tb)).attr("width",k).attr("height",kb(V-(ub-tb))),"1"===Z?(mb.append("line").attr("x1",-db+4).attr("x2",-db+9).attr("y1",kb(V-(ub-tb))+bb-kb(tb)-7).attr("y2",kb(V-(ub-tb))+bb-kb(tb)).style("stroke",q).attr("stroke-width",k-1).attr("stroke-linecap","round"),mb.append("line").attr("x1",-db+9).attr("x2",-db+14).attr("y1",kb(V-(ub-tb))+bb-kb(tb)).attr("y2",kb(V-(ub-tb))+bb-kb(tb)-7).style("stroke",q).attr("stroke-width",k-1).attr("stroke-linecap","round")):(mb.append("line").attr("x1",-db+4).attr("x2",-db+9).attr("y1",bb-kb(tb)+7).attr("y2",bb-kb(tb)).style("stroke",q).attr("stroke-width",k-1).attr("stroke-linecap","round"),mb.append("line").attr("x1",-db+9).attr("x2",-db+14).attr("y1",bb-kb(tb)).attr("y2",bb-kb(tb)+7).style("stroke",q).attr("stroke-width",k-1).attr("stroke-linecap","round"));var Db=0;for(var Eb in aa)Db++,cStart=aa[Eb].start,cEnd=aa[Eb].end,cStart<qb&&(cStart=qb),cEnd>rb&&(cEnd=rb),cStartPlot=(cStart-qb)/sb,cEndPlot=(cEnd-qb)/sb,mb.append("rect").attr("fill",r).attr("x",-db+18).attr("y",bb-kb(cStartPlot)).attr("width",l).attr("height",kb(V-(cEndPlot-cStartPlot)));var Fb=0;for(var Gb in _){Fb++;var Hb=+_[Gb].start,Ib=+_[Gb].end,Jb=(Hb-qb)/sb,Kb=(Ib-qb)/sb;mb.append("rect").attr("fill",s).attr("x",-db+22+6*Fb).attr("y",bb-kb(Jb)).attr("width",m).attr("height",kb(V-(Kb-Jb))).html("<title>"+Gb+"</title");var Lb=a.transcripts[Gb].exons;for(la in Lb){var Mb=+Lb[la].start,Nb=+Lb[la].end;eStartPlot=(Mb-qb)/sb,eEndPlot=(Nb-qb)/sb,mb.append("rect").attr("fill",t).attr("x",-db+22+6*Fb).attr("y",bb-kb(eStartPlot)).attr("width",m).attr("height",kb(V-(eEndPlot-eStartPlot)))}}var Ob=Math.round(Math.log($a)/Math.log(10)),Pb=Math.pow(10,Ob-1);1e3>Pb&&5e3>$a&&(Pb=1e3);var Qb,Rb;"1"===Z?(Qb=X-Pb/2,Rb=X+Pb/2):(Qb=Y-Pb/2,Rb=Y+Pb/2);var Sb=(Qb-qb)/sb,Tb=(Rb-qb)/sb;mb.append("rect").attr("fill",u).attr("x",-db+2).attr("y",bb-kb(Sb)).attr("width",2).attr("id","scaleBar").attr("height",kb(V-(Tb-Sb)));var Ub=Pb/1e3;Ub+="kb";var Vb;Vb="1"==Z?kb(Sb)+2:kb(Tb)-10,mb.append("text").attr("x",-db+1).attr("y",bb-Vb).attr("font-size","9px").attr("fill",u).text(Ub);var Wb=[];for(ja in za)fa=za[ja],ma=ua[fa],Wb.push(bb-kb(0)-ma/20*i*3-10);var Xb=0;100>d?Xb=2:200>d&&(Xb=1);var Yb=d3.svg.area().defined(function(a){return a}).x(function(a,b){return jb(b)+Xb}).y1(function(a){return a}).y0(bb-kb(0)-10);mb.append("path").attr("d",Yb(Wb)).attr("fill",y),mb.append("line").attr("x1",jb(1)).attr("x2",jb(d)).attr("y1",bb-kb(0)-ra/20*i*3-10).attr("y2",bb-kb(0)-ra/20*i*3-10).style("stroke",A).attr("stroke-width",1).attr("shape-rendering","crispEdges").attr("stroke-dasharray","5,5"),mb.append("path").attr("d",lb(Wb)).style("stroke",z).attr("stroke-width",1).attr("fill","none"),mb.append("text").attr("x",-4).attr("y",bb-kb(0)-10-ra/20*i).attr("class","clickable").attr("id","expressionData").attr("text-anchor","end").attr("font-size","12px").attr("fill","#aaa").text("expression").on("mouseup",function(){"expressionData"!==e&&updatePlot(a,b,c,d,"expressionData")});var Zb=0;for(ga in ya){Zb++;var $b=ya[ga],_b=[];for(ja in $b){var ac=$b[ja];if(isNaN(ac))_b.push(null);else{var bc=bb-kb(Zb-1)+(1-ac)*i;_b.push(bc)}}if(Ab="",ga>=ob&&pb>=ga&&(Ab="prom"),_b.some(function(a){return null!==a})){var cc=d3.svg.area().defined(function(a){return a}).x(function(a,b){return jb(b)+Xb}).y1(function(a){return a}).y0(bb-kb(Zb-1)+i);mb.append("path").attr("d",cc(_b)).attr("class",Ab).attr("fill",B),mb.append("path").attr("d",lb(_b)).attr("stroke",C).attr("class",Ab+" line").attr("stroke-width",1).attr("fill","none")}else mb.append("text").attr("x",4).attr("y",bb-kb(Zb-1)+.75*i).attr("text-anchor","start").attr("font-size","9px").attr("class",Ab).attr("fill",F).text("no data")}var dc=[];for(ja in za)if(fa=za[ja],Bb=0,ta[fa]){for(ga in ta[fa]){Bb++,dc.push(ga);var ec=a.probeIds[ga];mb.append("rect").attr("fill","#fff").attr("fill-opacity",0).attr("x",jb(0)).attr("y",bb-kb(Bb-1)).attr("width",ib*d).attr("height",i).attr("id",ga+"_"+ec+"_"+Bb).attr("class","clickable").on("mouseover",function(){var a=$(this).attr("id"),b=a.replace(/_.+$/,""),c=a.replace(/^.+?_/,"");c=c.replace(/_.+$/,"");var d=(b-qb)/sb;mb.append("text").attr("x",-74).attr("y",bb-kb(d)-6).attr("text-anchor","end").attr("class","probeId").attr("font-size","11px").attr("stroke","#fff").attr("stroke-width",4).text(c),mb.append("text").attr("x",-74).attr("y",bb-kb(d)-6).attr("text-anchor","end").attr("class","probeId").attr("font-size","11px").attr("fill",C).text(c),mb.append("line").attr("x1",-db).attr("x2",-db+Za+80).attr("y1",bb-kb(d)).attr("y2",bb-kb(d)).style("stroke",C).attr("stroke-width",2).attr("class","focusLine")}).on("mouseout",function(){$(".focusLine").remove(),$(".probeId").remove()}).on("mouseup",function(){var b=$(this).attr("id"),c=$(".probeIdClicked").attr("id");if($(".focusLineClicked").remove(),$(".probeIdClicked").remove(),$(".probeInfo").remove(),c!==b){var d=a.geneInfo.chr,e=b.replace(/_.+$/,""),f=b.replace(/^.+?_/,"");f=f.replace(/_.+$/,"");var g=b.replace(/^.+_/,""),h=(e-qb)/sb;mb.append("text").attr("x",-74).attr("y",bb-kb(h)-6).attr("text-anchor","end").attr("class","probeIdClicked containsProbeId").attr("id",b).attr("font-size","11px").attr("stroke","#FFF").attr("stroke-width",4).text(f),mb.append("text").attr("x",-74).attr("y",bb-kb(h)-6).attr("text-anchor","end").attr("class","probeIdClicked clickable").attr("font-size","11px").attr("fill",C).text(f).on("mouseup",function(){var b=a.probeAnnotation[e];b=b.replace(/-/g," ± ");var c=140;b.length>20&&(c=180),mb.append("rect").attr("x",-142).attr("y",bb-kb(h)-24).attr("width",c).attr("height",66).attr("fill","#fff").attr("stroke",C).attr("stroke-width",2).attr("class","probeInfo clickable").on("mouseup",function(){$(".probeInfo").remove()}),mb.append("text").attr("x",-136).attr("y",bb-kb(h)-6).attr("class","probeInfo").attr("font-weight","bold").text(f),mb.append("text").attr("x",-136).attr("y",bb-kb(h)+14).attr("class","probeInfo").text("chr"+d+":"+e),mb.append("text").attr("x",-136).attr("y",bb-kb(h)+30).attr("class","probeInfo").text(b),mb.append("text").attr("x",-142+c-20).attr("y",bb-kb(h)-4).attr("class","probeInfo clickable").attr("font-size","18px").attr("font-weight","bold").attr("fill",C).text("×").on("mouseup",function(){$(".probeInfo").remove()})}),mb.append("line").attr("x1",-db).attr("x2",-db+Za+80).attr("y1",bb-kb(h)).attr("y2",bb-kb(h)).style("stroke",C).attr("stroke-width",2).attr("class","focusLineClicked"),mb.append("line").attr("x1",-db+Za+80).attr("x2",jb(1)).attr("y1",bb-kb(h)).attr("y2",bb-kb(g-1)+i/2).style("stroke",C).attr("stroke-width",2).attr("class","focusLineClicked")}})}break}Bb=0;var fc,gc,hc,ic,jc,kc,lc,mc;if("expressionData"===e)for(ga in dc)Bb++,fc=Da[e][dc[ga]],fc.r&&(gc=fc.r,"failed"!==gc&&(Ca=parseFloat(fc.rp),hc=formatCorrelation(gc,Ca),ic="#aaa",jc="normal",.05>Ca&&(ic="#666",jc="bold"),mb.append("text").attr("x",jb(d)+4*ib).attr("y",bb-kb(Bb-1)+i-4).attr("font-size",o).attr("font-weight",jc).attr("font-family",p).attr("fill",ic).text(hc)));else for(ga in dc)Bb++,fc=Da[e][dc[ga]],fc.p||0===fc.p?(Ca=fc.p,"failed"!==Ca&&(lc="#aaa",mc="normal",kc=parseFloat(Ca),.05>kc&&(lc="#666",mc="bold"),Ca=kc<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+Ca,mb.append("text").attr("x",jb(d)+4*ib).attr("y",bb-kb(Bb-1)+i-4).attr("font-size",o).attr("font-weight",mc).attr("font-family",p).attr("fill",lc).text(Ca))):fc.r&&(gc=fc.r,"failed"!==gc&&(Ca=parseFloat(fc.rp),hc=formatCorrelation(gc,Ca),ic="#aaa",jc="normal",.05>Ca&&(ic="#666",jc="bold"),mb.append("text").attr("x",jb(d)+4*ib).attr("y",bb-kb(Bb-1)+i-4).attr("font-size",o).attr("font-weight",jc).attr("font-family",p).attr("fill",ic).text(hc)));var nc,oc,pc,qc,rc,sc;if("no_annotation"!==a.annotation){oc=0;for(ja in za){fa=za[ja],ia=fa.replace(/_\d\d$/,"");var tc;tc=oc%2===0?G:H,Ba=fa.replace(/^.+_(\d\d)$/,"$1");var uc=(T[Ba],U[Ba]);if(nc=1,mb.append("rect").attr("fill",uc).attr("x",jb(oc)).attr("y",bb-kb(0)-10-ra/20*i*3-10-(j+1)*nc).attr("width",ib).attr("height",j),"BRCA breast invasive carcinoma"===c){nc++;var vc;vc=fa in a.pam50?a.pam50[fa]:"no data";var wc=S[vc];mb.append("rect").attr("fill",wc).attr("x",jb(oc)).attr("y",bb-kb(0)-10-ra/20*i*3-10-(j+1)*nc).attr("width",ib).attr("height",j)}if("no_annotation"!==va[ia])for(na in va[ia]){ka=va[ia][na];var xc;"gender"===na&&(xc=1==ka?oc%2===0?I:J:oc%2===0?K:L);var yc;"eye_color"===na&&(yc=1==ka?oc%2===0?M:N:2==ka?oc%2===0?O:P:oc%2===0?Q:R);var zc=da[na];nc++,null===ka?mb.append("rect").attr("fill",x).attr("x",jb(oc)).attr("y",bb-kb(0)-10-ra/20*i*3-10-(j+1)*nc).attr("width",ib).attr("height",j):"gender"===na?(qc=j,wb=bb-kb(0)-10-ra/20*i*3-10-(j+1)*nc+(j-qc),mb.append("rect").attr("fill",xc).attr("x",jb(oc)).attr("y",wb).attr("width",ib).attr("height",qc)):"eye_color"===na?(qc=j,wb=bb-kb(0)-10-ra/20*i*3-10-(j+1)*nc+(j-qc),mb.append("rect").attr("fill",yc).attr("x",jb(oc)).attr("y",wb).attr("width",ib).attr("height",qc)):(qc=j/zc*ka,wb=bb-kb(0)-10-ra/20*i*3-10-(j+1)*nc+(j-qc),mb.append("rect").attr("fill",tc).attr("x",jb(oc)).attr("y",wb).attr("width",ib).attr("height",qc))}else mb.append("rect").attr("fill",x).attr("x",jb(oc)).attr("y",bb-kb(0)-10-ra/20*i*3-10-(j+1)*(ba-pa)).attr("width",ib).attr("height",(j+1)*(ba-1-pa)-1);oc++}if("expressionData"===e){nc=0,fc=Da[e]["sample type"],(fc.p||0===fc.p)&&(Ca=fc.p,"failed"!==Ca&&(lc="#aaa",mc="normal",kc=parseFloat(Ca),.05>kc&&(lc="#666",mc="bold"),Ca=kc<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+Ca,mb.append("text").attr("x",jb(d)+4*ib).attr("y",bb-kb(0)-10-ra/20*i*3-10-(j+1)*nc-4).attr("font-size",o).attr("font-weight",mc).attr("font-family",p).attr("fill",lc).text(Ca))),"BRCA breast invasive carcinoma"===c&&nc++;for(na in da)nc++,fc=Da[e][na],fc.p||0===fc.p?(Ca=fc.p,"failed"!==Ca&&(lc="#aaa",mc="normal",kc=parseFloat(Ca),.05>kc&&(lc="#666",mc="bold"),Ca=kc<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+Ca,mb.append("text").attr("x",jb(d)+4*ib).attr("y",bb-kb(0)-10-ra/20*i*3-10-(j+1)*nc-4).attr("font-size",o).attr("font-weight",mc).attr("font-family",p).attr("fill",lc).text(Ca))):fc.r&&(gc=fc.r,"failed"!==gc&&(Ca=parseFloat(fc.rp),hc=formatCorrelation(gc,Ca),ic="#aaa",jc="normal",.05>Ca&&(ic="#666",jc="bold"),mb.append("text").attr("x",jb(d)+4*ib).attr("y",bb-kb(0)-10-ra/20*i*3-10-(j+1)*nc-4).attr("font-size",o).attr("font-weight",jc).attr("font-family",p).attr("fill",ic).text(hc)));pc=ba-pa;for(rc in qa)sc=qa[rc],fc=Da.expressionData[sc],fc.r&&(gc=fc.r,"failed"!==gc&&(Ca=parseFloat(fc.rp),hc=formatCorrelation(gc,Ca),ic="#aaa",jc="normal",.05>Ca&&(ic="#666",jc="bold"),mb.append("text").attr("x",jb(oc)+4*ib).attr("y",bb-kb(0)-10-ra/20*i*3-10-(j+1)*pc-4).attr("class",sc).attr("font-size",o).attr("font-weight",jc).attr("font-family",p).attr("fill",ic).text(hc))),pc++}else if("sample type"===e){fc=Da[e].expressionData,fc.n?(oa=fc.n,mb.append("text").attr("x",jb(d)+4*ib).attr("y",bb-kb(0)-10-ra/20*i).attr("font-size",o).attr("font-family",p).attr("fill","#aaa").text(oa)):(fc.p||0===fc.p)&&(Ca=fc.p,"failed"!==Ca&&(lc="#aaa",mc="normal",kc=parseFloat(Ca),.05>kc&&(lc="#666",mc="bold"),Ca=kc<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+Ca,mb.append("text").attr("x",jb(d)+4*ib).attr("y",bb-kb(0)-10-ra/20*i).attr("font-size",o).attr("font-weight",mc).attr("font-family",p).attr("fill",lc).text(Ca))),Bb=0;for(ga in dc)Bb++,fc=Da[e][dc[ga]],(fc.p||0===fc.p)&&(Ca=fc.p,"failed"!==Ca&&(lc="#aaa",
mc="normal",kc=parseFloat(Ca),.05>kc&&(lc="#666",mc="bold"),Ca=kc<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+Ca,mb.append("text").attr("x",jb(d)+4*ib).attr("y",bb-kb(Bb-1)+i-4).attr("font-size",o).attr("font-weight",mc).attr("font-family",p).attr("fill",lc).text(Ca)))}else fc=Da[e].expressionData,fc.p||0===fc.p?(Ca=fc.p,"failed"!==Ca&&(lc="#aaa",mc="normal",kc=parseFloat(Ca),.05>kc&&(lc="#666",mc="bold"),Ca=kc<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+Ca,mb.append("text").attr("x",jb(d)+4*ib).attr("y",bb-kb(0)-10-ra/20*i).attr("font-size",o).attr("font-weight",mc).attr("font-family",p).attr("fill",lc).text(Ca))):fc.r&&(gc=fc.r,"failed"!==gc&&(Ca=parseFloat(fc.rp),hc=formatCorrelation(gc,Ca),ic="#aaa",jc="normal",.05>Ca&&(ic="#666",jc="bold"),mb.append("text").attr("x",jb(d)+4*ib).attr("y",bb-kb(0)-10-ra/20*i).attr("font-size",o).attr("font-weight",jc).attr("font-family",p).attr("fill",ic).text(hc)));nc=0,mb.append("text").attr("x",-4).attr("y",bb-kb(0)-10-ra/20*i*3-10-(i+1)*nc-4).attr("class","clickable").attr("font-size","12px").attr("fill","#aaa").attr("id","sample type").attr("text-anchor","end").text("sample type").on("mouseup",function(){var f=$(this).text();f=f.replace(/\u2192 /,""),f!==e&&updatePlot(a,b,c,d,f)}),"BRCA breast invasive carcinoma"===c&&(nc++,mb.append("text").attr("x",-4).attr("y",bb-kb(0)-10-ra/20*i*3-10-(i+1)*nc).attr("class","clickable").attr("font-size","12px").attr("fill","#aaa").attr("id","PAM50 subtype").attr("text-anchor","end").text("PAM50 subtype").on("mouseup",function(){var f=$(this).text();f=f.replace(/\u2192 /,""),f!==e&&updatePlot(a,b,c,d,f)}));for(na in da)nc++,na=na.replace(/_/g," "),mb.append("text").attr("x",-4).attr("y",bb-kb(0)-10-ra/20*i*3-10-(j+1)*nc-4).attr("class","clickable").attr("font-size","12px").attr("fill","#aaa").attr("id",na.replace(/ /g,"_")).attr("text-anchor","end").text(na).on("mouseup",function(){var f=$(this).text();f=f.replace(/ /g,"_"),f=f.replace(/\u2192_/,""),f!==e&&updatePlot(a,b,c,d,f)}),Aa=na.replace(/ /g,"_"),Aa!==e&&"expressionData"!==e&&(fc=Da[e][Aa],fc.p||0===fc.p?(Ca=fc.p,"failed"!==Ca&&(lc="#aaa",mc="normal",kc=parseFloat(Ca),.05>kc&&(lc="#666",mc="bold"),Ca=kc<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+Ca,mb.append("text").attr("x",jb(d)+4*ib).attr("y",bb-kb(0)-10-ra/20*i*3-10-(j+1)*nc-4).attr("font-size",o).attr("font-weight",mc).attr("font-family",p).attr("fill",lc).text(Ca))):fc.r&&(gc=fc.r,"failed"!==gc&&(Ca=parseFloat(fc.rp),hc=formatCorrelation(gc,Ca),ic="#aaa",jc="normal",.05>Ca&&(ic="#666",jc="bold"),mb.append("text").attr("x",jb(d)+4*ib).attr("y",bb-kb(0)-10-ra/20*i*3-10-(j+1)*nc-4).attr("font-size",o).attr("font-weight",jc).attr("font-family",p).attr("fill",ic).text(hc))))}var Ac;if("no_data"!==a.slide){oc=0;a.slide.numberOfSlideFields;qa=[];for(ja in za)if(fa=za[ja],"no_data"!==wa[fa]){for(Ac in wa[fa])-1===$.inArray(Ac,qa)&&qa.push(Ac);break}for(ja in za){if(fa=za[ja],"no_data"!==wa[fa]){var Bc;Bc=oc%2===0?G:H,pc=ba-pa;for(Ac in wa[fa])pc++,slideFieldValue=wa[fa][Ac],"undefined"!=typeof wa[fa][Ac]&&(qc=j/100*slideFieldValue,wb=bb-kb(0)-10-ra/20*i*3-10-(j+1)*pc+(j-qc),mb.append("rect").attr("fill",Bc).attr("x",jb(oc)).attr("y",wb).attr("width",ib).attr("height",qc).attr("class",Ac))}else{pc=ba-pa;for(rc in qa)pc++,mb.append("rect").attr("fill",x).attr("x",jb(oc)).attr("y",bb-kb(0)-10-ra/20*i*3-10-(j+1)*pc-1).attr("width",ib).attr("height",j+1).attr("class",qa[rc])}oc++}pc=ba-pa;for(rc in qa)sc=qa[rc],na=sc.replace(/_/g," "),mb.append("text").attr("x",-4).attr("y",bb-kb(0)-10-ra/20*i*3-10-(j+1)*pc-4).attr("class",sc+" clickable").attr("font-size","12px").attr("fill","#aaa").attr("id",sc).attr("text-anchor","end").text(na).on("mouseup",function(){var f=$(this).text();f=f.replace(/ /g,"_"),f=f.replace(/\u2192_/,""),f!==e&&updatePlot(a,b,c,d,f)});pc=ba-pa;for(rc in qa)sc=qa[rc],sc!==e&&"expressionData"!==e&&(fc=Da[e][sc],fc.r?(gc=fc.r,"failed"!==gc&&(Ca=parseFloat(fc.rp),hc=formatCorrelation(gc,Ca),ic="#aaa",jc="normal",.05>Ca&&(ic="#666",jc="bold"),mb.append("text").attr("x",jb(oc)+4*ib).attr("y",bb-kb(0)-10-ra/20*i*3-10-(j+1)*pc-4).attr("class",sc).attr("font-size",o).attr("font-weight",jc).attr("font-family",p).attr("fill",ic).text(hc))):(fc.p||0===fc.p)&&(Ca=fc.p,"failed"!==Ca&&(lc="#aaa",mc="normal",kc=parseFloat(Ca),.05>kc&&(lc="#666",mc="bold"),Ca=kc<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+Ca,mb.append("text").attr("x",jb(d)+4*ib).attr("y",bb-kb(0)-10-ra/20*i*3-10-(j+1)*pc-4).attr("class",sc).attr("font-size",o).attr("font-weight",mc).attr("font-family",p).attr("fill",lc).text(Ca)))),pc++}document.getElementById(e).setAttribute("font-weight","bold"),document.getElementById(e).setAttribute("font-size","13px"),document.getElementById(e).setAttribute("fill","rgb(100,100,100)");var Cc=e.replace(/_/g," ");Cc=Cc.replace(/Data/,"");var Dc=document.getElementById(e).firstChild;Dc.nodeValue="► "+Cc,mb.append("text").attr("x",gb+eb-12).attr("y",bb-kb(0)-10-ra/20*i*3-10-(j+1)*ba-14).attr("font-size",o).attr("font-family",p).attr("text-anchor","end").attr("fill","#aaa").text("comparison to: "+Cc),mb.append("line").attr("x1",gb+eb-12).attr("x2",gb+eb-12-6.6*Cc.length).attr("y1",bb-kb(0)-10-ra/20*i*3-10-(j+1)*ba-10).attr("y2",bb-kb(0)-10-ra/20*i*3-10-(j+1)*ba-10).style("stroke","#aaa").attr("stroke-width",1).attr("shape-rendering","crispEdges");var Ec=a.geneInfo.ensembl,Fc=a.geneInfo.hgnc,Gc=a.geneInfo.chr,Hc=a.geneInfo.start;Hc=Hc.toString();for(var Ic="";Hc.length>=3;)Ic=Hc.substring(Hc.length-3)+","+Ic,Hc=Hc.substring(0,Hc.length-3);Ic=Hc+","+Ic,Ic=Ic.replace(/,$/,""),Ic=Ic.replace(/^,/,"");var Jc=a.geneInfo.end;Jc=Jc.toString();for(var Kc="";Jc.length>=3;)Kc=Jc.substring(Jc.length-3)+","+Kc,Jc=Jc.substring(0,Jc.length-3);Kc=Jc+","+Kc,Kc=Kc.replace(/,$/,""),Kc=Kc.replace(/^,/,"");var Lc="chr"+Gc+":"+Ic+"-"+Kc;""===Fc?$(".plotInfo").html("<p><strong>"+Ec+"</strong> <a href='http://genome.ucsc.edu/cgi-bin/hgTracks?db=hg19&position="+Lc+"' target='_blank' title='This link will take you to the UCSC Genome Browser'>"+Lc+"</a></p>"):$(".plotInfo").html("<p><strong><a href='http://www.genecards.org/cgi-bin/carddisp.pl?gene="+Fc+"' target='_blank' title='This link will take you to the GeneCards.org page for "+Fc+".'>"+Fc+"</a></strong> <span class='ensembl'>"+Ec+"</span> <a href='http://genome.ucsc.edu/cgi-bin/hgTracks?db=hg19&position="+Lc+"' target='_blank' title='This link will take you to the UCSC Genome Browser'>"+Lc+"</a></p>"),$(".plotInfo").append("<div class='promoterSelectionButton noselect'>highlight promoter probes</div>"),$(".promoterSelectionButton").click(function(){$(".prom").each(function(){var a,b=$(this);b.is("path")?b.attr("class").match(/line/)?(a=b.attr("stroke"),a===C?b.attr("stroke",E):b.attr("stroke",C)):(a=b.attr("fill"),a===B?b.attr("fill",D):b.attr("fill",B)):b.is("text")?(a=b.attr("fill"),a===F?b.attr("fill",E):b.attr("fill",F)):b.is("line")&&(a=b.attr("stroke"),a===v?b.attr("stroke",w):b.attr("stroke",v))})}),prepareSvgForDownload(b,c,e)}function checkUserInput(){$("#userInputForm .inputButton").toggleClass("inactive"),removeMessages();var a=$("#gene").val();a=a.replace(/[<>\\\/;'"()=\[\]\{\}]/g,"");var b=$(".sampleSelectionList").find(".selectedSample").text();""===a?($("#userInputForm .inputButton").toggleClass("inactive"),$("#userInputForm .inputButton").click(!0),$("#gene").focus(),$('<div class="warningMessage">Don\'t forget to enter a gene name!</div>').hide().appendTo("#userInputForm").fadeIn(200)):""===b?($("#userInputForm .inputButton").toggleClass("inactive"),$("#userInputForm .inputButton").click(!0),$('<div class="warningMessage">Don\'t forget to select a source!</div>').hide().appendTo("#userInputForm").fadeIn(200)):""!==a&&""!==b&&plotPreparation()}function plotPreparation(){removeMessages();var a=$("#gene").val();a=a.replace(/[<>\\\/;'"()=\[\]\{\}]/g,"");var b=$(".sampleSelectionList").find(".selectedSample").find(".sourceName").text(),c=$(".sampleSelectionList").find(".selectedSample").find(".fullSourceName").attr("title"),d=b+" "+c;$(".downloadButton").remove(),$(".loadingAnimation").show(),$(".plotContainer").css("background","#FFF"),$(".plotContainer").css("border","none"),$(".plotWindow").toggleClass("transparent"),$(".plotInfo").toggleClass("transparent"),$("svg").length&&($(".plotInfo").empty(),$(".plotWindow").empty());$.ajax({type:"POST",url:"php/numberOfSamples.php?source="+d,dataType:"json",success:function(b){var c=b.nrow;$('<div class="infoMessage">'+c+" samples selected</div>").hide().appendTo("#userInputForm").fadeIn(500),createNewPlot(a,d,c)},error:function(){$('<div class="errorMessage">Database error.<br>(could not retrieve the number of samples)</div>').hide().appendTo("#userInputForm").fadeIn(500),$(".plotWindow").toggleClass("hidden"),$("#userInputForm .inputButton").toggleClass("inactive"),$(".loadingAnimation").hide(),$(".plotContainer").css("background","#f6f6f6"),$(".plotContainer").css("border","4px solid #efefef")}})}function removeMessages(){$(".errorMessage").length>0&&$(".errorMessage").remove(),$(".warningMessage").length>0&&$(".warningMessage").remove(),$(".infoMessage").length>0&&$(".infoMessage").remove()}function numberOfLevels(a){var b=[];for(var c in a){var d=a[c];-1===$.inArray(d,b)&&null!==d&&void 0!==d&&b.push(d)}var e=b.length;return e}$(function(){$(window).scroll(function(){$("header").css({left:$(this).scrollLeft()})}),$("input[type=text]").focus(),windowWidth=$(window).width(),inputWidth=$(".userInput").outerWidth(),plotWidth=windowWidth-inputWidth-28,$(".plotContainer").width(plotWidth);var a,b;$(function(){a={serviceUrl:"php/autocomplete.php",minChars:1,maxHeight:200,deferResquestBy:0},b=$("#gene").autocomplete(a)}),$(".sampleSelectionElement").click(function(){var a=$(this);$(".sampleSelectionElement").each(function(){$(this).hasClass("selectedSample")&&$(this).toggleClass("selectedSample")}),a.toggleClass("selectedSample")})});