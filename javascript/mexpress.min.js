function prepareSvgForDownload(t,a,r){$(".downloadButton").remove(),$(".downloadText").remove(),$(".plotInfo p").append("<div class='download'></div>"),$(".download").append("<div class='downloadButton png'>png</div>"),$(".download").append("<div class='downloadButton svg'>svg</div>"),$(".download").append("<div class='downloadText'>download a png or svg version of the figure</div>"),$(".downloadButton").css("visibility","visible").hide().fadeIn(1e3),$(".downloadButton").mouseenter(function(){$(".downloadText").css("visibility","visible").hide().fadeIn(100)}).mouseleave(function(){$(".downloadText").css("visibility","hidden")}),$(".downloadButton.png").click(function(){var e=d3.select("svg").attr("version",1.1).attr("xlmns","http://www.w3.org/2000/svg").node().parentNode.innerHTML;$(this).html("<img src='images/arrowLoader.gif'>"),downloadSvg(t,a,r,e,"png")}),$(".downloadButton.svg").click(function(){var e=d3.select("svg").attr("version",1.1).attr("xlmns","http://www.w3.org/2000/svg").node().parentNode.innerHTML;$(this).html("<img src='images/arrowLoader.gif'>"),downloadSvg(t,a,r,e,"svg")})}function createDownloadLink(t,a){var r=t.replace(/^.+\//,""),e=document.createElement("a");e["class"]="downloadLink",e.download=r,e.target="_blank",e.href=t,document.body.appendChild(e),e.click(),"png"===a?$(".downloadButton.png").html("png"):"svg"===a&&$(".downloadButton.svg").html("svg")}function downloadSvg(t,a,r,e,n){var o=encodeURIComponent(e),i=$(".containsProbeId").attr("id"),l="";if(void 0!==i){var l=i.replace(/^.+?_/,"");l=l.replace(/_.+$/,"")}$.ajax({data:"fileType="+n+"&gene="+t+"&source="+a+"&sorter="+r+"&probe="+l+"&svgHtml="+o,url:"php/svg2png.php",method:"POST",success:function(t){var a=t;a="php/"+a,createDownloadLink(a,n)}})}function pAdjust(t,a){if("bh"===a){for(var r=t.length,e=[],n=r;n>0;n--)e.push(n);for(var o=[],n=0;r>n;n++)o[n]=[t[n],n];for(var i,l=nestedArraySort(o,!0,0),n=0;r>n;n++){var s=l[n][0]*r/e[n];0!==n?i>s?i=s:s=i:i=s,s>1&&(s=1),l[n][0]=s}l=nestedArraySort(l,!1,1),result=[];for(var e=0;e<l.length;e++)result.push(l[e][0]);return result}}function pearsonCorrelation(t,a){if(t.length!==a.length)return"failed";var r=[],e=[];for(var n in a)isNaN(a[n])||isNaN(t[n])||(e.push(+a[n]),r.push(+t[n]));if(e.length>10){var o=e.length,i=0,l=0,s=0,p=0,d=0;for(var n in e)i+=r[n],s+=Math.pow(r[n],2),l+=e[n],p+=Math.pow(e[n],2),d+=r[n]*e[n];var f=d-i*l/o,v=Math.sqrt(s-Math.pow(i,2)/o)*Math.sqrt(p-Math.pow(l,2)/o),c=f/v,h=e.length-2,u=Math.abs(c/Math.sqrt((1-Math.pow(c,2))/h)),n=tDistribution(h,u);return{r:c,p:n}}return"failed"}function mean(t){for(var a=t.length,r=0,e=0;a>e;e++)r+=t[e];var n=r/a;return n}function variance(t){for(var a=t.length,r=mean(t),e=0,n=0;a>n;n++)e+=Math.pow(t[n]-r,2);var o=e/a;return o}function degreesOfFreedom(t,a){var r=t.length,e=a.length,n=variance(t),o=variance(a),i=Math.pow(n/r+o/e,2),l=Math.pow(n/r,2)/(r-1)+Math.pow(o/e,2)/(e-1),s=i/l;return s}function tDistribution(t,a){var r=.049867347,e=.0211410061,n=.0032776263,o=380036e-10,i=488906e-10,l=5383e-9,s=a*(1-1/(4*t))/Math.sqrt(1+Math.pow(a,2)/(2*t)),p=2*(1/(2*Math.pow(1+r*s+e*Math.pow(s,2)+n*Math.pow(s,3)+o*Math.pow(s,4)+i*Math.pow(s,5)+l*Math.pow(s,6),16)));return p}function tTest(t,a){for(var r in t)isNaN(t[r])&&(t[r]=null);for(var r in a)isNaN(a[r])&&(a[r]=null);if(t.some(function(t){return null!==t})){if(a.some(function(t){return null!==t})){var e=t.length,n=a.length;if(e>=3&&n>=3){var o=mean(t),i=mean(a),l=variance(t),s=variance(a),p=(o-i)/Math.sqrt(l/e+s/n);p=Math.abs(p);var d=degreesOfFreedom(t,a),f=tDistribution(d,p);return f}return"failed"}return"failed"}return"failed"}function nestedArraySort(t,a,r){return a?t.sort(function(t,a){return t=t[r],a=a[r],t===a?0:t>a?-1:1}):t.sort(function(t,a){return t=t[r],a=a[r],t===a?0:a>t?-1:1}),t}function wilcoxonRankSumTest(t,a){var r=[],e=[];for(var n in t)t[n]&&"null"!==t[n]&&r.push(+t[n]);for(var n in a)a[n]&&"null"!==a[n]&&e.push(+a[n]);var o=r.length,i=e.length;if(3>o||3>i)return"failed";var l=o*i/2,s=Math.sqrt(o*i*(o+i+1)/12),p=[];for(var n in r)p.push([r[n],1]);for(var n in e)p.push([e[n],2]);var d=nestedArraySort(p,!1,0),f=[],v=[];for(var n in d)f.push(d[n][0]),v.push(d[n][1]);var c=[];for(var n in d){var h=d[n][0],u=f.indexOf(h)+1;c.push(u)}var x=0,g=0;for(var n in v){var m=v[n];1===m?x+=c[n]:g+=c[n]}var y=o*i+o*(o+1)/2-x,w=(y-l)/s;w=Math.abs(w);var r=w/Math.sqrt(2),b=1/(1+.5*r),$=b*Math.exp(-Math.pow(r,2)-1.26551223+1.00002368*b+.37409196*Math.pow(b,2)+.09678418*Math.pow(b,3)-.18628806*Math.pow(b,4)+.27886807*Math.pow(b,5)-1.13520398*Math.pow(b,6)+1.48851587*Math.pow(b,7)-.82215223*Math.pow(b,8)+.17087277*Math.pow(b,9)),k=1-$,F=2*(1-.5*(1+k));return F}function createNewPlot(t,a,r){d3.json("php/geneNameQuery.php?gene="+t+"&source="+a,function(e,n){var o=n,i=o.success;if(i){var l="expressionData";createPlot(o,t,a,r,l)}else{var s=o.message;$('<div class="errorMessage">'+s+"</div>").hide().appendTo("#userInputForm").fadeIn(200),$(".plotWindow").toggleClass("hidden"),$(".plotContainer").css("background","#F6F6F6"),$(".plotContainer").css("border-bottom","4px solid #EFEFEF;")}$(".loadingAnimation").hide(),$(".plotWindow").toggleClass("transparent"),$(".plotInfo").toggleClass("transparent"),$("#userInputForm .inputButton").toggleClass("inactive"),$("#extraSelectionForm .inputButton").toggleClass("inactive")})}function formatCorrelation(t,a){var r=t.toPrecision(3);return t>0&&(r="+"+r),r="r = "+r,.001>a?r+=" ***":.01>a?r+=" **":.05>a&&(r+=" *"),r}function sortData(t,a){var r=[],e=[];for(var n in t.expressionData)e.push(n);var o=e;if("expressionData"===a){var i=[];for(var n in t.expressionData){var l=t.expressionData[n];i.push({key:n,val:l})}i.sort(function(t,a){return a.val-t.val});for(var s in i)r.push(i[s].key)}else if("sample type"===a){var d=[];for(var n in t.expressionData){var f=n.replace(/^.+_(\d\d)$/,"$1");d.push({key:n,val:f})}d.sort(function(t,a){return a.val-t.val});for(var s in d)r.push(d[s].key)}else if("PAM50 subtype"===a){var d=[],v=[];for(var c in e){var n=e[c];n in t.pam50?d.push({key:n,val:t.pam50[n]}):v.push(n)}d.sort(function(t,a){var r=t.val.toLowerCase(),e=a.val.toLowerCase();return e>r?-1:r>e?1:0});for(var s in d)r.push(d[s].key);r=r.concat(v)}else{for(p in t.annotation){var h=t.annotation[p];break}for(c in t.slide){var u=t.slide[c];break}if(a in h){var x="annotation",g=[],m=[];for(var c in t[x])if("numberOfAnnotationFields"!=c){var y=t[x][c][a];null!==y?(y=+y,g.push({key:c,val:y})):m.push({key:c,val:y})}g.sort(function(t,a){return a.val-t.val}),g=g.concat(m);for(var s in g)for(var w=g[s].key,b=RegExp(w),k=e.length-1;k>=0;k--){var F=e[k],C=F.match(b);if(null!=C){r.push(F);var M=$.inArray(F,o);o.splice(M,1)}}r=r.concat(o)}else if(a in u){var x="slide",g=[],m=[];for(var c in t[x])if("numberOfSlideFields"!==c){var y=t[x][c][a];null!==y?(y=+y,g.push({key:c,val:y})):m.push({key:c,val:y})}g.sort(function(t,a){return a.val-t.val}),g=g.concat(m);for(var s in g)for(var n=g[s].key,k=e.length-1;k>=0;k--)e[k]===n&&(r.push(n),e.splice(k,1));r=r.concat(e)}}return r}function updatePlot(t,a,r,e,n){$(".plotInfo").empty(),$(".plotWindow").empty(),createPlot(t,a,r,e,n)}function createPlot(t,a,r,e,o){windowWidth=$(window).width(),inputWidth=$(".userInput").outerWidth(),plotWidth=windowWidth-inputWidth-28;var i=18,l=14,s=4,p=3,d=2,f="11px",v="Courier New",c="#F59322",h="#4BC722",u="#FFEDC2",x="#FFC842",g="#999",m="#ACD2F2",y="#1A70BA",w="#F9F9F9",b="#FFD57A",k="#F59322",F="#FFD161",C="#AAD5FA",M="#4999DE",D="#63ACEB",A="#14568F",_="#b6d3f2",I="#DCE1E6",S="#C5CCD4",B="#FA89CA",P="#F272BB",z="#98D3FA",E="#7FC3F0",L="#98D3FA",T="#4999DE",W="#944E07",N="#693705",O="#73CC5B",R="#37AC19",q={Normal:"#4999DE",Basal:"#FFC03B",Her2:"#FF983B",LumA:"#73CC5B",LumB:"#37AC19","no data":w},j={"01":"primary solid tumor","02":"recurrent solid tumor","03":"primary blood derived cancer - peripheral blood","04":"recurrent blood derived cancer - bone marrow","05":"additional - new primary","06":"metastatic","07":"additional metastatic","08":"human tumor original cells","09":"primary blood derived cancer - bone marrow",10:"blood derived normal",11:"solid tissue normal",12:"buccal cell normal",13:"EBV immortalized normal",14:"bone marrow normal",20:"control analyte",40:"recurrent blood derived cancer - peripheral blood",50:"cell lines",60:"primary xenograft tissue",61:"cell line derived xenograft tissue"},H={"01":"#98D3FA","02":"#F7A972","03":"#F2766F","04":"#DB7346","05":"#3FD19B","06":"#FFD161","07":"#D13F75","08":"#6FF0F2","09":"#F29B6F",10:"#9DC9F5",11:"#4999DE",12:"#4198F0",13:"#0F73D6",14:"#90D8F5",20:"#46BFF0",40:"#DB4E46",50:"#F07746",60:"#A17FAD",61:"#8A38A8"},V=t.numberOfProbes,U=t.geneInfo,G=+U.start,Q=+U.end,J=U.strand,K=t.transcripts,X=t.cpgi,Y=0,Z=!1,tt=new Object,at=[];n=+t.annotation.numberOfAnnotationFields,n>Y&&(Y=n);for(var rt in t.annotation)for(var et in t.annotation[rt]){-1===$.inArray(et,at)&&at.push(et),"gender"===et&&(Z=!0);var nt=parseFloat(t.annotation[rt][et]);isNaN(nt)?tt.hasOwnProperty(et)||(tt[et]=0):tt.hasOwnProperty(et)?nt>tt[et]&&(tt[et]=nt):tt[et]=nt}Y++;var ot=0,it=[];if("no_data"!==t.slide){n=+t.slide.numberOfSlideFields,n>ot&&(ot=n);for(rt in t.slide)if("numberOfSlideFields"!==rt){for(var lt in t.slide[rt])it.push(lt);break}}Y+=ot,"BRCA breast invasive carcinoma"===r&&Y++;var st=0;for(var rt in t.expressionData)expr=+t.expressionData[rt],expr>st&&(st=expr);var pt=sortData(t,o),dt=[],ft=[],vt=[],ct=[],ht=[];for(var rt in t.methylationData){for(var ut in t.methylationData[rt])ht.push(ut);break}var xt={};for(var ut in ht)xt[ht[ut]]=[];var gt=[];for(var mt in pt){var rt=pt[mt];if(t.methylationData[rt]){gt.push(rt),dt[rt]=t.methylationData[rt];for(var ut in ht)xt[ht[ut]].push(t.methylationData[rt][ht[ut]]);var yt=rt.replace(/_\d\d$/,"");t.annotation[yt]?vt[yt]=t.annotation[yt]:vt[yt]="no_annotation",t.slide[rt]?ct[rt]=t.slide[rt]:ct[rt]="no_data";var wt=t.expressionData[rt];ft[rt]=wt}}var bt={};bt.expressionData={},bt["sample type"]={},bt["PAM50 subtype"]={};for(var rt in t.annotation){for(var $t in t.annotation[rt])bt[$t]={};break}for(var rt in t.slide){for(var $t in t.slide[rt])bt[$t]={};break}for(var lt in bt){var kt={},Ft=[];if("expressionData"===lt)kt=t[lt];else if(-1!==$.inArray(lt,at))for(var yt in t.annotation)kt[yt]=t.annotation[yt][lt];else if(-1!==$.inArray(lt,it))for(var rt in t.slide)kt[rt]=t.slide[rt][lt];else if("sample type"===lt)for(var mt in gt){var rt=gt[mt],Ct=rt.replace(/^.+_(\d\d)$/,"$1");"10"===Ct||"11"===Ct||"12"===Ct||"13"===Ct||"14"===Ct?kt[rt]="1":kt[rt]="0"}else if("PAM50 subtype"===lt)for(var mt in gt){var rt=gt[mt];rt in t.pam50?kt[rt]=t.pam50[rt]:kt[rt]="no data"}for(var Mt in kt)Ft.push(kt[Mt]);var Dt=numberOfLevels(Ft);if("expressionData"!==lt)if(2===Dt){var At=[],_t=[];for(var rt in ft){var yt=rt.replace(/_\d\d$/,"");if("no_annotation"!==vt[yt]){if("sample type"!==lt)var nt=vt[yt][lt];else var nt=kt[rt];"1"===nt?At.push(ft[rt]):"0"===nt&&_t.push(ft[rt])}}var It=wilcoxonRankSumTest(At,_t);bt[lt].expressionData={p:It}}else if(Dt>2&&"PAM50 subtype"!==lt&&"eye_color"!==lt&&"batch number"!==lt){var At=[],_t=[];for(var mt in gt){var rt=gt[mt];if(At.push(ft[rt]),-1!==$.inArray(lt,at)){var yt=rt.replace(/_\d\d$/,"");_t.push(kt[yt])}else _t.push(kt[rt])}var It=pearsonCorrelation(At,_t);bt[lt].expressionData={r:It.r,rp:It.p}}else bt[lt].expressionData={n:"no normals"};for(var St in ht)if(2===Dt){var At=[],_t=[];for(var mt in gt){var rt=gt[mt],yt=rt.replace(/_\d\d$/,"");if("no_annotation"!==vt[yt]){if("sample type"!==lt)var nt=vt[yt][lt];else var nt=kt[rt];"1"===nt?At.push(dt[rt][ht[St]]):"0"===nt&&_t.push(dt[rt][ht[St]])}}var It=wilcoxonRankSumTest(At,_t);bt[lt][ht[St]]={p:It}}else if(Dt>2&&"PAM50 subtype"!==lt&&"eye_color"!==lt&&"batch number"!==lt){var At=[],_t=[];for(var mt in gt){var rt=gt[mt];if(At.push(dt[rt][ht[St]]),-1!==$.inArray(lt,at)){var yt=rt.replace(/_\d\d$/,"");_t.push(kt[yt])}else _t.push(kt[rt])}var It=pearsonCorrelation(At,_t);bt[lt][ht[St]]={r:It.r,rp:It.p}}else bt[lt][ht[St]]={n:"failed"};for(var Bt in at){var Pt=at[Bt];if(Pt!==lt){var zt=[];for(var St in vt)zt.push(vt[St][Pt]);var Et=numberOfLevels(zt);if(2===Dt)if(2===Et)bt[lt][Pt]={n:"failed"};else if(Et>2){var At=[],_t=[];for(var mt in gt){var rt=gt[mt],yt=rt.replace(/_\d\d$/,"");if("no_annotation"!==vt[yt]){if("sample type"!==lt)var nt=vt[yt][lt];else var nt=kt[rt];"1"===nt?At.push(vt[yt][Pt]):"0"===nt&&_t.push(vt[yt][Pt])}}var It=wilcoxonRankSumTest(At,_t);bt[lt][Pt]={p:It}}else bt[lt][Pt]={n:"failed"};else if(Dt>2&&"PAM50 subtype"!==lt&&"eye_color"!==lt&&"batch number"!==lt)if(2===Et){var At=[],_t=[];for(var mt in gt){var rt=gt[mt],yt=rt.replace(/_\d\d$/,"");if("no_annotation"!==vt[yt]){var nt=vt[yt][Pt];"1"===nt?-1!==$.inArray(lt,at)?kt[yt]&&At.push(kt[yt]):kt[rt]&&At.push(kt[rt]):"0"===nt&&(-1!==$.inArray(lt,at)?kt[yt]&&_t.push(kt[yt]):kt[rt]&&_t.push(kt[rt]))}}var It=wilcoxonRankSumTest(At,_t);bt[lt][Pt]={p:It}}else if(Et>2){var At=[],_t=[];for(var mt in gt){var rt=gt[mt],yt=rt.replace(/_\d\d$/,"");-1!==$.inArray(lt,at)?kt[yt]&&(At.push(kt[yt]),_t.push(vt[yt][Pt])):kt[rt]&&(At.push(kt[rt]),_t.push(vt[yt][Pt]))}var It=pearsonCorrelation(At,_t);bt[lt][Pt]={r:It.r,rp:It.p}}else bt[lt][Pt]={n:"failed"};else bt[lt][Pt]={n:"failed"}}}for(var mt in it){var Pt=it[mt];if(Pt!==lt)if(2===Dt){var At=[],_t=[];for(var mt in gt){var rt=gt[mt],yt=rt.replace(/_\d\d$/,"");if("sample type"!==lt)var nt=vt[yt][lt];else var nt=kt[rt];"1"===nt?At.push(ct[rt][Pt]):"0"===nt&&_t.push(ct[rt][Pt])}var It=wilcoxonRankSumTest(At,_t);bt[lt][Pt]={p:It}}else if(Dt>2&&"PAM50 subtype"!==lt&&"eye_color"!==lt&&"batch number"!==lt){var At=[],_t=[];for(var mt in gt){var rt=gt[mt],yt=rt.replace(/_\d\d$/,"");-1!==$.inArray(lt,at)?kt[yt]&&(At.push(kt[yt]),_t.push(ct[rt][Pt])):(At.push(kt[rt]),_t.push(ct[rt][Pt]))}var It=pearsonCorrelation(At,_t);bt[lt][Pt]={r:It.r,rp:It.p}}else bt[lt][Pt]={n:"failed"}}if("sample type"!==lt){var Lt={},Tt=[];for(var mt in gt){var rt=gt[mt],Ct=rt.replace(/^.+_(\d\d)$/,"$1");"10"===Ct||"11"===Ct||"12"===Ct||"13"===Ct||"14"===Ct?(Lt[rt]="1",Tt.push("1")):(Lt[rt]="0",Tt.push("0"))}var Wt=numberOfLevels(Tt);if(2===Wt){if(2===Dt)bt[lt]["sample type"]={n:"failed"};else if(Dt>2&&"PAM50 subtype"!==lt&&"eye_color"!==lt&&"batch number"!==lt){var At=[],_t=[];for(var mt in gt){var rt=gt[mt],yt=rt.replace(/_\d\d$/,""),Nt=Lt[rt];"1"===Nt?-1!==$.inArray(lt,at)?kt[yt]&&At.push(kt[yt]):kt[rt]&&At.push(kt[rt]):"0"===Nt&&(-1!==$.inArray(lt,at)?kt[yt]&&_t.push(kt[yt]):kt[rt]&&_t.push(kt[rt]))}var It=wilcoxonRankSumTest(At,_t);bt[lt]["sample type"]={p:It}}}else bt[lt]["sample type"]={n:"no normal samples"}}}var Ot=[],Rt=[];for(var Mt in bt[o]){var qt=bt[o][Mt];qt.rp&&"failed"!==qt.rp?(Ot.push(qt.rp),Rt.push(Mt)):qt.p&&"failed"!==qt.p&&(Ot.push(qt.p),Rt.push(Mt))}correctedPValues=pAdjust(Ot,"bh");for(var jt=0;jt<correctedPValues.length;jt++){var St=correctedPValues[jt];St=+St.toPrecision(3);var Ht=1e3*St;1>Ht&&(St=St.toExponential());var qt=Rt[jt];bt[o][qt].rp?bt[o][qt].rp=St:bt[o][qt].p&&(bt[o][qt].p=St)}Fa=0;for(key in K)K.hasOwnProperty(key)&&Fa++;$a=0;for(key in X)X.hasOwnProperty(key)&&$a++;var Vt=8+4*Fa;$a>0&&(Vt+=5);var Ut=Math.abs(G-Q);legendHeight=148;var Gt=[];if("no_annotation"!==t.annotation)for(var mt in gt){var rt=gt[mt],Ct=rt.replace(/^.+_(\d\d)$/,"$1");-1===$.inArray(Ct,Gt)&&Gt.push(Ct)}Gt.length>7&&(legendHeight=148+18*Gt.length);var Qt=10+st/20*i*3+10+(l+1)*Y+20+legendHeight,Jt=170+Vt,Kt=110,Xt={top:Qt,left:Jt,bottom:20,right:Kt},Yt=plotWidth-Jt-Kt,Zt=600;if(Z&&(Zt=750),Zt>Yt&&(Yt=Zt),10>V)var ta=10*i;else if(Ut>1e5&&40>V)var ta=40*i;else var ta=V*i;var aa=Math.floor(Yt/e);1>aa?aa=1:aa>6&&(aa=6),Yt=aa*e;var ra=d3.scale.linear().range([0,Yt]),ea=d3.scale.linear().range([ta,0]),na=(d3.svg.axis().scale(ra).orient("top"),d3.svg.line().defined(function(t){return null!=t}).x(function(t,a){return ra(a)+aa/2}).y(function(t){return t}));$(".plotWindow").removeClass("hidden");var oa=d3.select(".plotWindow").append("svg").attr("width",Yt+Xt.left+Xt.right).attr("height",ta+Xt.top+Xt.bottom).attr("text-rendering","geometricPrecision").attr("font-family","arial").attr("font-size","12px").attr("fill","#666").append("g").attr("transform","translate("+Xt.left+","+Xt.top+")");ra.domain([0,e]),ea.domain([0,V]);var ia=1e3;Ut/10>1e3&&(ia=Ut/10),ia>5e3&&(ia=5e3);var la=G-ia,sa=Q+ia,pa=(sa-la)/V,da=(G-la)/pa,fa=(Q-la)/pa;if("1"===J)var va=G-1e3,ca=G+500;else var va=Q-500,ca=Q+1e3;var ha=-Jt+1,ua=-Qt+24;if(oa.append("text").attr("x",ha).attr("y",ua).attr("font-weight","bold").text("annotation"),oa.append("rect").attr("fill",c).attr("x",ha).attr("y",ua+8).attr("width",3).attr("height",12),oa.append("text").attr("x",ha+8).attr("y",ua+18).text("gene"),oa.append("rect").attr("fill",u).attr("x",ha).attr("y",ua+8+18).attr("width",3).attr("height",12),oa.append("text").attr("x",ha+8).attr("y",ua+36).text("transcript"),oa.append("rect").attr("fill",h).attr("x",ha).attr("y",ua+8+36).attr("width",3).attr("height",12),oa.append("text").attr("x",ha+8).attr("y",ua+54).text("CpG island"),ha+=90,oa.append("text").attr("x",ha).attr("y",ua).attr("font-weight","bold").text("data"),oa.append("rect").attr("fill",b).attr("x",ha).attr("y",ua+8).attr("width",3).attr("height",12),oa.append("text").attr("x",ha+8).attr("y",ua+18).text("RNA-seq v2 (log2)"),oa.append("rect").attr("fill",C).attr("x",ha).attr("y",ua+8+18).attr("width",3).attr("height",12),oa.append("text").attr("x",ha+8).attr("y",ua+36).text(t.platform),oa.append("rect").attr("fill",I).attr("x",ha).attr("y",ua+8+36).attr("width",3).attr("height",12),oa.append("text").attr("x",ha+8).attr("y",ua+54).text("slide/clinical data"),oa.append("rect").attr("fill",w).attr("x",ha).attr("y",ua+8+54).attr("width",3).attr("height",12),oa.append("text").attr("x",ha+8).attr("y",ua+72).text("missing data"),ha+=120,Z&&(oa.append("text").attr("x",ha).attr("y",ua).attr("font-weight","bold").text("gender"),oa.append("rect").attr("fill",B).attr("x",ha).attr("y",ua+8).attr("width",3).attr("height",12),oa.append("text").attr("x",ha+8).attr("y",ua+18).text("female"),oa.append("rect").attr("fill",z).attr("x",ha).attr("y",ua+8+18).attr("width",3).attr("height",12),oa.append("text").attr("x",ha+8).attr("y",ua+36).text("male"),ha+=70),oa.append("text").attr("x",ha).attr("y",ua).attr("font-weight","bold").text("statistics"),oa.append("text").attr("x",ha).attr("y",ua+18).attr("font-size","14px").attr("font-family",v).text("p"),oa.append("text").attr("x",ha+16).attr("y",ua+18).text("Wilcoxon rank-sum test"),oa.append("text").attr("x",ha+16).attr("y",ua+18+14).attr("font-weight","bold").attr("font-size","11px").attr("font-family",v).text("p < 0.05"),oa.append("text").attr("x",ha+16+72).attr("y",ua+18+14).attr("fill","#aaa").attr("font-size","11px").attr("font-family",v).text("p ≥ 0.05"),oa.append("text").attr("x",ha).attr("y",ua+54).attr("font-size","14px").attr("font-family",v).text("r"),oa.append("text").attr("x",ha+16).attr("y",ua+54).text("Pearson correlation"),oa.append("text").attr("x",ha+16).attr("y",ua+54+14).attr("font-weight","bold").attr("font-size","11px").attr("font-family",v).text("***"),oa.append("text").attr("x",ha+16+32).attr("y",ua+54+14).attr("font-weight","bold").attr("font-size","11px").attr("font-family",v).text("p < 0.001"),oa.append("text").attr("x",ha+16).attr("y",ua+54+28).attr("font-weight","bold").attr("font-size","11px").attr("font-family",v).text("**"),oa.append("text").attr("x",ha+16+32).attr("y",ua+54+28).attr("font-weight","bold").attr("font-size","11px").attr("font-family",v).text("p < 0.01"),oa.append("text").attr("x",ha+16).attr("y",ua+54+42).attr("font-weight","bold").attr("font-size","11px").attr("font-family",v).text("*"),oa.append("text").attr("x",ha+16+32).attr("y",ua+54+42).attr("font-weight","bold").attr("font-size","11px").attr("font-family",v).text("p < 0.05"),oa.append("text").attr("x",ha+16+32).attr("y",ua+54+56).attr("fill","#aaa").attr("font-size","11px").attr("font-family",v).text("p ≥ 0.05"),ha+=160,"BRCA breast invasive carcinoma"===r){oa.append("text").attr("x",ha).attr("y",ua).attr("font-weight","bold").text("BRCA subtype");var jt=0;for(var xa in q)"no data"!==xa&&(oa.append("rect").attr("fill",q[xa]).attr("x",ha).attr("y",ua+8+18*jt).attr("width",3).attr("height",12),oa.append("text").attr("x",ha+8).attr("y",ua+18*(jt+1)).text(xa),jt++);ha+=106}oa.append("text").attr("x",ha).attr("y",ua).attr("font-weight","bold").text("sample type");var ga=0;for(mt in Gt){var Ct=Gt[mt],ma=j[Ct];ma.length>26&&(ma=ma.substring(0,23),ma+="..."),oa.append("rect").attr("fill",H[Ct]).attr("x",ha).attr("y",ua+8+18*ga).attr("width",3).attr("height",12),oa.append("text").attr("x",ha+8).attr("y",ua+18*(ga+1)).text(ma+" ("+Ct+")"),ga++}for(var rt in t.methylationData){var ya=0;for(var ut in t.methylationData[rt]){ya++;var wa="";ut>=va&&ca>=ut&&(wa="prom");var ba=(ut-la)/pa;oa.append("line").attr("x1",-Jt).attr("x2",-Jt+Vt+80).attr("y1",ta-ea(ba)).attr("y2",ta-ea(ba)).attr("stroke",m).attr("stroke-opacity",.5).attr("stroke-width",1).attr("class",wa).attr("id","annotationLine"+ut),oa.append("line").attr("x1",-Jt+Vt+80).attr("x2",ra(1)).attr("y1",ta-ea(ba)).attr("y2",ta-ea(ya-1)+i/2).attr("stroke",m).attr("stroke-opacity",.5).attr("stroke-width",1).attr("class",wa)}break}oa.append("rect").attr("fill",c).attr("x",-Jt+7).attr("y",ta-ea(da)).attr("width",s).attr("height",ea(V-(fa-da))),"1"===J?(oa.append("line").attr("x1",-Jt+4).attr("x2",-Jt+9).attr("y1",ea(V-(fa-da))+ta-ea(da)-7).attr("y2",ea(V-(fa-da))+ta-ea(da)).style("stroke",c).attr("stroke-width",s-1).attr("stroke-linecap","round"),oa.append("line").attr("x1",-Jt+9).attr("x2",-Jt+14).attr("y1",ea(V-(fa-da))+ta-ea(da)).attr("y2",ea(V-(fa-da))+ta-ea(da)-7).style("stroke",c).attr("stroke-width",s-1).attr("stroke-linecap","round")):(oa.append("line").attr("x1",-Jt+4).attr("x2",-Jt+9).attr("y1",ta-ea(da)+7).attr("y2",ta-ea(da)).style("stroke",c).attr("stroke-width",s-1).attr("stroke-linecap","round"),oa.append("line").attr("x1",-Jt+9).attr("x2",-Jt+14).attr("y1",ta-ea(da)).attr("y2",ta-ea(da)+7).style("stroke",c).attr("stroke-width",s-1).attr("stroke-linecap","round"));var $a=0;for(var ka in X)$a++,cStart=X[ka].start,cEnd=X[ka].end,cStart<la&&(cStart=la),cEnd>sa&&(cEnd=sa),cStartPlot=(cStart-la)/pa,cEndPlot=(cEnd-la)/pa,oa.append("rect").attr("fill",h).attr("x",-Jt+18).attr("y",ta-ea(cStartPlot)).attr("width",p).attr("height",ea(V-(cEndPlot-cStartPlot)));var Fa=0;for(var Ca in K){Fa++;var Ma=+K[Ca].start,Da=+K[Ca].end,Aa=(Ma-la)/pa,_a=(Da-la)/pa;oa.append("rect").attr("fill",u).attr("x",-Jt+22+6*Fa).attr("y",ta-ea(Aa)).attr("width",d).attr("height",ea(V-(_a-Aa))).html("<title>"+Ca+"</title");var Ia=t.transcripts[Ca].exons;for(var Mt in Ia){var Sa=+Ia[Mt].start,Ba=+Ia[Mt].end;eStartPlot=(Sa-la)/pa,eEndPlot=(Ba-la)/pa,oa.append("rect").attr("fill",x).attr("x",-Jt+22+6*Fa).attr("y",ta-ea(eStartPlot)).attr("width",d).attr("height",ea(V-(eEndPlot-eStartPlot)))}}var Pa=Math.round(Math.log(Ut)/Math.log(10)),za=Math.pow(10,Pa-1);if(1e3>za&&5e3>Ut&&(za=1e3),"1"===J)var Ea=G-za/2,La=G+za/2;else var Ea=Q-za/2,La=Q+za/2;var Ta=(Ea-la)/pa,Wa=(La-la)/pa;oa.append("rect").attr("fill",g).attr("x",-Jt+2).attr("y",ta-ea(Ta)).attr("width",2).attr("id","scaleBar").attr("height",ea(V-(Wa-Ta)));var Na=za/1e3;if(Na+="kb","1"==J)var Oa=ea(Ta)+2;else var Oa=ea(Wa)-10;oa.append("text").attr("x",-Jt+1).attr("y",ta-Oa).attr("font-size","9px").attr("fill",g).text(Na);var Ra=[];for(var mt in gt){var rt=gt[mt],wt=ft[rt];Ra.push(ta-ea(0)-wt/20*i*3-10)}var qa=0;100>e?qa=2:200>e&&(qa=1);var ja=d3.svg.area().defined(function(t){return t}).x(function(t,a){return ra(a)+qa}).y1(function(t){return t}).y0(ta-ea(0)-10);oa.append("path").attr("d",ja(Ra)).attr("fill",b),oa.append("line").attr("x1",ra(1)).attr("x2",ra(e)).attr("y1",ta-ea(0)-st/20*i*3-10).attr("y2",ta-ea(0)-st/20*i*3-10).style("stroke",F).attr("stroke-width",1).attr("shape-rendering","crispEdges").attr("stroke-dasharray","5,5"),oa.append("path").attr("d",na(Ra)).style("stroke",k).attr("stroke-width",1).attr("fill","none"),oa.append("text").attr("x",-4).attr("y",ta-ea(0)-10-st/20*i).attr("class","clickable").attr("id","expressionData").attr("text-anchor","end").attr("font-size","12px").attr("fill","#aaa").text("expression").on("mouseup",function(){"expressionData"!==o&&updatePlot(t,a,r,e,"expressionData")});var Ha=0;for(var ut in xt){Ha++;var Va=xt[ut],Ua=[];for(var mt in Va){var Ga=Va[mt];if(isNaN(Ga))Ua.push(null);else{var Qa=ta-ea(Ha-1)+(1-Ga)*i;Ua.push(Qa)}}var wa="";if(ut>=va&&ca>=ut&&(wa="prom"),Ua.some(function(t){return null!==t})){var Ja=d3.svg.area().defined(function(t){return t}).x(function(t,a){return ra(a)+qa}).y1(function(t){return t}).y0(ta-ea(Ha-1)+i);oa.append("path").attr("d",Ja(Ua)).attr("class",wa).attr("fill",C),oa.append("path").attr("d",na(Ua)).attr("stroke",M).attr("class",wa+" line").attr("stroke-width",1).attr("fill","none")}else oa.append("text").attr("x",4).attr("y",ta-ea(Ha-1)+.75*i).attr("text-anchor","start").attr("font-size","9px").attr("class",wa).attr("fill",_).text("no data")}var Ka=[];for(var mt in gt){var rt=gt[mt],ya=0;if(dt[rt]){for(var ut in dt[rt]){ya++,Ka.push(ut);var Xa=t.probeIds[ut];oa.append("rect").attr("fill","#fff").attr("fill-opacity",0).attr("x",ra(0)).attr("y",ta-ea(ya-1)).attr("width",aa*e).attr("height",i).attr("id",ut+"_"+Xa+"_"+ya).on("mouseover",function(){var t=$(this).attr("id"),a=t.replace(/_.+$/,""),r=t.replace(/^.+?_/,"");r=r.replace(/_.+$/,"");var e=(a-la)/pa;oa.append("text").attr("x",-74).attr("y",ta-ea(e)-6).attr("text-anchor","end").attr("class","probeId").attr("font-size","11px").attr("stroke","#fff").attr("stroke-width",4).text(r),oa.append("text").attr("x",-74).attr("y",ta-ea(e)-6).attr("text-anchor","end").attr("class","probeId").attr("font-size","11px").attr("fill",M).text(r),oa.append("line").attr("x1",-Jt).attr("x2",-Jt+Vt+80).attr("y1",ta-ea(e)).attr("y2",ta-ea(e)).style("stroke",M).attr("stroke-width",2).attr("class","focusLine")}).on("mouseout",function(){$(".focusLine").remove(),$(".probeId").remove()}).on("mouseup",function(){var t=$(this).attr("id"),a=$(".probeIdClicked").attr("id");if($(".focusLineClicked").remove(),$(".probeIdClicked").remove(),a!==t){var r=t.replace(/_.+$/,""),e=t.replace(/^.+?_/,"");e=e.replace(/_.+$/,"");var n=t.replace(/^.+_/,""),o=(r-la)/pa;oa.append("text").attr("x",-74).attr("y",ta-ea(o)-6).attr("text-anchor","end").attr("class","probeIdClicked containsProbeId").attr("id",t).attr("font-size","11px").attr("stroke","#FFF").attr("stroke-width",4).text(e),oa.append("text").attr("x",-74).attr("y",ta-ea(o)-6).attr("text-anchor","end").attr("class","probeIdClicked").attr("font-size","11px").attr("fill",M).text(e),oa.append("line").attr("x1",-Jt).attr("x2",-Jt+Vt+80).attr("y1",ta-ea(o)).attr("y2",ta-ea(o)).style("stroke",M).attr("stroke-width",2).attr("class","focusLineClicked"),oa.append("line").attr("x1",-Jt+Vt+80).attr("x2",ra(1)).attr("y1",ta-ea(o)).attr("y2",ta-ea(n-1)+i/2).style("stroke",M).attr("stroke-width",2).attr("class","focusLineClicked")}})}break}}var ya=0;if("expressionData"===o)for(var ut in Ka){ya++;var Ya=bt[o][Ka[ut]];if(Ya.r){var Za=Ya.r;if("failed"!==Za){var St=parseFloat(Ya.rp),tr=formatCorrelation(Za,St),ar="#aaa",rr="normal";.05>St&&(ar="#666",rr="bold"),oa.append("text").attr("x",ra(e)+4*aa).attr("y",ta-ea(ya-1)+i-4).attr("font-size",f).attr("font-weight",rr).attr("font-family",v).attr("fill",ar).text(tr)}}}else for(var ut in Ka){ya++;var Ya=bt[o][Ka[ut]];if(Ya.p||0===Ya.p){var St=Ya.p;if("failed"!==St){var er="#aaa",nr="normal",or=parseFloat(St);.05>or&&(er="#666",nr="bold"),St=or<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+St,oa.append("text").attr("x",ra(e)+4*aa).attr("y",ta-ea(ya-1)+i-4).attr("font-size",f).attr("font-weight",nr).attr("font-family",v).attr("fill",er).text(St)}}else if(Ya.r){var Za=Ya.r;if("failed"!==Za){var St=parseFloat(Ya.rp),tr=formatCorrelation(Za,St),ar="#aaa",rr="normal";.05>St&&(ar="#666",rr="bold"),oa.append("text").attr("x",ra(e)+4*aa).attr("y",ta-ea(ya-1)+i-4).attr("font-size",f).attr("font-weight",rr).attr("font-family",v).attr("fill",ar).text(tr)}}}if("no_annotation"!==t.annotation){var ir=0;for(var mt in gt){var rt=gt[mt],yt=rt.replace(/_\d\d$/,"");if(ir%2===0)var lr=I;else var lr=S;var Ct=rt.replace(/^.+_(\d\d)$/,"$1"),sr=(j[Ct],H[Ct]),pr=1;if(oa.append("rect").attr("fill",sr).attr("x",ra(ir)).attr("y",ta-ea(0)-10-st/20*i*3-10-(l+1)*pr).attr("width",aa).attr("height",l),"BRCA breast invasive carcinoma"===r){pr++;var dr;dr=rt in t.pam50?t.pam50[rt]:"no data";var fr=q[dr];oa.append("rect").attr("fill",fr).attr("x",ra(ir)).attr("y",ta-ea(0)-10-st/20*i*3-10-(l+1)*pr).attr("width",aa).attr("height",l)}if("no_annotation"!==vt[yt])for(var et in vt[yt]){var nt=vt[yt][et];if("gender"===et)if(1==nt)if(ir%2===0)var vr=B;else var vr=P;else if(ir%2===0)var vr=z;else var vr=E;if("eye_color"===et)if(1==nt)if(ir%2===0)var cr=L;else var cr=T;else if(2==nt)if(ir%2===0)var cr=W;else var cr=N;else if(ir%2===0)var cr=O;else var cr=R;var hr=tt[et];if(pr++,null===nt)oa.append("rect").attr("fill",w).attr("x",ra(ir)).attr("y",ta-ea(0)-10-st/20*i*3-10-(l+1)*pr).attr("width",aa).attr("height",l);else if("gender"===et){var ur=l,ua=ta-ea(0)-10-st/20*i*3-10-(l+1)*pr+(l-ur);oa.append("rect").attr("fill",vr).attr("x",ra(ir)).attr("y",ua).attr("width",aa).attr("height",ur)}else if("eye_color"===et){var ur=l,ua=ta-ea(0)-10-st/20*i*3-10-(l+1)*pr+(l-ur);oa.append("rect").attr("fill",cr).attr("x",ra(ir)).attr("y",ua).attr("width",aa).attr("height",ur)}else{var ur=l/hr*nt,ua=ta-ea(0)-10-st/20*i*3-10-(l+1)*pr+(l-ur);oa.append("rect").attr("fill",lr).attr("x",ra(ir)).attr("y",ua).attr("width",aa).attr("height",ur)}}else oa.append("rect").attr("fill",w).attr("x",ra(ir)).attr("y",ta-ea(0)-10-st/20*i*3-10-(l+1)*(Y-ot)).attr("width",aa).attr("height",(l+1)*(Y-1-ot)-1);ir++}if("expressionData"===o){var pr=0,Ya=bt[o]["sample type"];if(Ya.p||0===Ya.p){var St=Ya.p;if("failed"!==St){var er="#aaa",nr="normal",or=parseFloat(St);.05>or&&(er="#666",nr="bold"),St=or<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+St,oa.append("text").attr("x",ra(e)+4*aa).attr("y",ta-ea(0)-10-st/20*i*3-10-(l+1)*pr-4).attr("font-size",f).attr("font-weight",nr).attr("font-family",v).attr("fill",er).text(St)}}"BRCA breast invasive carcinoma"===r&&pr++;for(var et in tt){pr++;var Ya=bt[o][et];if(Ya.p||0===Ya.p){var St=Ya.p;if("failed"!==St){var er="#aaa",nr="normal",or=parseFloat(St);.05>or&&(er="#666",nr="bold"),St=or<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+St,oa.append("text").attr("x",ra(e)+4*aa).attr("y",ta-ea(0)-10-st/20*i*3-10-(l+1)*pr-4).attr("font-size",f).attr("font-weight",nr).attr("font-family",v).attr("fill",er).text(St)}}else if(Ya.r){var Za=Ya.r;if("failed"!==Za){var St=parseFloat(Ya.rp),tr=formatCorrelation(Za,St),ar="#aaa",rr="normal";.05>St&&(ar="#666",rr="bold"),oa.append("text").attr("x",ra(e)+4*aa).attr("y",ta-ea(0)-10-st/20*i*3-10-(l+1)*pr-4).attr("font-size",f).attr("font-weight",rr).attr("font-family",v).attr("fill",ar).text(tr)}}}var xr=Y-ot;for(field in it){var gr=it[field],Ya=bt.expressionData[gr];if(Ya.r){var Za=Ya.r;if("failed"!==Za){var St=parseFloat(Ya.rp),tr=formatCorrelation(Za,St),ar="#aaa",rr="normal";.05>St&&(ar="#666",rr="bold"),oa.append("text").attr("x",ra(ir)+4*aa).attr("y",ta-ea(0)-10-st/20*i*3-10-(l+1)*xr-4).attr("class",gr).attr("font-size",f).attr("font-weight",rr).attr("font-family",v).attr("fill",ar).text(tr)}}xr++}}else if("sample type"===o){var Ya=bt[o].expressionData;if(Ya.n){var It=Ya.n;oa.append("text").attr("x",ra(e)+4*aa).attr("y",ta-ea(0)-10-st/20*i).attr("font-size",f).attr("font-family",v).attr("fill","#aaa").text(It)}else if(Ya.p||0===Ya.p){var St=Ya.p;if("failed"!==St){var er="#aaa",nr="normal",or=parseFloat(St);.05>or&&(er="#666",nr="bold"),St=or<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+St,oa.append("text").attr("x",ra(e)+4*aa).attr("y",ta-ea(0)-10-st/20*i).attr("font-size",f).attr("font-weight",nr).attr("font-family",v).attr("fill",er).text(St)}}var ya=0;for(var ut in Ka){ya++;var Ya=bt[o][Ka[ut]];if(Ya.p||0===Ya.p){var St=Ya.p;if("failed"!==St){var er="#aaa",nr="normal",or=parseFloat(St);
.05>or&&(er="#666",nr="bold"),St=or<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+St,oa.append("text").attr("x",ra(e)+4*aa).attr("y",ta-ea(ya-1)+i-4).attr("font-size",f).attr("font-weight",nr).attr("font-family",v).attr("fill",er).text(St)}}}}else{var Ya=bt[o].expressionData;if(Ya.p||0===Ya.p){var St=Ya.p;if("failed"!==St){var er="#aaa",nr="normal",or=parseFloat(St);.05>or&&(er="#666",nr="bold"),St=or<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+St,oa.append("text").attr("x",ra(e)+4*aa).attr("y",ta-ea(0)-10-st/20*i).attr("font-size",f).attr("font-weight",nr).attr("font-family",v).attr("fill",er).text(St)}}else if(Ya.r){var Za=Ya.r;if("failed"!==Za){var St=parseFloat(Ya.rp),tr=formatCorrelation(Za,St),ar="#aaa",rr="normal";.05>St&&(ar="#666",rr="bold"),oa.append("text").attr("x",ra(e)+4*aa).attr("y",ta-ea(0)-10-st/20*i).attr("font-size",f).attr("font-weight",rr).attr("font-family",v).attr("fill",ar).text(tr)}}}var pr=0;oa.append("text").attr("x",-4).attr("y",ta-ea(0)-10-st/20*i*3-10-(i+1)*pr-4).attr("class","clickable").attr("font-size","12px").attr("fill","#aaa").attr("id","sample type").attr("text-anchor","end").text("sample type").on("mouseup",function(){var n=$(this).text();n=n.replace(/\u2192 /,""),n!==o&&updatePlot(t,a,r,e,n)}),"BRCA breast invasive carcinoma"===r&&(pr++,oa.append("text").attr("x",-4).attr("y",ta-ea(0)-10-st/20*i*3-10-(i+1)*pr).attr("class","clickable").attr("font-size","12px").attr("fill","#aaa").attr("id","PAM50 subtype").attr("text-anchor","end").text("PAM50 subtype").on("mouseup",function(){var n=$(this).text();n=n.replace(/\u2192 /,""),n!==o&&updatePlot(t,a,r,e,n)}));for(var et in tt){pr++,et=et.replace(/_/g," "),oa.append("text").attr("x",-4).attr("y",ta-ea(0)-10-st/20*i*3-10-(l+1)*pr-4).attr("class","clickable").attr("font-size","12px").attr("fill","#aaa").attr("id",et.replace(/ /g,"_")).attr("text-anchor","end").text(et).on("mouseup",function(){var n=$(this).text();n=n.replace(/ /g,"_"),n=n.replace(/\u2192_/,""),n!==o&&updatePlot(t,a,r,e,n)});var $t=et.replace(/ /g,"_");if($t!==o&&"expressionData"!==o){var Ya=bt[o][$t];if(Ya.p||0===Ya.p){var St=Ya.p;if("failed"!==St){var er="#aaa",nr="normal",or=parseFloat(St);.05>or&&(er="#666",nr="bold"),St=or<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+St,oa.append("text").attr("x",ra(e)+4*aa).attr("y",ta-ea(0)-10-st/20*i*3-10-(l+1)*pr-4).attr("font-size",f).attr("font-weight",nr).attr("font-family",v).attr("fill",er).text(St)}}else if(Ya.r){var Za=Ya.r;if("failed"!==Za){var St=parseFloat(Ya.rp),tr=formatCorrelation(Za,St),ar="#aaa",rr="normal";.05>St&&(ar="#666",rr="bold"),oa.append("text").attr("x",ra(e)+4*aa).attr("y",ta-ea(0)-10-st/20*i*3-10-(l+1)*pr-4).attr("font-size",f).attr("font-weight",rr).attr("font-family",v).attr("fill",ar).text(tr)}}}}}if("no_data"!==t.slide){var ir=0,it=(t.slide.numberOfSlideFields,[]);for(var mt in gt){var rt=gt[mt];if("no_data"!==ct[rt]){for(var mr in ct[rt])-1===$.inArray(mr,it)&&it.push(mr);break}}for(var mt in gt){var rt=gt[mt];if("no_data"!==ct[rt]){if(ir%2===0)var yr=I;else var yr=S;var xr=Y-ot;for(var mr in ct[rt])if(xr++,slideFieldValue=ct[rt][mr],"undefined"!=typeof ct[rt][mr]){var ur=l/100*slideFieldValue,ua=ta-ea(0)-10-st/20*i*3-10-(l+1)*xr+(l-ur);oa.append("rect").attr("fill",yr).attr("x",ra(ir)).attr("y",ua).attr("width",aa).attr("height",ur).attr("class",mr)}}else{var xr=Y-ot;for(field in it)xr++,oa.append("rect").attr("fill",w).attr("x",ra(ir)).attr("y",ta-ea(0)-10-st/20*i*3-10-(l+1)*xr-1).attr("width",aa).attr("height",l+1).attr("class",it[field])}ir++}var xr=Y-ot;for(field in it){var gr=it[field],et=gr.replace(/_/g," ");oa.append("text").attr("x",-4).attr("y",ta-ea(0)-10-st/20*i*3-10-(l+1)*xr-4).attr("class",gr+" clickable").attr("font-size","12px").attr("fill","#aaa").attr("id",gr).attr("text-anchor","end").text(et).on("mouseup",function(){var n=$(this).text();n=n.replace(/ /g,"_"),n=n.replace(/\u2192_/,""),n!==o&&updatePlot(t,a,r,e,n)})}var xr=Y-ot;for(field in it){var gr=it[field];if(gr!==o&&"expressionData"!==o){var Ya=bt[o][gr];if(Ya.r){var Za=Ya.r;if("failed"!==Za){var St=parseFloat(Ya.rp),tr=formatCorrelation(Za,St),ar="#aaa",rr="normal";.05>St&&(ar="#666",rr="bold"),oa.append("text").attr("x",ra(ir)+4*aa).attr("y",ta-ea(0)-10-st/20*i*3-10-(l+1)*xr-4).attr("class",gr).attr("font-size",f).attr("font-weight",rr).attr("font-family",v).attr("fill",ar).text(tr)}}else if(Ya.p||0===Ya.p){var St=Ya.p;if("failed"!==St){var er="#aaa",nr="normal",or=parseFloat(St);.05>or&&(er="#666",nr="bold"),St=or<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+St,oa.append("text").attr("x",ra(e)+4*aa).attr("y",ta-ea(0)-10-st/20*i*3-10-(l+1)*xr-4).attr("class",gr).attr("font-size",f).attr("font-weight",nr).attr("font-family",v).attr("fill",er).text(St)}}}xr++}}document.getElementById(o).setAttribute("font-weight","bold"),document.getElementById(o).setAttribute("font-size","13px"),document.getElementById(o).setAttribute("fill","rgb(100,100,100)");var wr=o.replace(/_/g," ");wr=wr.replace(/Data/,"");var br=document.getElementById(o).firstChild;br.nodeValue="► "+wr,oa.append("text").attr("x",Yt+Kt-12).attr("y",ta-ea(0)-10-st/20*i*3-10-(l+1)*Y-14).attr("font-size",f).attr("font-family",v).attr("text-anchor","end").attr("fill","#aaa").text("comparison to: "+wr),oa.append("line").attr("x1",Yt+Kt-12).attr("x2",Yt+Kt-12-6.6*wr.length).attr("y1",ta-ea(0)-10-st/20*i*3-10-(l+1)*Y-10).attr("y2",ta-ea(0)-10-st/20*i*3-10-(l+1)*Y-10).style("stroke","#aaa").attr("stroke-width",1).attr("shape-rendering","crispEdges");var $r=t.geneInfo.ensembl,kr=t.geneInfo.hgnc,Fr=t.geneInfo.chr,Cr=t.geneInfo.start;Cr=Cr.toString();for(var Mr="";Cr.length>=3;)Mr=Cr.substring(Cr.length-3)+","+Mr,Cr=Cr.substring(0,Cr.length-3);Mr=Cr+","+Mr,Mr=Mr.replace(/,$/,""),Mr=Mr.replace(/^,/,"");var Dr=t.geneInfo.end;Dr=Dr.toString();for(var Ar="";Dr.length>=3;)Ar=Dr.substring(Dr.length-3)+","+Ar,Dr=Dr.substring(0,Dr.length-3);Ar=Dr+","+Ar,Ar=Ar.replace(/,$/,""),Ar=Ar.replace(/^,/,""),""===kr?$(".plotInfo").html("<p><strong>"+$r+"</strong> chr<span class='chromosome'>"+Fr+"</span>:"+Mr+"-"+Ar+"</p>"):$(".plotInfo").html("<p><strong><a href='http://www.genecards.org/cgi-bin/carddisp.pl?gene="+kr+"' target='_blank' title='This link will take you to the GeneCards.org page for "+kr+".'>"+kr+"</a></strong> <span class='ensembl'>"+$r+"</span> chr<span class='chromosome'>"+Fr+"</span>:"+Mr+"-"+Ar+"</p>"),$(".plotInfo").append("<div class='promoterSelectionButton noselect'>highlight promoter probes</div>"),$(".promoterSelectionButton").click(function(){$(".prom").each(function(){var t=$(this);if(t.is("path"))if(t.attr("class").match(/line/)){var a=t.attr("stroke");a===M?t.attr("stroke",A):t.attr("stroke",M)}else{var a=t.attr("fill");a===C?t.attr("fill",D):t.attr("fill",C)}else if(t.is("text")){var a=t.attr("fill");a===_?t.attr("fill",A):t.attr("fill",_)}else if(t.is("line")){var a=t.attr("stroke");a===m?t.attr("stroke",y):t.attr("stroke",m)}})}),prepareSvgForDownload(a,r,o)}function checkUserInput(){$("#userInputForm .inputButton").toggleClass("inactive"),removeMessages();var t=$("#gene").val();t=t.replace(/[<>\\\/;'"()=\[\]\{\}]/g,"");var a=$(".sampleSelectionList").find(".selectedSample").text();""===t?($("#userInputForm .inputButton").toggleClass("inactive"),$("#userInputForm .inputButton").click(!0),$("#gene").focus(),$('<div class="warningMessage">Don\'t forget to enter a gene name!</div>').hide().appendTo("#userInputForm").fadeIn(200)):""===a?($("#userInputForm .inputButton").toggleClass("inactive"),$("#userInputForm .inputButton").click(!0),$('<div class="warningMessage">Don\'t forget to select a source!</div>').hide().appendTo("#userInputForm").fadeIn(200)):""!==t&&""!==a&&plotPreparation()}function plotPreparation(){removeMessages();var t=$("#gene").val();t=t.replace(/[<>\\\/;'"()=\[\]\{\}]/g,"");var a=$(".sampleSelectionList").find(".selectedSample").find(".sourceName").text(),r=$(".sampleSelectionList").find(".selectedSample").find(".fullSourceName").attr("title"),e=a+" "+r;$(".downloadButton").remove(),$(".loadingAnimation").show(),$(".plotContainer").css("background","#FFF"),$(".plotContainer").css("border","none"),$(".plotWindow").toggleClass("transparent"),$(".plotInfo").toggleClass("transparent"),$("svg").length&&($(".plotInfo").empty(),$(".plotWindow").empty());$.ajax({type:"POST",url:"php/numberOfSamples.php?source="+e,dataType:"json",success:function(a){var r=a.nrow;$('<div class="infoMessage">'+r+" samples selected</div>").hide().appendTo("#userInputForm").fadeIn(500),createNewPlot(t,e,r)},error:function(){$('<div class="errorMessage">Database error.<br>(could not retrieve the number of samples)</div>').hide().appendTo("#userInputForm").fadeIn(500),$(".plotWindow").toggleClass("hidden"),$("#userInputForm .inputButton").toggleClass("inactive"),$(".loadingAnimation").hide(),$(".plotContainer").css("background","#f6f6f6"),$(".plotContainer").css("border","4px solid #efefef")}})}function removeMessages(){$(".errorMessage").length>0&&$(".errorMessage").remove(),$(".warningMessage").length>0&&$(".warningMessage").remove(),$(".infoMessage").length>0&&$(".infoMessage").remove()}function numberOfLevels(t){var r=[];for(a in t){var e=t[a];-1===$.inArray(e,r)&&null!==e&&void 0!==e&&r.push(e)}var n=r.length;return n}$(document).ready(function(){$(window).scroll(function(){$("header").css({left:$(this).scrollLeft()})}),$("input[type=text]").focus(),windowWidth=$(window).width(),inputWidth=$(".userInput").outerWidth(),plotWidth=windowWidth-inputWidth-28,$(".plotContainer").width(plotWidth);var t,a;jQuery(function(){t={serviceUrl:"php/autocomplete.php",minChars:1,maxHeight:200,deferResquestBy:0},a=$("#gene").autocomplete(t)}),$(".sampleSelectionElement").click(function(){var t=$(this);$(".sampleSelectionElement").each(function(){$(this).hasClass("selectedSample")&&$(this).toggleClass("selectedSample")}),t.toggleClass("selectedSample")})});