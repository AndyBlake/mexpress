function pAdjust(a,b){var c;if("bh"===b){var d=a.length,e=[];for(c=d;c>0;c--)e.push(c);var f=[];for(c=0;d>c;c++)f[c]=[a[c],c];var g,h=nestedArraySort(f,!0,0);for(c=0;d>c;c++){var i=h[c][0]*d/e[c];0!==c?g>i?g=i:i=g:g=i,i>1&&(i=1),h[c][0]=i}for(h=nestedArraySort(h,!1,1),result=[],c=0;c<h.length;c++)result.push(h[c][0]);return result}}function pearsonCorrelation(a,b){var c;if(a.length!==b.length)return"failed";var d=[],e=[];for(c in b)isNaN(b[c])||isNaN(a[c])||(e.push(+b[c]),d.push(+a[c]));if(e.length>10){var f=e.length,g=0,h=0,i=0,j=0,k=0;for(c in e)g+=d[c],i+=Math.pow(d[c],2),h+=e[c],j+=Math.pow(e[c],2),k+=d[c]*e[c];var l=k-g*h/f,m=Math.sqrt(i-Math.pow(g,2)/f)*Math.sqrt(j-Math.pow(h,2)/f),n=l/m,o=e.length-2,p=Math.abs(n/Math.sqrt((1-Math.pow(n,2))/o)),q=tDistribution(o,p);return{r:n,p:q}}return"failed"}function mean(a){for(var b=a.length,c=0,d=0;b>d;d++)c+=a[d];var e=c/b;return e}function variance(a){for(var b=a.length,c=mean(a),d=0,e=0;b>e;e++)d+=Math.pow(a[e]-c,2);var f=d/b;return f}function degreesOfFreedom(a,b){var c=a.length,d=b.length,e=variance(a),f=variance(b),g=Math.pow(e/c+f/d,2),h=Math.pow(e/c,2)/(c-1)+Math.pow(f/d,2)/(d-1),i=g/h;return i}function tDistribution(a,b){var c=.049867347,d=.0211410061,e=.0032776263,f=380036e-10,g=488906e-10,h=5383e-9,i=b*(1-1/(4*a))/Math.sqrt(1+Math.pow(b,2)/(2*a)),j=2*(1/(2*Math.pow(1+c*i+d*Math.pow(i,2)+e*Math.pow(i,3)+f*Math.pow(i,4)+g*Math.pow(i,5)+h*Math.pow(i,6),16)));return j}function tTest(a,b){var c;for(c in a)isNaN(a[c])&&(a[c]=null);for(c in b)isNaN(b[c])&&(b[c]=null);if(a.some(function(a){return null!==a})){if(b.some(function(a){return null!==a})){var d=a.length,e=b.length;if(d>=3&&e>=3){var f=mean(a),g=mean(b),h=variance(a),i=variance(b),j=(f-g)/Math.sqrt(h/d+i/e);j=Math.abs(j);var k=degreesOfFreedom(a,b),l=tDistribution(k,j);return l}return"failed"}return"failed"}return"failed"}function nestedArraySort(a,b,c){return b?a.sort(function(a,b){return a=a[c],b=b[c],a===b?0:a>b?-1:1}):a.sort(function(a,b){return a=a[c],b=b[c],a===b?0:b>a?-1:1}),a}function wilcoxonRankSumTest(a,b){var c,d=[],e=[];for(c in a)a[c]&&"null"!==a[c]&&d.push(+a[c]);for(c in b)b[c]&&"null"!==b[c]&&e.push(+b[c]);var f=d.length,g=e.length;if(3>f||3>g)return"failed";var h=f*g/2,i=Math.sqrt(f*g*(f+g+1)/12),j=[];for(c in d)j.push([d[c],1]);for(c in e)j.push([e[c],2]);var k=nestedArraySort(j,!1,0),l=[],m=[];for(c in k)l.push(k[c][0]),m.push(k[c][1]);var n=[];for(c in k){var o=k[c][0],p=l.indexOf(o)+1;n.push(p)}var q=0,r=0;for(c in m){var s=m[c];1===s?q+=n[c]:r+=n[c]}var t=f*g+f*(f+1)/2-q,u=(t-h)/i;u=Math.abs(u);var v=u/Math.sqrt(2),w=1/(1+.5*v),x=w*Math.exp(-Math.pow(v,2)-1.26551223+1.00002368*w+.37409196*Math.pow(w,2)+.09678418*Math.pow(w,3)-.18628806*Math.pow(w,4)+.27886807*Math.pow(w,5)-1.13520398*Math.pow(w,6)+1.48851587*Math.pow(w,7)-.82215223*Math.pow(w,8)+.17087277*Math.pow(w,9)),y=1-x,z=2*(1-.5*(1+y));return z}function prepareSvgForDownload(a,b,c){$(".downloadButton").remove(),$(".downloadText").remove(),$(".plotInfo p").append("<div class='download'></div>"),$(".download").append("<div class='downloadButton png'>png</div>"),$(".download").append("<div class='downloadButton svg'>svg</div>"),$(".download").append("<div class='downloadText'>download a png or svg version of the figure</div>"),$(".downloadButton").css("visibility","visible").hide().fadeIn(1e3),$(".downloadButton").mouseenter(function(){$(".downloadText").css("visibility","visible").hide().fadeIn(100)}).mouseleave(function(){$(".downloadText").css("visibility","hidden")}),$(".downloadButton.png").click(function(){var d=d3.select("svg").attr("version",1.1).attr("xlmns","http://www.w3.org/2000/svg").node().parentNode.innerHTML;$(this).html("<img src='images/arrowLoader.gif'>"),downloadSvg(a,b,c,d,"png")}),$(".downloadButton.svg").click(function(){var d=d3.select("svg").attr("version",1.1).attr("xlmns","http://www.w3.org/2000/svg").node().parentNode.innerHTML;$(this).html("<img src='images/arrowLoader.gif'>"),downloadSvg(a,b,c,d,"svg")})}function createDownloadLink(a,b){var c=a.replace(/^.+\//,""),d=document.createElement("a");d["class"]="downloadLink",d.download=c,d.target="_blank",d.href=a,document.body.appendChild(d),d.click(),"png"===b?$(".downloadButton.png").html("png"):"svg"===b&&$(".downloadButton.svg").html("svg")}function downloadSvg(a,b,c,d,e){var f=encodeURIComponent(d),g=$(".containsProbeId").attr("id"),h="";if(void 0!==g){var h=g.replace(/^.+?_/,"");h=h.replace(/_.+$/,"")}$.ajax({data:"fileType="+e+"&gene="+a+"&source="+b+"&sorter="+c+"&probe="+h+"&svgHtml="+f,url:"php/svg2png.php",method:"POST",success:function(a){var b=a;b="php/"+b,createDownloadLink(b,e)}})}function createNewPlot(a,b,c){d3.json("php/geneNameQuery.php?gene="+a+"&source="+b,function(d,e){var f=e,g=f.success;if(g){var h="expressionData";createPlot(f,a,b,c,h)}else{var i=f.message;$('<div class="errorMessage">'+i+"</div>").hide().appendTo("#userInputForm").fadeIn(200),$(".plotWindow").toggleClass("hidden"),$(".plotContainer").css("background","#F6F6F6"),$(".plotContainer").css("border-bottom","4px solid #EFEFEF;")}$(".loadingAnimation").hide(),$(".plotWindow").toggleClass("transparent"),$(".plotInfo").toggleClass("transparent"),$("#userInputForm .inputButton").toggleClass("inactive"),$("#extraSelectionForm .inputButton").toggleClass("inactive")})}function formatCorrelation(a,b){var c=a.toPrecision(3);return a>0&&(c="+"+c),c="r = "+c,.001>b?c+=" ***":.01>b?c+=" **":.05>b&&(c+=" *"),c}function sortData(a,b){var c,d,e,f,g,h,i=[],j=[],k=[];for(c in a.expressionData)j.push(c);var l=j;if("expressionData"===b){var m=[];for(c in a.expressionData){var n=a.expressionData[c];m.push({key:c,val:n})}m.sort(function(a,b){return b.val-a.val});for(d in m)i.push(m[d].key)}else if("sample type"===b){k=[];for(c in a.expressionData){var o=c.replace(/^.+_(\d\d)$/,"$1");k.push({key:c,val:o})}k.sort(function(a,b){return b.val-a.val});for(d in k)i.push(k[d].key)}else if("PAM50 subtype"===b){k=[];var p=[];for(e in j)c=j[e],c in a.pam50?k.push({key:c,val:a.pam50[c]}):p.push(c);k.sort(function(a,b){var c=a.val.toLowerCase(),d=b.val.toLowerCase();return d>c?-1:c>d?1:0});for(d in k)i.push(k[d].key);i=i.concat(p)}else{var q,r;for(f in a.annotation){q=a.annotation[f];break}for(e in a.slide){r=a.slide[e];break}var s,t,u;if(b in q){s="annotation",t=[],u=[];for(e in a[s])"numberOfAnnotationFields"!==e&&(g=a[s][e][b],void 0!==g&&null!==g?(g=+g,t.push({key:e,val:g})):u.push({key:e,val:g}));t.sort(function(a,b){return b.val-a.val}),t=t.concat(u);for(d in t){var v=t[d].key,w=RegExp(v);for(h=j.length-1;h>=0;h--){var x=j[h],y=x.match(w);if(null!==y){i.push(x);var z=$.inArray(x,l);l.splice(z,1)}}}i=i.concat(l)}else if(b in r){s="slide",t=[],u=[];for(e in a[s])"numberOfSlideFields"!==e&&(g=a[s][e][b],void 0!==g&&null!==g?(g=+g,t.push({key:e,val:g})):u.push({key:e,val:g}));t.sort(function(a,b){return b.val-a.val}),t=t.concat(u);for(d in t)for(c=t[d].key,h=j.length-1;h>=0;h--)j[h]===c&&(i.push(c),j.splice(h,1));i=i.concat(j)}}return i}function updatePlot(a,b,c,d,e){$(".plotInfo").empty(),$(".plotWindow").empty(),createPlot(a,b,c,d,e)}function createPlot(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K=$(window).width(),L=$(".userInput").outerWidth(),M=K-L-28,N=18,O=14,P=4,Q=3,R=2,S="11px",T="Courier New",U="#F59322",V="#4BC722",W="#FFEDC2",X="#FFC842",Y="#999",Z="#ACD2F2",_="#1A70BA",aa="#F9F9F9",ba="#FFD57A",ca="#F59322",da="#FFD161",ea="#AAD5FA",fa="#4999DE",ga="#63ACEB",ha="#14568F",ia="#b6d3f2",ja="#DCE1E6",ka="#C5CCD4",la="#FA89CA",ma="#F272BB",na="#98D3FA",oa="#7FC3F0",pa="#98D3FA",qa="#4999DE",ra="#944E07",sa="#693705",ta="#73CC5B",ua="#37AC19",va={Normal:"#4999DE",Basal:"#FFC03B",Her2:"#FF983B",LumA:"#73CC5B",LumB:"#37AC19","no data":aa},wa={"01":"primary solid tumor","02":"recurrent solid tumor","03":"primary blood derived cancer - peripheral blood","04":"recurrent blood derived cancer - bone marrow","05":"additional - new primary","06":"metastatic","07":"additional metastatic","08":"human tumor original cells","09":"primary blood derived cancer - bone marrow",10:"blood derived normal",11:"solid tissue normal",12:"buccal cell normal",13:"EBV immortalized normal",14:"bone marrow normal",20:"control analyte",40:"recurrent blood derived cancer - peripheral blood",50:"cell lines",60:"primary xenograft tissue",61:"cell line derived xenograft tissue"},xa={"01":"#98D3FA","02":"#F7A972","03":"#F2766F","04":"#DB7346","05":"#3FD19B","06":"#FFD161","07":"#D13F75","08":"#6FF0F2","09":"#F29B6F",10:"#9DC9F5",11:"#4999DE",12:"#4198F0",13:"#0F73D6",14:"#90D8F5",20:"#46BFF0",40:"#DB4E46",50:"#F07746",60:"#A17FAD",61:"#8A38A8"},ya=a.numberOfProbes,za=a.geneInfo,Aa=+za.start,Ba=+za.end,Ca=za.strand,Da=a.transcripts,Ea=a.cpgi,Fa=0,Ga=!1,Ha={},Ia=[];n=+a.annotation.numberOfAnnotationFields,n>Fa&&(Fa=n);for(f in a.annotation)for(o in a.annotation[f])-1===$.inArray(o,Ia)&&Ia.push(o),"gender"===o&&(Ga=!0),k=parseFloat(a.annotation[f][o]),isNaN(k)?Ha.hasOwnProperty(o)||(Ha[o]=0):Ha.hasOwnProperty(o)?k>Ha[o]&&(Ha[o]=k):Ha[o]=k;Fa++;var Ja=0,Ka=[];if("no_data"!==a.slide){n=+a.slide.numberOfSlideFields,n>Ja&&(Ja=n);for(f in a.slide)if("numberOfSlideFields"!==f){for(h in a.slide[f])Ka.push(h);break}}Fa+=Ja,"BRCA breast invasive carcinoma"===c&&Fa++;var La=0;for(f in a.expressionData)expr=+a.expressionData[f],expr>La&&(La=expr);var Ma=sortData(a,e),Na=[],Oa=[],Pa=[],Qa=[],Ra=[];for(f in a.methylationData){for(g in a.methylationData[f])Ra.push(g);break}var Sa={};for(g in Ra)Sa[Ra[g]]=[];var Ta=[];for(j in Ma)if(f=Ma[j],a.methylationData[f]){Ta.push(f),Na[f]=a.methylationData[f];for(g in Ra)Sa[Ra[g]].push(a.methylationData[f][Ra[g]]);i=f.replace(/_\d\d$/,""),a.annotation[i]?Pa[i]=a.annotation[i]:Pa[i]="no_annotation",a.slide[f]?Qa[f]=a.slide[f]:Qa[f]="no_data",m=a.expressionData[f],Oa[f]=m}var Ua={};Ua.expressionData={},Ua["sample type"]={},Ua["PAM50 subtype"]={};for(f in a.annotation){for(q in a.annotation[f])Ua[q]={};break}for(f in a.slide){for(q in a.slide[f])Ua[q]={};break}for(h in Ua){var Va={},Wa=[];if("expressionData"===h)Va=a[h];else if(-1!==$.inArray(h,Ia))for(i in a.annotation)Va[i]=a.annotation[i][h];else if(-1!==$.inArray(h,Ka))for(f in a.slide)Va[f]=a.slide[f][h];else if("sample type"===h)for(j in Ta)f=Ta[j],r=f.replace(/^.+_(\d\d)$/,"$1"),"10"===r||"11"===r||"12"===r||"13"===r||"14"===r?Va[f]="1":Va[f]="0";else if("PAM50 subtype"===h)for(j in Ta)f=Ta[j],f in a.pam50?Va[f]=a.pam50[f]:Va[f]="no data";for(l in Va)Wa.push(Va[l]);var Xa,Ya,Za=numberOfLevels(Wa);if("expressionData"!==h)if(2===Za){Xa=[],Ya=[];for(f in Oa)i=f.replace(/_\d\d$/,""),"no_annotation"!==Pa[i]&&(k="sample type"!==h?Pa[i][h]:Va[f],"1"===k?Xa.push(Oa[f]):"0"===k&&Ya.push(Oa[f]));p=wilcoxonRankSumTest(Xa,Ya),Ua[h].expressionData={p:p}}else if(Za>2&&"PAM50 subtype"!==h&&"eye_color"!==h&&"batch number"!==h){Xa=[],Ya=[];for(j in Ta)f=Ta[j],Xa.push(Oa[f]),-1!==$.inArray(h,Ia)?(i=f.replace(/_\d\d$/,""),Ya.push(Va[i])):Ya.push(Va[f]);p=pearsonCorrelation(Xa,Ya),Ua[h].expressionData={r:p.r,rp:p.p}}else Ua[h].expressionData={n:"no normals"};for(s in Ra)if(2===Za){Xa=[],Ya=[];for(j in Ta)f=Ta[j],i=f.replace(/_\d\d$/,""),"no_annotation"!==Pa[i]&&(k="sample type"!==h?Pa[i][h]:Va[f],"1"===k?Xa.push(Na[f][Ra[s]]):"0"===k&&Ya.push(Na[f][Ra[s]]));p=wilcoxonRankSumTest(Xa,Ya),Ua[h][Ra[s]]={p:p}}else if(Za>2&&"PAM50 subtype"!==h&&"eye_color"!==h&&"batch number"!==h){Xa=[],Ya=[];for(j in Ta)f=Ta[j],Xa.push(Na[f][Ra[s]]),-1!==$.inArray(h,Ia)?(i=f.replace(/_\d\d$/,""),Ya.push(Va[i])):Ya.push(Va[f]);p=pearsonCorrelation(Xa,Ya),Ua[h][Ra[s]]={r:p.r,rp:p.p}}else Ua[h][Ra[s]]={n:"failed"};var $a;for(var _a in Ia)if($a=Ia[_a],$a!==h){var ab=[];for(s in Pa)ab.push(Pa[s][$a]);var bb=numberOfLevels(ab);if(2===Za)if(2===bb)Ua[h][$a]={n:"failed"};else if(bb>2){Xa=[],Ya=[];for(j in Ta)f=Ta[j],i=f.replace(/_\d\d$/,""),"no_annotation"!==Pa[i]&&(k="sample type"!==h?Pa[i][h]:Va[f],"1"===k?Xa.push(Pa[i][$a]):"0"===k&&Ya.push(Pa[i][$a]));p=wilcoxonRankSumTest(Xa,Ya),Ua[h][$a]={p:p}}else Ua[h][$a]={n:"failed"};else if(Za>2&&"PAM50 subtype"!==h&&"eye_color"!==h&&"batch number"!==h)if(2===bb){Xa=[],Ya=[];for(j in Ta)f=Ta[j],i=f.replace(/_\d\d$/,""),"no_annotation"!==Pa[i]&&(k=Pa[i][$a],"1"===k?-1!==$.inArray(h,Ia)?Va[i]&&Xa.push(Va[i]):Va[f]&&Xa.push(Va[f]):"0"===k&&(-1!==$.inArray(h,Ia)?Va[i]&&Ya.push(Va[i]):Va[f]&&Ya.push(Va[f])));p=wilcoxonRankSumTest(Xa,Ya),Ua[h][$a]={p:p}}else if(bb>2){Xa=[],Ya=[];for(j in Ta)f=Ta[j],i=f.replace(/_\d\d$/,""),-1!==$.inArray(h,Ia)?Va[i]&&(Xa.push(Va[i]),Ya.push(Pa[i][$a])):Va[f]&&(Xa.push(Va[f]),Ya.push(Pa[i][$a]));p=pearsonCorrelation(Xa,Ya),Ua[h][$a]={r:p.r,rp:p.p}}else Ua[h][$a]={n:"failed"};else Ua[h][$a]={n:"failed"}}for(j in Ka)if($a=Ka[j],$a!==h)if(2===Za){Xa=[],Ya=[];for(j in Ta)f=Ta[j],i=f.replace(/_\d\d$/,""),k="sample type"!==h?Pa[i][h]:Va[f],"1"===k?Xa.push(Qa[f][$a]):"0"===k&&Ya.push(Qa[f][$a]);p=wilcoxonRankSumTest(Xa,Ya),Ua[h][$a]={p:p}}else if(Za>2&&"PAM50 subtype"!==h&&"eye_color"!==h&&"batch number"!==h){Xa=[],Ya=[];for(j in Ta)f=Ta[j],i=f.replace(/_\d\d$/,""),-1!==$.inArray(h,Ia)?Va[i]&&(Xa.push(Va[i]),Ya.push(Qa[f][$a])):(Xa.push(Va[f]),Ya.push(Qa[f][$a]));p=pearsonCorrelation(Xa,Ya),Ua[h][$a]={r:p.r,rp:p.p}}else Ua[h][$a]={n:"failed"};if("sample type"!==h){var cb={},db=[];for(j in Ta)f=Ta[j],r=f.replace(/^.+_(\d\d)$/,"$1"),"10"===r||"11"===r||"12"===r||"13"===r||"14"===r?(cb[f]="1",db.push("1")):(cb[f]="0",db.push("0"));var eb=numberOfLevels(db);if(2===eb){if(2===Za)Ua[h]["sample type"]={n:"failed"};else if(Za>2&&"PAM50 subtype"!==h&&"eye_color"!==h&&"batch number"!==h){Xa=[],Ya=[];for(j in Ta){f=Ta[j],i=f.replace(/_\d\d$/,"");var fb=cb[f];"1"===fb?-1!==$.inArray(h,Ia)?Va[i]&&Xa.push(Va[i]):Va[f]&&Xa.push(Va[f]):"0"===fb&&(-1!==$.inArray(h,Ia)?Va[i]&&Ya.push(Va[i]):Va[f]&&Ya.push(Va[f]))}p=wilcoxonRankSumTest(Xa,Ya),Ua[h]["sample type"]={p:p}}}else Ua[h]["sample type"]={n:"no normal samples"}}}var gb=[],hb=[];for(l in Ua[e])t=Ua[e][l],t.rp&&"failed"!==t.rp?(gb.push(t.rp),hb.push(l)):t.p&&"failed"!==t.p&&(gb.push(t.p),hb.push(l));var ib=pAdjust(gb,"bh");for(u=0;u<ib.length;u++){var jb=ib[u];jb=+jb.toPrecision(3);var kb=1e3*jb;1>kb&&(jb=jb.toExponential()),t=hb[u],Ua[e][t].rp?Ua[e][t].rp=jb:Ua[e][t].p&&(Ua[e][t].p=jb)}Ub=0;var lb;for(lb in Da)Da.hasOwnProperty(lb)&&Ub++;Sb=0;for(lb in Ea)Ea.hasOwnProperty(lb)&&Sb++;var mb=8+4*Ub;Sb>0&&(mb+=5);var nb=Math.abs(Aa-Ba),ob=148,pb=[];if("no_annotation"!==a.annotation)for(j in Ta)f=Ta[j],r=f.replace(/^.+_(\d\d)$/,"$1"),-1===$.inArray(r,pb)&&pb.push(r);pb.length>7&&(ob=148+18*pb.length);var qb,rb=10+La/20*N*3+10+(O+1)*Fa+20+ob,sb=170+mb,tb=110,ub={top:rb,left:sb,bottom:40,right:tb},vb=M-sb-tb,wb=600;Ga&&(wb=750),wb>vb&&(vb=wb),qb=10>ya?10*N:nb>1e5&&40>ya?40*N:ya*N;var xb=Math.floor(vb/d);1>xb?xb=1:xb>6&&(xb=6),vb=xb*d;var yb=d3.scale.linear().range([0,vb]),zb=d3.scale.linear().range([qb,0]),Ab=(d3.svg.axis().scale(yb).orient("top"),d3.svg.line().defined(function(a){return null!==a}).x(function(a,b){return yb(b)+xb/2}).y(function(a){return a}));$(".plotWindow").removeClass("hidden");var Bb=d3.select(".plotWindow").append("svg").attr("width",vb+ub.left+ub.right).attr("height",qb+ub.top+ub.bottom).attr("text-rendering","geometricPrecision").attr("font-family","arial").attr("font-size","12px").attr("fill","#666").append("g").attr("transform","translate("+ub.left+","+ub.top+")");yb.domain([0,d]),zb.domain([0,ya]);var Cb=1e3;nb/10>1e3&&(Cb=nb/10),Cb>5e3&&(Cb=5e3);var Db,Eb,Fb=Aa-Cb,Gb=Ba+Cb,Hb=(Gb-Fb)/ya,Ib=(Aa-Fb)/Hb,Jb=(Ba-Fb)/Hb;"1"===Ca?(Db=Aa-1e3,Eb=Aa+500):(Db=Ba-500,Eb=Ba+1e3);var Kb,Lb;if(Kb=-sb+1,Lb=-rb+24,Bb.append("text").attr("x",Kb).attr("y",Lb).attr("font-weight","bold").text("annotation"),Bb.append("rect").attr("fill",U).attr("x",Kb).attr("y",Lb+8).attr("width",3).attr("height",12),Bb.append("text").attr("x",Kb+8).attr("y",Lb+18).text("gene"),Bb.append("rect").attr("fill",W).attr("x",Kb).attr("y",Lb+8+18).attr("width",3).attr("height",12),Bb.append("text").attr("x",Kb+8).attr("y",Lb+36).text("transcript"),Bb.append("rect").attr("fill",V).attr("x",Kb).attr("y",Lb+8+36).attr("width",3).attr("height",12),Bb.append("text").attr("x",Kb+8).attr("y",Lb+54).text("CpG island"),Kb+=90,Bb.append("text").attr("x",Kb).attr("y",Lb).attr("font-weight","bold").text("data"),Bb.append("rect").attr("fill",ba).attr("x",Kb).attr("y",Lb+8).attr("width",3).attr("height",12),Bb.append("text").attr("x",Kb+8).attr("y",Lb+18).text("RNA-seq v2 (log2)"),Bb.append("rect").attr("fill",ea).attr("x",Kb).attr("y",Lb+8+18).attr("width",3).attr("height",12),Bb.append("text").attr("x",Kb+8).attr("y",Lb+36).text(a.platform),Bb.append("rect").attr("fill",ja).attr("x",Kb).attr("y",Lb+8+36).attr("width",3).attr("height",12),Bb.append("text").attr("x",Kb+8).attr("y",Lb+54).text("slide/clinical data"),Bb.append("rect").attr("fill",aa).attr("x",Kb).attr("y",Lb+8+54).attr("width",3).attr("height",12),Bb.append("text").attr("x",Kb+8).attr("y",Lb+72).text("missing data"),Kb+=120,Ga&&(Bb.append("text").attr("x",Kb).attr("y",Lb).attr("font-weight","bold").text("gender"),Bb.append("rect").attr("fill",la).attr("x",Kb).attr("y",Lb+8).attr("width",3).attr("height",12),Bb.append("text").attr("x",Kb+8).attr("y",Lb+18).text("female"),Bb.append("rect").attr("fill",na).attr("x",Kb).attr("y",Lb+8+18).attr("width",3).attr("height",12),Bb.append("text").attr("x",Kb+8).attr("y",Lb+36).text("male"),Kb+=70),Bb.append("text").attr("x",Kb).attr("y",Lb).attr("font-weight","bold").text("statistics"),Bb.append("text").attr("x",Kb).attr("y",Lb+18).attr("font-size","14px").attr("font-family",T).text("p"),Bb.append("text").attr("x",Kb+16).attr("y",Lb+18).text("Wilcoxon rank-sum test"),Bb.append("text").attr("x",Kb+16).attr("y",Lb+18+14).attr("font-weight","bold").attr("font-size","11px").attr("font-family",T).text("p < 0.05"),Bb.append("text").attr("x",Kb+16+72).attr("y",Lb+18+14).attr("fill","#aaa").attr("font-size","11px").attr("font-family",T).text("p ≥ 0.05"),Bb.append("text").attr("x",Kb).attr("y",Lb+54).attr("font-size","14px").attr("font-family",T).text("r"),Bb.append("text").attr("x",Kb+16).attr("y",Lb+54).text("Pearson correlation"),Bb.append("text").attr("x",Kb+16).attr("y",Lb+54+14).attr("font-weight","bold").attr("font-size","11px").attr("font-family",T).text("***"),Bb.append("text").attr("x",Kb+16+32).attr("y",Lb+54+14).attr("font-weight","bold").attr("font-size","11px").attr("font-family",T).text("p < 0.001"),Bb.append("text").attr("x",Kb+16).attr("y",Lb+54+28).attr("font-weight","bold").attr("font-size","11px").attr("font-family",T).text("**"),Bb.append("text").attr("x",Kb+16+32).attr("y",Lb+54+28).attr("font-weight","bold").attr("font-size","11px").attr("font-family",T).text("p < 0.01"),Bb.append("text").attr("x",Kb+16).attr("y",Lb+54+42).attr("font-weight","bold").attr("font-size","11px").attr("font-family",T).text("*"),Bb.append("text").attr("x",Kb+16+32).attr("y",Lb+54+42).attr("font-weight","bold").attr("font-size","11px").attr("font-family",T).text("p < 0.05"),Bb.append("text").attr("x",Kb+16+32).attr("y",Lb+54+56).attr("fill","#aaa").attr("font-size","11px").attr("font-family",T).text("p ≥ 0.05"),Kb+=160,"BRCA breast invasive carcinoma"===c){Bb.append("text").attr("x",Kb).attr("y",Lb).attr("font-weight","bold").text("BRCA subtype"),u=0;for(var Mb in va)"no data"!==Mb&&(Bb.append("rect").attr("fill",va[Mb]).attr("x",Kb).attr("y",Lb+8+18*u).attr("width",3).attr("height",12),Bb.append("text").attr("x",Kb+8).attr("y",Lb+18*(u+1)).text(Mb),u++);Kb+=106}Bb.append("text").attr("x",Kb).attr("y",Lb).attr("font-weight","bold").text("sample type");var Nb=0;for(j in pb){r=pb[j];var Ob=wa[r];Ob.length>26&&(Ob=Ob.substring(0,23),Ob+="..."),Bb.append("rect").attr("fill",xa[r]).attr("x",Kb).attr("y",Lb+8+18*Nb).attr("width",3).attr("height",12),Bb.append("text").attr("x",Kb+8).attr("y",Lb+18*(Nb+1)).text(Ob+" ("+r+")"),Nb++}var Pb,Qb;for(f in a.methylationData){Qb=0;for(g in a.methylationData[f]){Qb++,Pb="",g>=Db&&Eb>=g&&(Pb="prom");var Rb=(g-Fb)/Hb;Bb.append("line").attr("x1",-sb).attr("x2",-sb+mb+80).attr("y1",qb-zb(Rb)).attr("y2",qb-zb(Rb)).attr("stroke",Z).attr("stroke-opacity",.5).attr("stroke-width",1).attr("class",Pb).attr("id","annotationLine"+g),Bb.append("line").attr("x1",-sb+mb+80).attr("x2",yb(1)).attr("y1",qb-zb(Rb)).attr("y2",qb-zb(Qb-1)+N/2).attr("stroke",Z).attr("stroke-opacity",.5).attr("stroke-width",1).attr("class",Pb)}break}Bb.append("rect").attr("fill",U).attr("x",-sb+7).attr("y",qb-zb(Ib)).attr("width",P).attr("height",zb(ya-(Jb-Ib))),"1"===Ca?(Bb.append("line").attr("x1",-sb+4).attr("x2",-sb+9).attr("y1",zb(ya-(Jb-Ib))+qb-zb(Ib)-7).attr("y2",zb(ya-(Jb-Ib))+qb-zb(Ib)).style("stroke",U).attr("stroke-width",P-1).attr("stroke-linecap","round"),Bb.append("line").attr("x1",-sb+9).attr("x2",-sb+14).attr("y1",zb(ya-(Jb-Ib))+qb-zb(Ib)).attr("y2",zb(ya-(Jb-Ib))+qb-zb(Ib)-7).style("stroke",U).attr("stroke-width",P-1).attr("stroke-linecap","round")):(Bb.append("line").attr("x1",-sb+4).attr("x2",-sb+9).attr("y1",qb-zb(Ib)+7).attr("y2",qb-zb(Ib)).style("stroke",U).attr("stroke-width",P-1).attr("stroke-linecap","round"),Bb.append("line").attr("x1",-sb+9).attr("x2",-sb+14).attr("y1",qb-zb(Ib)).attr("y2",qb-zb(Ib)+7).style("stroke",U).attr("stroke-width",P-1).attr("stroke-linecap","round"));var Sb=0;for(var Tb in Ea)Sb++,cStart=Ea[Tb].start,cEnd=Ea[Tb].end,cStart<Fb&&(cStart=Fb),cEnd>Gb&&(cEnd=Gb),cStartPlot=(cStart-Fb)/Hb,cEndPlot=(cEnd-Fb)/Hb,Bb.append("rect").attr("fill",V).attr("x",-sb+18).attr("y",qb-zb(cStartPlot)).attr("width",Q).attr("height",zb(ya-(cEndPlot-cStartPlot)));var Ub=0;for(var Vb in Da){Ub++;var Wb=+Da[Vb].start,Xb=+Da[Vb].end,Yb=(Wb-Fb)/Hb,Zb=(Xb-Fb)/Hb;Bb.append("rect").attr("fill",W).attr("x",-sb+22+6*Ub).attr("y",qb-zb(Yb)).attr("width",R).attr("height",zb(ya-(Zb-Yb))).html("<title>"+Vb+"</title");var $b=a.transcripts[Vb].exons;for(l in $b){var _b=+$b[l].start,ac=+$b[l].end;eStartPlot=(_b-Fb)/Hb,eEndPlot=(ac-Fb)/Hb,Bb.append("rect").attr("fill",X).attr("x",-sb+22+6*Ub).attr("y",qb-zb(eStartPlot)).attr("width",R).attr("height",zb(ya-(eEndPlot-eStartPlot)))}}var bc=Math.round(Math.log(nb)/Math.log(10)),cc=Math.pow(10,bc-1);1e3>cc&&5e3>nb&&(cc=1e3);var dc,ec;"1"===Ca?(dc=Aa-cc/2,ec=Aa+cc/2):(dc=Ba-cc/2,ec=Ba+cc/2);var fc=(dc-Fb)/Hb,gc=(ec-Fb)/Hb;Bb.append("rect").attr("fill",Y).attr("x",-sb+2).attr("y",qb-zb(fc)).attr("width",2).attr("id","scaleBar").attr("height",zb(ya-(gc-fc)));var hc=cc/1e3;hc+="kb";var ic;ic="1"==Ca?zb(fc)+2:zb(gc)-10,Bb.append("text").attr("x",-sb+1).attr("y",qb-ic).attr("font-size","9px").attr("fill",Y).text(hc);var jc=[];for(j in Ta)f=Ta[j],m=Oa[f],jc.push(qb-zb(0)-m/20*N*3-10);var kc=0;100>d?kc=2:200>d&&(kc=1);var lc=d3.svg.area().defined(function(a){return a}).x(function(a,b){return yb(b)+kc}).y1(function(a){return a}).y0(qb-zb(0)-10);Bb.append("path").attr("d",lc(jc)).attr("fill",ba),Bb.append("line").attr("x1",yb(1)).attr("x2",yb(d)).attr("y1",qb-zb(0)-La/20*N*3-10).attr("y2",qb-zb(0)-La/20*N*3-10).style("stroke",da).attr("stroke-width",1).attr("shape-rendering","crispEdges").attr("stroke-dasharray","5,5"),Bb.append("path").attr("d",Ab(jc)).style("stroke",ca).attr("stroke-width",1).attr("fill","none"),Bb.append("text").attr("x",-4).attr("y",qb-zb(0)-10-La/20*N).attr("class","clickable").attr("id","expressionData").attr("text-anchor","end").attr("font-size","12px").attr("fill","#aaa").text("expression").on("mouseup",function(){"expressionData"!==e&&updatePlot(a,b,c,d,"expressionData")});var mc=0;for(g in Sa){mc++;var nc=Sa[g],oc=[];for(j in nc){var pc=nc[j];if(isNaN(pc))oc.push(null);else{var qc=qb-zb(mc-1)+(1-pc)*N;oc.push(qc)}}if(Pb="",g>=Db&&Eb>=g&&(Pb="prom"),oc.some(function(a){return null!==a})){var rc=d3.svg.area().defined(function(a){return a}).x(function(a,b){return yb(b)+kc}).y1(function(a){return a}).y0(qb-zb(mc-1)+N);Bb.append("path").attr("d",rc(oc)).attr("class",Pb).attr("fill",ea),Bb.append("path").attr("d",Ab(oc)).attr("stroke",fa).attr("class",Pb+" line").attr("stroke-width",1).attr("fill","none")}else Bb.append("text").attr("x",4).attr("y",qb-zb(mc-1)+.75*N).attr("text-anchor","start").attr("font-size","9px").attr("class",Pb).attr("fill",ia).text("no data")}var sc=[];for(j in Ta)if(f=Ta[j],Qb=0,Na[f]){for(g in Na[f]){Qb++,sc.push(g);var tc=a.probeIds[g];Bb.append("rect").attr("fill","#fff").attr("fill-opacity",0).attr("x",yb(0)).attr("y",qb-zb(Qb-1)).attr("width",xb*d).attr("height",N).attr("id",g+"_"+tc+"_"+Qb).attr("class","clickable").on("mouseover",function(){var a=$(this).attr("id"),b=a.replace(/_.+$/,""),c=a.replace(/^.+?_/,"");c=c.replace(/_.+$/,"");var d=(b-Fb)/Hb;Bb.append("text").attr("x",-74).attr("y",qb-zb(d)-6).attr("text-anchor","end").attr("class","probeId").attr("font-size","11px").attr("stroke","#fff").attr("stroke-width",4).text(c),Bb.append("text").attr("x",-74).attr("y",qb-zb(d)-6).attr("text-anchor","end").attr("class","probeId").attr("font-size","11px").attr("fill",fa).text(c),Bb.append("line").attr("x1",-sb).attr("x2",-sb+mb+80).attr("y1",qb-zb(d)).attr("y2",qb-zb(d)).style("stroke",fa).attr("stroke-width",2).attr("class","focusLine")}).on("mouseout",function(){$(".focusLine").remove(),$(".probeId").remove()}).on("mouseup",function(){var b=$(this).attr("id"),c=$(".probeIdClicked").attr("id");if($(".focusLineClicked").remove(),$(".probeIdClicked").remove(),$(".probeInfo").remove(),c!==b){var d=a.geneInfo.chr,e=b.replace(/_.+$/,""),f=b.replace(/^.+?_/,"");f=f.replace(/_.+$/,"");var g=b.replace(/^.+_/,""),h=(e-Fb)/Hb;Bb.append("text").attr("x",-74).attr("y",qb-zb(h)-6).attr("text-anchor","end").attr("class","probeIdClicked containsProbeId").attr("id",b).attr("font-size","11px").attr("stroke","#FFF").attr("stroke-width",4).text(f),Bb.append("text").attr("x",-74).attr("y",qb-zb(h)-6).attr("text-anchor","end").attr("class","probeIdClicked clickable").attr("font-size","11px").attr("fill",fa).text(f).on("mouseup",function(){var b=a.probeAnnotation[e];b=b.replace(/-/g," ± ");var c=140;b.length>20&&(c=180),Bb.append("rect").attr("x",-142).attr("y",qb-zb(h)-24).attr("width",c).attr("height",66).attr("fill","#fff").attr("stroke",fa).attr("stroke-width",2).attr("class","probeInfo clickable").on("mouseup",function(){$(".probeInfo").remove()}),Bb.append("text").attr("x",-136).attr("y",qb-zb(h)-6).attr("class","probeInfo").attr("font-weight","bold").text(f),Bb.append("text").attr("x",-136).attr("y",qb-zb(h)+14).attr("class","probeInfo").text("chr"+d+":"+e),Bb.append("text").attr("x",-136).attr("y",qb-zb(h)+30).attr("class","probeInfo").text(b),Bb.append("text").attr("x",-142+c-20).attr("y",qb-zb(h)-4).attr("class","probeInfo clickable").attr("font-size","18px").attr("font-weight","bold").attr("fill",fa).text("×").on("mouseup",function(){$(".probeInfo").remove()})}),Bb.append("line").attr("x1",-sb).attr("x2",-sb+mb+80).attr("y1",qb-zb(h)).attr("y2",qb-zb(h)).style("stroke",fa).attr("stroke-width",2).attr("class","focusLineClicked"),Bb.append("line").attr("x1",-sb+mb+80).attr("x2",yb(1)).attr("y1",qb-zb(h)).attr("y2",qb-zb(g-1)+N/2).style("stroke",fa).attr("stroke-width",2).attr("class","focusLineClicked")}})}break}if(Qb=0,"expressionData"===e)for(g in sc)Qb++,v=Ua[e][sc[g]],v.r&&(w=v.r,"failed"!==w&&(s=parseFloat(v.rp),x=formatCorrelation(w,s),y="#aaa",z="normal",.05>s&&(y="#666",z="bold"),Bb.append("text").attr("x",yb(d)+4*xb).attr("y",qb-zb(Qb-1)+N-4).attr("font-size",S).attr("font-weight",z).attr("font-family",T).attr("fill",y).text(x)));else for(g in sc)Qb++,v=Ua[e][sc[g]],v.p||0===v.p?(s=v.p,"failed"!==s&&(B="#aaa",C="normal",A=parseFloat(s),.05>A&&(B="#666",C="bold"),s=A<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+s,Bb.append("text").attr("x",yb(d)+4*xb).attr("y",qb-zb(Qb-1)+N-4).attr("font-size",S).attr("font-weight",C).attr("font-family",T).attr("fill",B).text(s))):v.r&&(w=v.r,"failed"!==w&&(s=parseFloat(v.rp),x=formatCorrelation(w,s),y="#aaa",z="normal",.05>s&&(y="#666",z="bold"),Bb.append("text").attr("x",yb(d)+4*xb).attr("y",qb-zb(Qb-1)+N-4).attr("font-size",S).attr("font-weight",z).attr("font-family",T).attr("fill",y).text(x)));if("no_annotation"!==a.annotation){E=0;for(j in Ta){f=Ta[j],i=f.replace(/_\d\d$/,"");var uc;uc=E%2===0?ja:ka,r=f.replace(/^.+_(\d\d)$/,"$1");var vc=(wa[r],xa[r]);if(D=1,Bb.append("rect").attr("fill",vc).attr("x",yb(E)).attr("y",qb-zb(0)-10-La/20*N*3-10-(O+1)*D).attr("width",xb).attr("height",O),"BRCA breast invasive carcinoma"===c){D++;var wc;wc=f in a.pam50?a.pam50[f]:"no data";var xc=va[wc];Bb.append("rect").attr("fill",xc).attr("x",yb(E)).attr("y",qb-zb(0)-10-La/20*N*3-10-(O+1)*D).attr("width",xb).attr("height",O)}if("no_annotation"!==Pa[i])for(o in Pa[i]){k=Pa[i][o];var yc;"gender"===o&&(yc=1==k?E%2===0?la:ma:E%2===0?na:oa);var zc;"eye_color"===o&&(zc=1==k?E%2===0?pa:qa:2==k?E%2===0?ra:sa:E%2===0?ta:ua);var Ac=Ha[o];D++,null===k?Bb.append("rect").attr("fill",aa).attr("x",yb(E)).attr("y",qb-zb(0)-10-La/20*N*3-10-(O+1)*D).attr("width",xb).attr("height",O):"gender"===o?(G=O,Lb=qb-zb(0)-10-La/20*N*3-10-(O+1)*D+(O-G),Bb.append("rect").attr("fill",yc).attr("x",yb(E)).attr("y",Lb).attr("width",xb).attr("height",G)):"eye_color"===o?(G=O,Lb=qb-zb(0)-10-La/20*N*3-10-(O+1)*D+(O-G),Bb.append("rect").attr("fill",zc).attr("x",yb(E)).attr("y",Lb).attr("width",xb).attr("height",G)):(G=O/Ac*k,Lb=qb-zb(0)-10-La/20*N*3-10-(O+1)*D+(O-G),Bb.append("rect").attr("fill",uc).attr("x",yb(E)).attr("y",Lb).attr("width",xb).attr("height",G))}else Bb.append("rect").attr("fill",aa).attr("x",yb(E)).attr("y",qb-zb(0)-10-La/20*N*3-10-(O+1)*(Fa-Ja)).attr("width",xb).attr("height",(O+1)*(Fa-1-Ja)-1);E++}if("expressionData"===e){D=0,v=Ua[e]["sample type"],(v.p||0===v.p)&&(s=v.p,"failed"!==s&&(B="#aaa",C="normal",A=parseFloat(s),.05>A&&(B="#666",C="bold"),s=A<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+s,Bb.append("text").attr("x",yb(d)+4*xb).attr("y",qb-zb(0)-10-La/20*N*3-10-(O+1)*D-4).attr("font-size",S).attr("font-weight",C).attr("font-family",T).attr("fill",B).text(s))),"BRCA breast invasive carcinoma"===c&&D++;for(o in Ha)D++,v=Ua[e][o],v.p||0===v.p?(s=v.p,"failed"!==s&&(B="#aaa",C="normal",A=parseFloat(s),.05>A&&(B="#666",C="bold"),s=A<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+s,Bb.append("text").attr("x",yb(d)+4*xb).attr("y",qb-zb(0)-10-La/20*N*3-10-(O+1)*D-4).attr("font-size",S).attr("font-weight",C).attr("font-family",T).attr("fill",B).text(s))):v.r&&(w=v.r,"failed"!==w&&(s=parseFloat(v.rp),x=formatCorrelation(w,s),y="#aaa",z="normal",.05>s&&(y="#666",z="bold"),Bb.append("text").attr("x",yb(d)+4*xb).attr("y",qb-zb(0)-10-La/20*N*3-10-(O+1)*D-4).attr("font-size",S).attr("font-weight",z).attr("font-family",T).attr("fill",y).text(x)));F=Fa-Ja;for(H in Ka)I=Ka[H],v=Ua.expressionData[I],v.r&&(w=v.r,"failed"!==w&&(s=parseFloat(v.rp),x=formatCorrelation(w,s),y="#aaa",z="normal",.05>s&&(y="#666",z="bold"),Bb.append("text").attr("x",yb(E)+4*xb).attr("y",qb-zb(0)-10-La/20*N*3-10-(O+1)*F-4).attr("class",I).attr("font-size",S).attr("font-weight",z).attr("font-family",T).attr("fill",y).text(x))),F++}else if("sample type"===e){v=Ua[e].expressionData,v.n?(p=v.n,Bb.append("text").attr("x",yb(d)+4*xb).attr("y",qb-zb(0)-10-La/20*N).attr("font-size",S).attr("font-family",T).attr("fill","#aaa").text(p)):(v.p||0===v.p)&&(s=v.p,"failed"!==s&&(B="#aaa",C="normal",A=parseFloat(s),.05>A&&(B="#666",C="bold"),s=A<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+s,Bb.append("text").attr("x",yb(d)+4*xb).attr("y",qb-zb(0)-10-La/20*N).attr("font-size",S).attr("font-weight",C).attr("font-family",T).attr("fill",B).text(s))),Qb=0;for(g in sc)Qb++,v=Ua[e][sc[g]],(v.p||0===v.p)&&(s=v.p,"failed"!==s&&(B="#aaa",C="normal",A=parseFloat(s),.05>A&&(B="#666",C="bold"),s=A<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+s,Bb.append("text").attr("x",yb(d)+4*xb).attr("y",qb-zb(Qb-1)+N-4).attr("font-size",S).attr("font-weight",C).attr("font-family",T).attr("fill",B).text(s)))}else v=Ua[e].expressionData,v.p||0===v.p?(s=v.p,"failed"!==s&&(B="#aaa",C="normal",A=parseFloat(s),.05>A&&(B="#666",C="bold"),s=A<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+s,Bb.append("text").attr("x",yb(d)+4*xb).attr("y",qb-zb(0)-10-La/20*N).attr("font-size",S).attr("font-weight",C).attr("font-family",T).attr("fill",B).text(s))):v.r&&(w=v.r,
"failed"!==w&&(s=parseFloat(v.rp),x=formatCorrelation(w,s),y="#aaa",z="normal",.05>s&&(y="#666",z="bold"),Bb.append("text").attr("x",yb(d)+4*xb).attr("y",qb-zb(0)-10-La/20*N).attr("font-size",S).attr("font-weight",z).attr("font-family",T).attr("fill",y).text(x)));D=0,Bb.append("text").attr("x",-4).attr("y",qb-zb(0)-10-La/20*N*3-10-(N+1)*D-4).attr("class","clickable").attr("font-size","12px").attr("fill","#aaa").attr("id","sample type").attr("text-anchor","end").text("sample type").on("mouseup",function(){var f=$(this).text();f=f.replace(/\u2192 /,""),f!==e&&updatePlot(a,b,c,d,f)}),"BRCA breast invasive carcinoma"===c&&(D++,Bb.append("text").attr("x",-4).attr("y",qb-zb(0)-10-La/20*N*3-10-(N+1)*D).attr("class","clickable").attr("font-size","12px").attr("fill","#aaa").attr("id","PAM50 subtype").attr("text-anchor","end").text("PAM50 subtype").on("mouseup",function(){var f=$(this).text();f=f.replace(/\u2192 /,""),f!==e&&updatePlot(a,b,c,d,f)}));for(o in Ha)D++,o=o.replace(/_/g," "),Bb.append("text").attr("x",-4).attr("y",qb-zb(0)-10-La/20*N*3-10-(O+1)*D-4).attr("class","clickable").attr("font-size","12px").attr("fill","#aaa").attr("id",o.replace(/ /g,"_")).attr("text-anchor","end").text(o).on("mouseup",function(){var f=$(this).text();f=f.replace(/ /g,"_"),f=f.replace(/\u2192_/,""),f!==e&&updatePlot(a,b,c,d,f)}),q=o.replace(/ /g,"_"),q!==e&&"expressionData"!==e&&(v=Ua[e][q],v.p||0===v.p?(s=v.p,"failed"!==s&&(B="#aaa",C="normal",A=parseFloat(s),.05>A&&(B="#666",C="bold"),s=A<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+s,Bb.append("text").attr("x",yb(d)+4*xb).attr("y",qb-zb(0)-10-La/20*N*3-10-(O+1)*D-4).attr("font-size",S).attr("font-weight",C).attr("font-family",T).attr("fill",B).text(s))):v.r&&(w=v.r,"failed"!==w&&(s=parseFloat(v.rp),x=formatCorrelation(w,s),y="#aaa",z="normal",.05>s&&(y="#666",z="bold"),Bb.append("text").attr("x",yb(d)+4*xb).attr("y",qb-zb(0)-10-La/20*N*3-10-(O+1)*D-4).attr("font-size",S).attr("font-weight",z).attr("font-family",T).attr("fill",y).text(x))))}if("no_data"!==a.slide){E=0;a.slide.numberOfSlideFields;Ka=[];for(j in Ta)if(f=Ta[j],"no_data"!==Qa[f]){for(J in Qa[f])-1===$.inArray(J,Ka)&&Ka.push(J);break}for(j in Ta){if(f=Ta[j],"no_data"!==Qa[f]){var Bc;Bc=E%2===0?ja:ka,F=Fa-Ja;for(J in Qa[f])F++,slideFieldValue=Qa[f][J],"undefined"!=typeof Qa[f][J]&&(G=O/100*slideFieldValue,Lb=qb-zb(0)-10-La/20*N*3-10-(O+1)*F+(O-G),Bb.append("rect").attr("fill",Bc).attr("x",yb(E)).attr("y",Lb).attr("width",xb).attr("height",G).attr("class",J))}else{F=Fa-Ja;for(H in Ka)F++,Bb.append("rect").attr("fill",aa).attr("x",yb(E)).attr("y",qb-zb(0)-10-La/20*N*3-10-(O+1)*F-1).attr("width",xb).attr("height",O+1).attr("class",Ka[H])}E++}F=Fa-Ja;for(H in Ka)I=Ka[H],o=I.replace(/_/g," "),Bb.append("text").attr("x",-4).attr("y",qb-zb(0)-10-La/20*N*3-10-(O+1)*F-4).attr("class",I+" clickable").attr("font-size","12px").attr("fill","#aaa").attr("id",I).attr("text-anchor","end").text(o).on("mouseup",function(){var f=$(this).text();f=f.replace(/ /g,"_"),f=f.replace(/\u2192_/,""),f!==e&&updatePlot(a,b,c,d,f)});F=Fa-Ja;for(H in Ka)I=Ka[H],I!==e&&"expressionData"!==e&&(v=Ua[e][I],v.r?(w=v.r,"failed"!==w&&(s=parseFloat(v.rp),x=formatCorrelation(w,s),y="#aaa",z="normal",.05>s&&(y="#666",z="bold"),Bb.append("text").attr("x",yb(E)+4*xb).attr("y",qb-zb(0)-10-La/20*N*3-10-(O+1)*F-4).attr("class",I).attr("font-size",S).attr("font-weight",z).attr("font-family",T).attr("fill",y).text(x))):(v.p||0===v.p)&&(s=v.p,"failed"!==s&&(B="#aaa",C="normal",A=parseFloat(s),.05>A&&(B="#666",C="bold"),s=A<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+s,Bb.append("text").attr("x",yb(d)+4*xb).attr("y",qb-zb(0)-10-La/20*N*3-10-(O+1)*F-4).attr("class",I).attr("font-size",S).attr("font-weight",C).attr("font-family",T).attr("fill",B).text(s)))),F++}document.getElementById(e).setAttribute("font-weight","bold"),document.getElementById(e).setAttribute("font-size","13px"),document.getElementById(e).setAttribute("fill","rgb(100,100,100)");var Cc=e.replace(/_/g," ");Cc=Cc.replace(/Data/,"");var Dc=document.getElementById(e).firstChild;Dc.nodeValue="► "+Cc,Bb.append("text").attr("x",vb+tb-12).attr("y",qb-zb(0)-10-La/20*N*3-10-(O+1)*Fa-14).attr("font-size",S).attr("font-family",T).attr("text-anchor","end").attr("fill","#aaa").text("comparison to: "+Cc),Bb.append("line").attr("x1",vb+tb-12).attr("x2",vb+tb-12-6.6*Cc.length).attr("y1",qb-zb(0)-10-La/20*N*3-10-(O+1)*Fa-10).attr("y2",qb-zb(0)-10-La/20*N*3-10-(O+1)*Fa-10).style("stroke","#aaa").attr("stroke-width",1).attr("shape-rendering","crispEdges");var Ec=a.geneInfo.ensembl,Fc=a.geneInfo.hgnc,Gc=a.geneInfo.chr,Hc=a.geneInfo.start;Hc=Hc.toString();for(var Ic="";Hc.length>=3;)Ic=Hc.substring(Hc.length-3)+","+Ic,Hc=Hc.substring(0,Hc.length-3);Ic=Hc+","+Ic,Ic=Ic.replace(/,$/,""),Ic=Ic.replace(/^,/,"");var Jc=a.geneInfo.end;Jc=Jc.toString();for(var Kc="";Jc.length>=3;)Kc=Jc.substring(Jc.length-3)+","+Kc,Jc=Jc.substring(0,Jc.length-3);Kc=Jc+","+Kc,Kc=Kc.replace(/,$/,""),Kc=Kc.replace(/^,/,"");var Lc="chr"+Gc+":"+Ic+"-"+Kc;""===Fc?$(".plotInfo").html("<p><strong>"+Ec+"</strong> <a href='http://genome.ucsc.edu/cgi-bin/hgTracks?db=hg19&position="+Lc+"' target='_blank' title='This link will take you to the UCSC Genome Browser'>"+Lc+"</a></p>"):$(".plotInfo").html("<p><strong><a href='http://www.genecards.org/cgi-bin/carddisp.pl?gene="+Fc+"' target='_blank' title='This link will take you to the GeneCards.org page for "+Fc+".'>"+Fc+"</a></strong> <span class='ensembl'>"+Ec+"</span> <a href='http://genome.ucsc.edu/cgi-bin/hgTracks?db=hg19&position="+Lc+"' target='_blank' title='This link will take you to the UCSC Genome Browser'>"+Lc+"</a></p>"),$(".plotInfo").append("<div class='promoterSelectionButton noselect'>highlight promoter probes</div>"),$(".promoterSelectionButton").click(function(){$(".prom").each(function(){var a,b=$(this);b.is("path")?b.attr("class").match(/line/)?(a=b.attr("stroke"),a===fa?b.attr("stroke",ha):b.attr("stroke",fa)):(a=b.attr("fill"),a===ea?b.attr("fill",ga):b.attr("fill",ea)):b.is("text")?(a=b.attr("fill"),a===ia?b.attr("fill",ha):b.attr("fill",ia)):b.is("line")&&(a=b.attr("stroke"),a===Z?b.attr("stroke",_):b.attr("stroke",Z))})}),prepareSvgForDownload(b,c,e)}function checkUserInput(){$("#userInputForm .inputButton").toggleClass("inactive"),removeMessages();var a=$("#gene").val();a=a.replace(/[<>\\\/;'"()=\[\]\{\}]/g,"");var b=$(".sampleSelectionList").find(".selectedSample").text();""===a?($("#userInputForm .inputButton").toggleClass("inactive"),$("#userInputForm .inputButton").click(!0),$("#gene").focus(),$('<div class="warningMessage">Don\'t forget to enter a gene name!</div>').hide().appendTo("#userInputForm").fadeIn(200)):""===b?($("#userInputForm .inputButton").toggleClass("inactive"),$("#userInputForm .inputButton").click(!0),$('<div class="warningMessage">Don\'t forget to select a source!</div>').hide().appendTo("#userInputForm").fadeIn(200)):""!==a&&""!==b&&plotPreparation()}function plotPreparation(){removeMessages();var a=$("#gene").val();a=a.replace(/[<>\\\/;'"()=\[\]\{\}]/g,"");var b=$(".sampleSelectionList").find(".selectedSample").find(".sourceName").text(),c=$(".sampleSelectionList").find(".selectedSample").find(".fullSourceName").attr("title"),d=b+" "+c;$(".downloadButton").remove(),$(".loadingAnimation").show(),$(".plotContainer").css("background","#FFF"),$(".plotContainer").css("border","none"),$(".plotWindow").toggleClass("transparent"),$(".plotInfo").toggleClass("transparent"),$("svg").length&&($(".plotInfo").empty(),$(".plotWindow").empty());$.ajax({type:"POST",url:"php/numberOfSamples.php?source="+d,dataType:"json",success:function(b){var c=b.nrow;$('<div class="infoMessage">'+c+" samples selected</div>").hide().appendTo("#userInputForm").fadeIn(500),createNewPlot(a,d,c)},error:function(){$('<div class="errorMessage">Database error.<br>(could not retrieve the number of samples)</div>').hide().appendTo("#userInputForm").fadeIn(500),$(".plotWindow").toggleClass("hidden"),$("#userInputForm .inputButton").toggleClass("inactive"),$(".loadingAnimation").hide(),$(".plotContainer").css("background","#f6f6f6"),$(".plotContainer").css("border","4px solid #efefef")}})}function removeMessages(){$(".errorMessage").length>0&&$(".errorMessage").remove(),$(".warningMessage").length>0&&$(".warningMessage").remove(),$(".infoMessage").length>0&&$(".infoMessage").remove()}function numberOfLevels(a){var b=[];for(var c in a){var d=a[c];-1===$.inArray(d,b)&&null!==d&&void 0!==d&&b.push(d)}var e=b.length;return e}$(function(){$(window).scroll(function(){$("header").css({left:$(this).scrollLeft()})}),$("input[type=text]").focus(),windowWidth=$(window).width(),inputWidth=$(".userInput").outerWidth(),plotWidth=windowWidth-inputWidth-28,$(".plotContainer").width(plotWidth);var a,b;$(function(){a={serviceUrl:"php/autocomplete.php",minChars:1,maxHeight:200,deferResquestBy:0},b=$("#gene").autocomplete(a)}),$(".sampleSelectionElement").click(function(){var a=$(this);$(".sampleSelectionElement").each(function(){$(this).hasClass("selectedSample")&&$(this).toggleClass("selectedSample")}),a.toggleClass("selectedSample")})});