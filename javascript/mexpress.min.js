function pAdjust(a,b){if("bh"===b){for(var c=a.length,d=[],e=c;e>0;e--)d.push(e);for(var f=[],e=0;c>e;e++)f[e]=[a[e],e];for(var g,h=nestedArraySort(f,!0,0),e=0;c>e;e++){var i=h[e][0]*c/d[e];0!==e?g>i?g=i:i=g:g=i,i>1&&(i=1),h[e][0]=i}h=nestedArraySort(h,!1,1),result=[];for(var d=0;d<h.length;d++)result.push(h[d][0]);return result}}function pearsonCorrelation(a,b){if(a.length!==b.length)return"failed";var c=[],d=[];for(var e in b)isNaN(b[e])||isNaN(a[e])||(d.push(+b[e]),c.push(+a[e]));if(d.length>10){var f=d.length,g=0,h=0,i=0,j=0,k=0;for(var e in d)g+=c[e],i+=Math.pow(c[e],2),h+=d[e],j+=Math.pow(d[e],2),k+=c[e]*d[e];var l=k-g*h/f,m=Math.sqrt(i-Math.pow(g,2)/f)*Math.sqrt(j-Math.pow(h,2)/f),n=l/m,o=d.length-2,p=Math.abs(n/Math.sqrt((1-Math.pow(n,2))/o)),e=tDistribution(o,p);return{r:n,p:e}}return"failed"}function mean(a){for(var b=a.length,c=0,d=0;b>d;d++)c+=a[d];var e=c/b;return e}function variance(a){for(var b=a.length,c=mean(a),d=0,e=0;b>e;e++)d+=Math.pow(a[e]-c,2);var f=d/b;return f}function degreesOfFreedom(a,b){var c=a.length,d=b.length,e=variance(a),f=variance(b),g=Math.pow(e/c+f/d,2),h=Math.pow(e/c,2)/(c-1)+Math.pow(f/d,2)/(d-1),i=g/h;return i}function tDistribution(a,b){var c=.049867347,d=.0211410061,e=.0032776263,f=380036e-10,g=488906e-10,h=5383e-9,i=b*(1-1/(4*a))/Math.sqrt(1+Math.pow(b,2)/(2*a)),j=2*(1/(2*Math.pow(1+c*i+d*Math.pow(i,2)+e*Math.pow(i,3)+f*Math.pow(i,4)+g*Math.pow(i,5)+h*Math.pow(i,6),16)));return j}function tTest(a,b){for(var c in a)isNaN(a[c])&&(a[c]=null);for(var c in b)isNaN(b[c])&&(b[c]=null);if(a.some(function(a){return null!==a})){if(b.some(function(a){return null!==a})){var d=a.length,e=b.length;if(d>=3&&e>=3){var f=mean(a),g=mean(b),h=variance(a),i=variance(b),j=(f-g)/Math.sqrt(h/d+i/e);j=Math.abs(j);var k=degreesOfFreedom(a,b),l=tDistribution(k,j);return l}return"failed"}return"failed"}return"failed"}function nestedArraySort(a,b,c){return b?a.sort(function(a,b){return a=a[c],b=b[c],a===b?0:a>b?-1:1}):a.sort(function(a,b){return a=a[c],b=b[c],a===b?0:b>a?-1:1}),a}function wilcoxonRankSumTest(a,b){var c=[],d=[];for(var e in a)a[e]&&"null"!==a[e]&&c.push(+a[e]);for(var e in b)b[e]&&"null"!==b[e]&&d.push(+b[e]);var f=c.length,g=d.length;if(3>f||3>g)return"failed";var h=f*g/2,i=Math.sqrt(f*g*(f+g+1)/12),j=[];for(var e in c)j.push([c[e],1]);for(var e in d)j.push([d[e],2]);var k=nestedArraySort(j,!1,0),l=[],m=[];for(var e in k)l.push(k[e][0]),m.push(k[e][1]);var n=[];for(var e in k){var o=k[e][0],p=l.indexOf(o)+1;n.push(p)}var q=0,r=0;for(var e in m){var s=m[e];1===s?q+=n[e]:r+=n[e]}var t=f*g+f*(f+1)/2-q,u=(t-h)/i;u=Math.abs(u);var c=u/Math.sqrt(2),v=1/(1+.5*c),w=v*Math.exp(-Math.pow(c,2)-1.26551223+1.00002368*v+.37409196*Math.pow(v,2)+.09678418*Math.pow(v,3)-.18628806*Math.pow(v,4)+.27886807*Math.pow(v,5)-1.13520398*Math.pow(v,6)+1.48851587*Math.pow(v,7)-.82215223*Math.pow(v,8)+.17087277*Math.pow(v,9)),x=1-w,y=2*(1-.5*(1+x));return y}function prepareSvgForDownload(a,b,c){$(".downloadButton").remove(),$(".downloadText").remove(),$(".plotInfo p").append("<div class='download'></div>"),$(".download").append("<div class='downloadButton png'>png</div>"),$(".download").append("<div class='downloadButton svg'>svg</div>"),$(".download").append("<div class='downloadText'>download a png or svg version of the figure</div>"),$(".downloadButton").css("visibility","visible").hide().fadeIn(1e3),$(".downloadButton").mouseenter(function(){$(".downloadText").css("visibility","visible").hide().fadeIn(100)}).mouseleave(function(){$(".downloadText").css("visibility","hidden")}),$(".downloadButton.png").click(function(){var d=d3.select("svg").attr("version",1.1).attr("xlmns","http://www.w3.org/2000/svg").node().parentNode.innerHTML;$(this).html("<img src='images/arrowLoader.gif'>"),downloadSvg(a,b,c,d,"png")}),$(".downloadButton.svg").click(function(){var d=d3.select("svg").attr("version",1.1).attr("xlmns","http://www.w3.org/2000/svg").node().parentNode.innerHTML;$(this).html("<img src='images/arrowLoader.gif'>"),downloadSvg(a,b,c,d,"svg")})}function createDownloadLink(a,b){var c=a.replace(/^.+\//,""),d=document.createElement("a");d["class"]="downloadLink",d.download=c,d.target="_blank",d.href=a,document.body.appendChild(d),d.click(),"png"===b?$(".downloadButton.png").html("png"):"svg"===b&&$(".downloadButton.svg").html("svg")}function downloadSvg(a,b,c,d,e){var f=encodeURIComponent(d),g=$(".containsProbeId").attr("id"),h="";if(void 0!==g){var h=g.replace(/^.+?_/,"");h=h.replace(/_.+$/,"")}$.ajax({data:"fileType="+e+"&gene="+a+"&source="+b+"&sorter="+c+"&probe="+h+"&svgHtml="+f,url:"php/svg2png.php",method:"POST",success:function(a){var b=a;b="php/"+b,createDownloadLink(b,e)}})}function createNewPlot(a,b,c){d3.json("php/geneNameQuery.php?gene="+a+"&source="+b,function(d,e){var f=e,g=f.success;if(g){var h="expressionData";createPlot(f,a,b,c,h)}else{var i=f.message;$('<div class="errorMessage">'+i+"</div>").hide().appendTo("#userInputForm").fadeIn(200),$(".plotWindow").toggleClass("hidden"),$(".plotContainer").css("background","#F6F6F6"),$(".plotContainer").css("border-bottom","4px solid #EFEFEF;")}$(".loadingAnimation").hide(),$(".plotWindow").toggleClass("transparent"),$(".plotInfo").toggleClass("transparent"),$("#userInputForm .inputButton").toggleClass("inactive"),$("#extraSelectionForm .inputButton").toggleClass("inactive")})}function formatCorrelation(a,b){var c=a.toPrecision(3);return a>0&&(c="+"+c),c="r = "+c,.001>b?c+=" ***":.01>b?c+=" **":.05>b&&(c+=" *"),c}function sortData(a,b){var c=[],d=[];for(var e in a.expressionData)d.push(e);var f=d;if("expressionData"===b){var g=[];for(var e in a.expressionData){var h=a.expressionData[e];g.push({key:e,val:h})}g.sort(function(a,b){return b.val-a.val});for(var i in g)c.push(g[i].key)}else if("sample type"===b){var j=[];for(var e in a.expressionData){var k=e.replace(/^.+_(\d\d)$/,"$1");j.push({key:e,val:k})}j.sort(function(a,b){return b.val-a.val});for(var i in j)c.push(j[i].key)}else if("PAM50 subtype"===b){var j=[],l=[];for(var m in d){var e=d[m];e in a.pam50?j.push({key:e,val:a.pam50[e]}):l.push(e)}j.sort(function(a,b){var c=a.val.toLowerCase(),d=b.val.toLowerCase();return d>c?-1:c>d?1:0});for(var i in j)c.push(j[i].key);c=c.concat(l)}else{for(p in a.annotation){var n=a.annotation[p];break}for(m in a.slide){var o=a.slide[m];break}if(b in n){var q="annotation",r=[],s=[];for(var m in a[q])if("numberOfAnnotationFields"!=m){var t=a[q][m][b];null!==t?(t=+t,r.push({key:m,val:t})):s.push({key:m,val:t})}r.sort(function(a,b){return b.val-a.val}),r=r.concat(s);for(var i in r)for(var u=r[i].key,v=RegExp(u),w=d.length-1;w>=0;w--){var x=d[w],y=x.match(v);if(null!=y){c.push(x);var z=$.inArray(x,f);f.splice(z,1)}}c=c.concat(f)}else if(b in o){var q="slide",r=[],s=[];for(var m in a[q])if("numberOfSlideFields"!==m){var t=a[q][m][b];null!==t?(t=+t,r.push({key:m,val:t})):s.push({key:m,val:t})}r.sort(function(a,b){return b.val-a.val}),r=r.concat(s);for(var i in r)for(var e=r[i].key,w=d.length-1;w>=0;w--)d[w]===e&&(c.push(e),d.splice(w,1));c=c.concat(d)}}return c}function updatePlot(a,b,c,d,e){$(".plotInfo").empty(),$(".plotWindow").empty(),createPlot(a,b,c,d,e)}function createPlot(a,b,c,d,e){windowWidth=$(window).width(),inputWidth=$(".userInput").outerWidth(),plotWidth=windowWidth-inputWidth-28;var f=18,g=14,h=4,i=3,j=2,k="11px",l="Courier New",m="#F59322",o="#4BC722",p="#FFEDC2",q="#FFC842",r="#999",s="#ACD2F2",t="#1A70BA",u="#F9F9F9",v="#FFD57A",w="#F59322",x="#FFD161",y="#AAD5FA",z="#4999DE",A="#63ACEB",B="#14568F",C="#b6d3f2",D="#DCE1E6",E="#C5CCD4",F="#FA89CA",G="#F272BB",H="#98D3FA",I="#7FC3F0",J="#98D3FA",K="#4999DE",L="#944E07",M="#693705",N="#73CC5B",O="#37AC19",P={Normal:"#4999DE",Basal:"#FFC03B",Her2:"#FF983B",LumA:"#73CC5B",LumB:"#37AC19","no data":u},Q={"01":"primary solid tumor","02":"recurrent solid tumor","03":"primary blood derived cancer - peripheral blood","04":"recurrent blood derived cancer - bone marrow","05":"additional - new primary","06":"metastatic","07":"additional metastatic","08":"human tumor original cells","09":"primary blood derived cancer - bone marrow",10:"blood derived normal",11:"solid tissue normal",12:"buccal cell normal",13:"EBV immortalized normal",14:"bone marrow normal",20:"control analyte",40:"recurrent blood derived cancer - peripheral blood",50:"cell lines",60:"primary xenograft tissue",61:"cell line derived xenograft tissue"},R={"01":"#98D3FA","02":"#F7A972","03":"#F2766F","04":"#DB7346","05":"#3FD19B","06":"#FFD161","07":"#D13F75","08":"#6FF0F2","09":"#F29B6F",10:"#9DC9F5",11:"#4999DE",12:"#4198F0",13:"#0F73D6",14:"#90D8F5",20:"#46BFF0",40:"#DB4E46",50:"#F07746",60:"#A17FAD",61:"#8A38A8"},S=a.numberOfProbes,T=a.geneInfo,U=+T.start,V=+T.end,W=T.strand,X=a.transcripts,Y=a.cpgi,Z=0,_=!1,aa=new Object,ba=[];n=+a.annotation.numberOfAnnotationFields,n>Z&&(Z=n);for(var ca in a.annotation)for(var da in a.annotation[ca]){-1===$.inArray(da,ba)&&ba.push(da),"gender"===da&&(_=!0);var ea=parseFloat(a.annotation[ca][da]);isNaN(ea)?aa.hasOwnProperty(da)||(aa[da]=0):aa.hasOwnProperty(da)?ea>aa[da]&&(aa[da]=ea):aa[da]=ea}Z++;var fa=0,ga=[];if("no_data"!==a.slide){n=+a.slide.numberOfSlideFields,n>fa&&(fa=n);for(ca in a.slide)if("numberOfSlideFields"!==ca){for(var ha in a.slide[ca])ga.push(ha);break}}Z+=fa,"BRCA breast invasive carcinoma"===c&&Z++;var ia=0;for(var ca in a.expressionData)expr=+a.expressionData[ca],expr>ia&&(ia=expr);var ja=sortData(a,e),ka=[],la=[],ma=[],na=[],oa=[];for(var ca in a.methylationData){for(var pa in a.methylationData[ca])oa.push(pa);break}var qa={};for(var pa in oa)qa[oa[pa]]=[];var ra=[];for(var sa in ja){var ca=ja[sa];if(a.methylationData[ca]){ra.push(ca),ka[ca]=a.methylationData[ca];for(var pa in oa)qa[oa[pa]].push(a.methylationData[ca][oa[pa]]);var ta=ca.replace(/_\d\d$/,"");a.annotation[ta]?ma[ta]=a.annotation[ta]:ma[ta]="no_annotation",a.slide[ca]?na[ca]=a.slide[ca]:na[ca]="no_data";var ua=a.expressionData[ca];la[ca]=ua}}var va={};va.expressionData={},va["sample type"]={},va["PAM50 subtype"]={};for(var ca in a.annotation){for(var wa in a.annotation[ca])va[wa]={};break}for(var ca in a.slide){for(var wa in a.slide[ca])va[wa]={};break}for(var ha in va){var xa={},ya=[];if("expressionData"===ha)xa=a[ha];else if(-1!==$.inArray(ha,ba))for(var ta in a.annotation)xa[ta]=a.annotation[ta][ha];else if(-1!==$.inArray(ha,ga))for(var ca in a.slide)xa[ca]=a.slide[ca][ha];else if("sample type"===ha)for(var sa in ra){var ca=ra[sa],za=ca.replace(/^.+_(\d\d)$/,"$1");"10"===za||"11"===za||"12"===za||"13"===za||"14"===za?xa[ca]="1":xa[ca]="0"}else if("PAM50 subtype"===ha)for(var sa in ra){var ca=ra[sa];ca in a.pam50?xa[ca]=a.pam50[ca]:xa[ca]="no data"}for(var Aa in xa)ya.push(xa[Aa]);var Ba=numberOfLevels(ya);if("expressionData"!==ha)if(2===Ba){var Ca=[],Da=[];for(var ca in la){var ta=ca.replace(/_\d\d$/,"");if("no_annotation"!==ma[ta]){if("sample type"!==ha)var ea=ma[ta][ha];else var ea=xa[ca];"1"===ea?Ca.push(la[ca]):"0"===ea&&Da.push(la[ca])}}var Ea=wilcoxonRankSumTest(Ca,Da);va[ha].expressionData={p:Ea}}else if(Ba>2&&"PAM50 subtype"!==ha&&"eye_color"!==ha&&"batch number"!==ha){var Ca=[],Da=[];for(var sa in ra){var ca=ra[sa];if(Ca.push(la[ca]),-1!==$.inArray(ha,ba)){var ta=ca.replace(/_\d\d$/,"");Da.push(xa[ta])}else Da.push(xa[ca])}var Ea=pearsonCorrelation(Ca,Da);va[ha].expressionData={r:Ea.r,rp:Ea.p}}else va[ha].expressionData={n:"no normals"};for(var Fa in oa)if(2===Ba){var Ca=[],Da=[];for(var sa in ra){var ca=ra[sa],ta=ca.replace(/_\d\d$/,"");if("no_annotation"!==ma[ta]){if("sample type"!==ha)var ea=ma[ta][ha];else var ea=xa[ca];"1"===ea?Ca.push(ka[ca][oa[Fa]]):"0"===ea&&Da.push(ka[ca][oa[Fa]])}}var Ea=wilcoxonRankSumTest(Ca,Da);va[ha][oa[Fa]]={p:Ea}}else if(Ba>2&&"PAM50 subtype"!==ha&&"eye_color"!==ha&&"batch number"!==ha){var Ca=[],Da=[];for(var sa in ra){var ca=ra[sa];if(Ca.push(ka[ca][oa[Fa]]),-1!==$.inArray(ha,ba)){var ta=ca.replace(/_\d\d$/,"");Da.push(xa[ta])}else Da.push(xa[ca])}var Ea=pearsonCorrelation(Ca,Da);va[ha][oa[Fa]]={r:Ea.r,rp:Ea.p}}else va[ha][oa[Fa]]={n:"failed"};for(var Ga in ba){var Ha=ba[Ga];if(Ha!==ha){var Ia=[];for(var Fa in ma)Ia.push(ma[Fa][Ha]);var Ja=numberOfLevels(Ia);if(2===Ba)if(2===Ja)va[ha][Ha]={n:"failed"};else if(Ja>2){var Ca=[],Da=[];for(var sa in ra){var ca=ra[sa],ta=ca.replace(/_\d\d$/,"");if("no_annotation"!==ma[ta]){if("sample type"!==ha)var ea=ma[ta][ha];else var ea=xa[ca];"1"===ea?Ca.push(ma[ta][Ha]):"0"===ea&&Da.push(ma[ta][Ha])}}var Ea=wilcoxonRankSumTest(Ca,Da);va[ha][Ha]={p:Ea}}else va[ha][Ha]={n:"failed"};else if(Ba>2&&"PAM50 subtype"!==ha&&"eye_color"!==ha&&"batch number"!==ha)if(2===Ja){var Ca=[],Da=[];for(var sa in ra){var ca=ra[sa],ta=ca.replace(/_\d\d$/,"");if("no_annotation"!==ma[ta]){var ea=ma[ta][Ha];"1"===ea?-1!==$.inArray(ha,ba)?xa[ta]&&Ca.push(xa[ta]):xa[ca]&&Ca.push(xa[ca]):"0"===ea&&(-1!==$.inArray(ha,ba)?xa[ta]&&Da.push(xa[ta]):xa[ca]&&Da.push(xa[ca]))}}var Ea=wilcoxonRankSumTest(Ca,Da);va[ha][Ha]={p:Ea}}else if(Ja>2){var Ca=[],Da=[];for(var sa in ra){var ca=ra[sa],ta=ca.replace(/_\d\d$/,"");-1!==$.inArray(ha,ba)?xa[ta]&&(Ca.push(xa[ta]),Da.push(ma[ta][Ha])):xa[ca]&&(Ca.push(xa[ca]),Da.push(ma[ta][Ha]))}var Ea=pearsonCorrelation(Ca,Da);va[ha][Ha]={r:Ea.r,rp:Ea.p}}else va[ha][Ha]={n:"failed"};else va[ha][Ha]={n:"failed"}}}for(var sa in ga){var Ha=ga[sa];if(Ha!==ha)if(2===Ba){var Ca=[],Da=[];for(var sa in ra){var ca=ra[sa],ta=ca.replace(/_\d\d$/,"");if("sample type"!==ha)var ea=ma[ta][ha];else var ea=xa[ca];"1"===ea?Ca.push(na[ca][Ha]):"0"===ea&&Da.push(na[ca][Ha])}var Ea=wilcoxonRankSumTest(Ca,Da);va[ha][Ha]={p:Ea}}else if(Ba>2&&"PAM50 subtype"!==ha&&"eye_color"!==ha&&"batch number"!==ha){var Ca=[],Da=[];for(var sa in ra){var ca=ra[sa],ta=ca.replace(/_\d\d$/,"");-1!==$.inArray(ha,ba)?xa[ta]&&(Ca.push(xa[ta]),Da.push(na[ca][Ha])):(Ca.push(xa[ca]),Da.push(na[ca][Ha]))}var Ea=pearsonCorrelation(Ca,Da);va[ha][Ha]={r:Ea.r,rp:Ea.p}}else va[ha][Ha]={n:"failed"}}if("sample type"!==ha){var Ka={},La=[];for(var sa in ra){var ca=ra[sa],za=ca.replace(/^.+_(\d\d)$/,"$1");"10"===za||"11"===za||"12"===za||"13"===za||"14"===za?(Ka[ca]="1",La.push("1")):(Ka[ca]="0",La.push("0"))}var Ma=numberOfLevels(La);if(2===Ma){if(2===Ba)va[ha]["sample type"]={n:"failed"};else if(Ba>2&&"PAM50 subtype"!==ha&&"eye_color"!==ha&&"batch number"!==ha){var Ca=[],Da=[];for(var sa in ra){var ca=ra[sa],ta=ca.replace(/_\d\d$/,""),Na=Ka[ca];"1"===Na?-1!==$.inArray(ha,ba)?xa[ta]&&Ca.push(xa[ta]):xa[ca]&&Ca.push(xa[ca]):"0"===Na&&(-1!==$.inArray(ha,ba)?xa[ta]&&Da.push(xa[ta]):xa[ca]&&Da.push(xa[ca]))}var Ea=wilcoxonRankSumTest(Ca,Da);va[ha]["sample type"]={p:Ea}}}else va[ha]["sample type"]={n:"no normal samples"}}}var Oa=[],Pa=[];for(var Aa in va[e]){var Qa=va[e][Aa];Qa.rp&&"failed"!==Qa.rp?(Oa.push(Qa.rp),Pa.push(Aa)):Qa.p&&"failed"!==Qa.p&&(Oa.push(Qa.p),Pa.push(Aa))}correctedPValues=pAdjust(Oa,"bh");for(var Ra=0;Ra<correctedPValues.length;Ra++){var Fa=correctedPValues[Ra];Fa=+Fa.toPrecision(3);var Sa=1e3*Fa;1>Sa&&(Fa=Fa.toExponential());var Qa=Pa[Ra];va[e][Qa].rp?va[e][Qa].rp=Fa:va[e][Qa].p&&(va[e][Qa].p=Fa)}yb=0;for(key in X)X.hasOwnProperty(key)&&yb++;wb=0;for(key in Y)Y.hasOwnProperty(key)&&wb++;var Ta=8+4*yb;wb>0&&(Ta+=5);var Ua=Math.abs(U-V);legendHeight=148;var Va=[];if("no_annotation"!==a.annotation)for(var sa in ra){var ca=ra[sa],za=ca.replace(/^.+_(\d\d)$/,"$1");-1===$.inArray(za,Va)&&Va.push(za)}Va.length>7&&(legendHeight=148+18*Va.length);var Wa=10+ia/20*f*3+10+(g+1)*Z+20+legendHeight,Xa=170+Ta,Ya=110,Za={top:Wa,left:Xa,bottom:40,right:Ya},$a=plotWidth-Xa-Ya,_a=600;if(_&&(_a=750),_a>$a&&($a=_a),10>S)var ab=10*f;else if(Ua>1e5&&40>S)var ab=40*f;else var ab=S*f;var bb=Math.floor($a/d);1>bb?bb=1:bb>6&&(bb=6),$a=bb*d;var cb=d3.scale.linear().range([0,$a]),db=d3.scale.linear().range([ab,0]),eb=(d3.svg.axis().scale(cb).orient("top"),d3.svg.line().defined(function(a){return null!=a}).x(function(a,b){return cb(b)+bb/2}).y(function(a){return a}));$(".plotWindow").removeClass("hidden");var fb=d3.select(".plotWindow").append("svg").attr("width",$a+Za.left+Za.right).attr("height",ab+Za.top+Za.bottom).attr("text-rendering","geometricPrecision").attr("font-family","arial").attr("font-size","12px").attr("fill","#666").append("g").attr("transform","translate("+Za.left+","+Za.top+")");cb.domain([0,d]),db.domain([0,S]);var gb=1e3;Ua/10>1e3&&(gb=Ua/10),gb>5e3&&(gb=5e3);var hb=U-gb,ib=V+gb,jb=(ib-hb)/S,kb=(U-hb)/jb,lb=(V-hb)/jb;if("1"===W)var mb=U-1e3,nb=U+500;else var mb=V-500,nb=V+1e3;var ob=-Xa+1,pb=-Wa+24;if(fb.append("text").attr("x",ob).attr("y",pb).attr("font-weight","bold").text("annotation"),fb.append("rect").attr("fill",m).attr("x",ob).attr("y",pb+8).attr("width",3).attr("height",12),fb.append("text").attr("x",ob+8).attr("y",pb+18).text("gene"),fb.append("rect").attr("fill",p).attr("x",ob).attr("y",pb+8+18).attr("width",3).attr("height",12),fb.append("text").attr("x",ob+8).attr("y",pb+36).text("transcript"),fb.append("rect").attr("fill",o).attr("x",ob).attr("y",pb+8+36).attr("width",3).attr("height",12),fb.append("text").attr("x",ob+8).attr("y",pb+54).text("CpG island"),ob+=90,fb.append("text").attr("x",ob).attr("y",pb).attr("font-weight","bold").text("data"),fb.append("rect").attr("fill",v).attr("x",ob).attr("y",pb+8).attr("width",3).attr("height",12),fb.append("text").attr("x",ob+8).attr("y",pb+18).text("RNA-seq v2 (log2)"),fb.append("rect").attr("fill",y).attr("x",ob).attr("y",pb+8+18).attr("width",3).attr("height",12),fb.append("text").attr("x",ob+8).attr("y",pb+36).text(a.platform),fb.append("rect").attr("fill",D).attr("x",ob).attr("y",pb+8+36).attr("width",3).attr("height",12),fb.append("text").attr("x",ob+8).attr("y",pb+54).text("slide/clinical data"),fb.append("rect").attr("fill",u).attr("x",ob).attr("y",pb+8+54).attr("width",3).attr("height",12),fb.append("text").attr("x",ob+8).attr("y",pb+72).text("missing data"),ob+=120,_&&(fb.append("text").attr("x",ob).attr("y",pb).attr("font-weight","bold").text("gender"),fb.append("rect").attr("fill",F).attr("x",ob).attr("y",pb+8).attr("width",3).attr("height",12),fb.append("text").attr("x",ob+8).attr("y",pb+18).text("female"),fb.append("rect").attr("fill",H).attr("x",ob).attr("y",pb+8+18).attr("width",3).attr("height",12),fb.append("text").attr("x",ob+8).attr("y",pb+36).text("male"),ob+=70),fb.append("text").attr("x",ob).attr("y",pb).attr("font-weight","bold").text("statistics"),fb.append("text").attr("x",ob).attr("y",pb+18).attr("font-size","14px").attr("font-family",l).text("p"),fb.append("text").attr("x",ob+16).attr("y",pb+18).text("Wilcoxon rank-sum test"),fb.append("text").attr("x",ob+16).attr("y",pb+18+14).attr("font-weight","bold").attr("font-size","11px").attr("font-family",l).text("p < 0.05"),fb.append("text").attr("x",ob+16+72).attr("y",pb+18+14).attr("fill","#aaa").attr("font-size","11px").attr("font-family",l).text("p ≥ 0.05"),fb.append("text").attr("x",ob).attr("y",pb+54).attr("font-size","14px").attr("font-family",l).text("r"),fb.append("text").attr("x",ob+16).attr("y",pb+54).text("Pearson correlation"),fb.append("text").attr("x",ob+16).attr("y",pb+54+14).attr("font-weight","bold").attr("font-size","11px").attr("font-family",l).text("***"),fb.append("text").attr("x",ob+16+32).attr("y",pb+54+14).attr("font-weight","bold").attr("font-size","11px").attr("font-family",l).text("p < 0.001"),fb.append("text").attr("x",ob+16).attr("y",pb+54+28).attr("font-weight","bold").attr("font-size","11px").attr("font-family",l).text("**"),fb.append("text").attr("x",ob+16+32).attr("y",pb+54+28).attr("font-weight","bold").attr("font-size","11px").attr("font-family",l).text("p < 0.01"),fb.append("text").attr("x",ob+16).attr("y",pb+54+42).attr("font-weight","bold").attr("font-size","11px").attr("font-family",l).text("*"),fb.append("text").attr("x",ob+16+32).attr("y",pb+54+42).attr("font-weight","bold").attr("font-size","11px").attr("font-family",l).text("p < 0.05"),fb.append("text").attr("x",ob+16+32).attr("y",pb+54+56).attr("fill","#aaa").attr("font-size","11px").attr("font-family",l).text("p ≥ 0.05"),ob+=160,"BRCA breast invasive carcinoma"===c){fb.append("text").attr("x",ob).attr("y",pb).attr("font-weight","bold").text("BRCA subtype");var Ra=0;for(var qb in P)"no data"!==qb&&(fb.append("rect").attr("fill",P[qb]).attr("x",ob).attr("y",pb+8+18*Ra).attr("width",3).attr("height",12),fb.append("text").attr("x",ob+8).attr("y",pb+18*(Ra+1)).text(qb),Ra++);ob+=106}fb.append("text").attr("x",ob).attr("y",pb).attr("font-weight","bold").text("sample type");var rb=0;for(sa in Va){var za=Va[sa],sb=Q[za];sb.length>26&&(sb=sb.substring(0,23),sb+="..."),fb.append("rect").attr("fill",R[za]).attr("x",ob).attr("y",pb+8+18*rb).attr("width",3).attr("height",12),fb.append("text").attr("x",ob+8).attr("y",pb+18*(rb+1)).text(sb+" ("+za+")"),rb++}for(var ca in a.methylationData){var tb=0;for(var pa in a.methylationData[ca]){tb++;var ub="";pa>=mb&&nb>=pa&&(ub="prom");var vb=(pa-hb)/jb;fb.append("line").attr("x1",-Xa).attr("x2",-Xa+Ta+80).attr("y1",ab-db(vb)).attr("y2",ab-db(vb)).attr("stroke",s).attr("stroke-opacity",.5).attr("stroke-width",1).attr("class",ub).attr("id","annotationLine"+pa),fb.append("line").attr("x1",-Xa+Ta+80).attr("x2",cb(1)).attr("y1",ab-db(vb)).attr("y2",ab-db(tb-1)+f/2).attr("stroke",s).attr("stroke-opacity",.5).attr("stroke-width",1).attr("class",ub)}break}fb.append("rect").attr("fill",m).attr("x",-Xa+7).attr("y",ab-db(kb)).attr("width",h).attr("height",db(S-(lb-kb))),"1"===W?(fb.append("line").attr("x1",-Xa+4).attr("x2",-Xa+9).attr("y1",db(S-(lb-kb))+ab-db(kb)-7).attr("y2",db(S-(lb-kb))+ab-db(kb)).style("stroke",m).attr("stroke-width",h-1).attr("stroke-linecap","round"),fb.append("line").attr("x1",-Xa+9).attr("x2",-Xa+14).attr("y1",db(S-(lb-kb))+ab-db(kb)).attr("y2",db(S-(lb-kb))+ab-db(kb)-7).style("stroke",m).attr("stroke-width",h-1).attr("stroke-linecap","round")):(fb.append("line").attr("x1",-Xa+4).attr("x2",-Xa+9).attr("y1",ab-db(kb)+7).attr("y2",ab-db(kb)).style("stroke",m).attr("stroke-width",h-1).attr("stroke-linecap","round"),fb.append("line").attr("x1",-Xa+9).attr("x2",-Xa+14).attr("y1",ab-db(kb)).attr("y2",ab-db(kb)+7).style("stroke",m).attr("stroke-width",h-1).attr("stroke-linecap","round"));var wb=0;for(var xb in Y)wb++,cStart=Y[xb].start,cEnd=Y[xb].end,cStart<hb&&(cStart=hb),cEnd>ib&&(cEnd=ib),cStartPlot=(cStart-hb)/jb,cEndPlot=(cEnd-hb)/jb,fb.append("rect").attr("fill",o).attr("x",-Xa+18).attr("y",ab-db(cStartPlot)).attr("width",i).attr("height",db(S-(cEndPlot-cStartPlot)));var yb=0;for(var zb in X){yb++;var Ab=+X[zb].start,Bb=+X[zb].end,Cb=(Ab-hb)/jb,Db=(Bb-hb)/jb;fb.append("rect").attr("fill",p).attr("x",-Xa+22+6*yb).attr("y",ab-db(Cb)).attr("width",j).attr("height",db(S-(Db-Cb))).html("<title>"+zb+"</title");var Eb=a.transcripts[zb].exons;for(var Aa in Eb){var Fb=+Eb[Aa].start,Gb=+Eb[Aa].end;eStartPlot=(Fb-hb)/jb,eEndPlot=(Gb-hb)/jb,fb.append("rect").attr("fill",q).attr("x",-Xa+22+6*yb).attr("y",ab-db(eStartPlot)).attr("width",j).attr("height",db(S-(eEndPlot-eStartPlot)))}}var Hb=Math.round(Math.log(Ua)/Math.log(10)),Ib=Math.pow(10,Hb-1);if(1e3>Ib&&5e3>Ua&&(Ib=1e3),"1"===W)var Jb=U-Ib/2,Kb=U+Ib/2;else var Jb=V-Ib/2,Kb=V+Ib/2;var Lb=(Jb-hb)/jb,Mb=(Kb-hb)/jb;fb.append("rect").attr("fill",r).attr("x",-Xa+2).attr("y",ab-db(Lb)).attr("width",2).attr("id","scaleBar").attr("height",db(S-(Mb-Lb)));var Nb=Ib/1e3;if(Nb+="kb","1"==W)var Ob=db(Lb)+2;else var Ob=db(Mb)-10;fb.append("text").attr("x",-Xa+1).attr("y",ab-Ob).attr("font-size","9px").attr("fill",r).text(Nb);var Pb=[];for(var sa in ra){var ca=ra[sa],ua=la[ca];Pb.push(ab-db(0)-ua/20*f*3-10)}var Qb=0;100>d?Qb=2:200>d&&(Qb=1);var Rb=d3.svg.area().defined(function(a){return a}).x(function(a,b){return cb(b)+Qb}).y1(function(a){return a}).y0(ab-db(0)-10);fb.append("path").attr("d",Rb(Pb)).attr("fill",v),fb.append("line").attr("x1",cb(1)).attr("x2",cb(d)).attr("y1",ab-db(0)-ia/20*f*3-10).attr("y2",ab-db(0)-ia/20*f*3-10).style("stroke",x).attr("stroke-width",1).attr("shape-rendering","crispEdges").attr("stroke-dasharray","5,5"),fb.append("path").attr("d",eb(Pb)).style("stroke",w).attr("stroke-width",1).attr("fill","none"),fb.append("text").attr("x",-4).attr("y",ab-db(0)-10-ia/20*f).attr("class","clickable").attr("id","expressionData").attr("text-anchor","end").attr("font-size","12px").attr("fill","#aaa").text("expression").on("mouseup",function(){"expressionData"!==e&&updatePlot(a,b,c,d,"expressionData")});var Sb=0;for(var pa in qa){Sb++;var Tb=qa[pa],Ub=[];for(var sa in Tb){var Vb=Tb[sa];if(isNaN(Vb))Ub.push(null);else{var Wb=ab-db(Sb-1)+(1-Vb)*f;Ub.push(Wb)}}var ub="";if(pa>=mb&&nb>=pa&&(ub="prom"),Ub.some(function(a){return null!==a})){var Xb=d3.svg.area().defined(function(a){return a}).x(function(a,b){return cb(b)+Qb}).y1(function(a){return a}).y0(ab-db(Sb-1)+f);fb.append("path").attr("d",Xb(Ub)).attr("class",ub).attr("fill",y),fb.append("path").attr("d",eb(Ub)).attr("stroke",z).attr("class",ub+" line").attr("stroke-width",1).attr("fill","none")}else fb.append("text").attr("x",4).attr("y",ab-db(Sb-1)+.75*f).attr("text-anchor","start").attr("font-size","9px").attr("class",ub).attr("fill",C).text("no data")}var Yb=[];for(var sa in ra){var ca=ra[sa],tb=0;if(ka[ca]){for(var pa in ka[ca]){tb++,Yb.push(pa);var Zb=a.probeIds[pa];fb.append("rect").attr("fill","#fff").attr("fill-opacity",0).attr("x",cb(0)).attr("y",ab-db(tb-1)).attr("width",bb*d).attr("height",f).attr("id",pa+"_"+Zb+"_"+tb).attr("class","clickable").on("mouseover",function(){var a=$(this).attr("id"),b=a.replace(/_.+$/,""),c=a.replace(/^.+?_/,"");c=c.replace(/_.+$/,"");var d=(b-hb)/jb;fb.append("text").attr("x",-74).attr("y",ab-db(d)-6).attr("text-anchor","end").attr("class","probeId").attr("font-size","11px").attr("stroke","#fff").attr("stroke-width",4).text(c),fb.append("text").attr("x",-74).attr("y",ab-db(d)-6).attr("text-anchor","end").attr("class","probeId").attr("font-size","11px").attr("fill",z).text(c),fb.append("line").attr("x1",-Xa).attr("x2",-Xa+Ta+80).attr("y1",ab-db(d)).attr("y2",ab-db(d)).style("stroke",z).attr("stroke-width",2).attr("class","focusLine")}).on("mouseout",function(){$(".focusLine").remove(),$(".probeId").remove()}).on("mouseup",function(){var b=$(this).attr("id"),c=$(".probeIdClicked").attr("id");if($(".focusLineClicked").remove(),$(".probeIdClicked").remove(),$(".probeInfo").remove(),c!==b){var d=a.geneInfo.chr,e=b.replace(/_.+$/,""),g=b.replace(/^.+?_/,"");g=g.replace(/_.+$/,"");var h=b.replace(/^.+_/,""),i=(e-hb)/jb;fb.append("text").attr("x",-74).attr("y",ab-db(i)-6).attr("text-anchor","end").attr("class","probeIdClicked containsProbeId").attr("id",b).attr("font-size","11px").attr("stroke","#FFF").attr("stroke-width",4).text(g),fb.append("text").attr("x",-74).attr("y",ab-db(i)-6).attr("text-anchor","end").attr("class","probeIdClicked clickable").attr("font-size","11px").attr("fill",z).text(g).on("mouseup",function(){var b=a.probeAnnotation[e];b=b.replace(/-/g," ± ");var c=140;b.length>20&&(c=180),fb.append("rect").attr("x",-142).attr("y",ab-db(i)-24).attr("width",c).attr("height",66).attr("fill","#fff").attr("stroke",z).attr("stroke-width",2).attr("class","probeInfo clickable").on("mouseup",function(){$(".probeInfo").remove()}),fb.append("text").attr("x",-136).attr("y",ab-db(i)-6).attr("class","probeInfo").attr("font-weight","bold").text(g),fb.append("text").attr("x",-136).attr("y",ab-db(i)+14).attr("class","probeInfo").text("chr"+d+":"+e),fb.append("text").attr("x",-136).attr("y",ab-db(i)+30).attr("class","probeInfo").text(b),fb.append("text").attr("x",-142+c-20).attr("y",ab-db(i)-4).attr("class","probeInfo clickable").attr("font-size","18px").attr("font-weight","bold").attr("fill",z).text("×").on("mouseup",function(){$(".probeInfo").remove()})}),fb.append("line").attr("x1",-Xa).attr("x2",-Xa+Ta+80).attr("y1",ab-db(i)).attr("y2",ab-db(i)).style("stroke",z).attr("stroke-width",2).attr("class","focusLineClicked"),fb.append("line").attr("x1",-Xa+Ta+80).attr("x2",cb(1)).attr("y1",ab-db(i)).attr("y2",ab-db(h-1)+f/2).style("stroke",z).attr("stroke-width",2).attr("class","focusLineClicked")}})}break}}var tb=0;if("expressionData"===e)for(var pa in Yb){tb++;var $b=va[e][Yb[pa]];if($b.r){var _b=$b.r;if("failed"!==_b){var Fa=parseFloat($b.rp),ac=formatCorrelation(_b,Fa),bc="#aaa",cc="normal";.05>Fa&&(bc="#666",cc="bold"),fb.append("text").attr("x",cb(d)+4*bb).attr("y",ab-db(tb-1)+f-4).attr("font-size",k).attr("font-weight",cc).attr("font-family",l).attr("fill",bc).text(ac)}}}else for(var pa in Yb){tb++;var $b=va[e][Yb[pa]];if($b.p||0===$b.p){var Fa=$b.p;if("failed"!==Fa){var dc="#aaa",ec="normal",fc=parseFloat(Fa);.05>fc&&(dc="#666",ec="bold"),Fa=fc<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+Fa,fb.append("text").attr("x",cb(d)+4*bb).attr("y",ab-db(tb-1)+f-4).attr("font-size",k).attr("font-weight",ec).attr("font-family",l).attr("fill",dc).text(Fa)}}else if($b.r){var _b=$b.r;if("failed"!==_b){var Fa=parseFloat($b.rp),ac=formatCorrelation(_b,Fa),bc="#aaa",cc="normal";.05>Fa&&(bc="#666",cc="bold"),fb.append("text").attr("x",cb(d)+4*bb).attr("y",ab-db(tb-1)+f-4).attr("font-size",k).attr("font-weight",cc).attr("font-family",l).attr("fill",bc).text(ac)}}}if("no_annotation"!==a.annotation){var gc=0;for(var sa in ra){var ca=ra[sa],ta=ca.replace(/_\d\d$/,"");if(gc%2===0)var hc=D;else var hc=E;var za=ca.replace(/^.+_(\d\d)$/,"$1"),ic=(Q[za],R[za]),jc=1;if(fb.append("rect").attr("fill",ic).attr("x",cb(gc)).attr("y",ab-db(0)-10-ia/20*f*3-10-(g+1)*jc).attr("width",bb).attr("height",g),"BRCA breast invasive carcinoma"===c){jc++;var kc;kc=ca in a.pam50?a.pam50[ca]:"no data";var lc=P[kc];fb.append("rect").attr("fill",lc).attr("x",cb(gc)).attr("y",ab-db(0)-10-ia/20*f*3-10-(g+1)*jc).attr("width",bb).attr("height",g)}if("no_annotation"!==ma[ta])for(var da in ma[ta]){var ea=ma[ta][da];if("gender"===da)if(1==ea)if(gc%2===0)var mc=F;else var mc=G;else if(gc%2===0)var mc=H;else var mc=I;if("eye_color"===da)if(1==ea)if(gc%2===0)var nc=J;else var nc=K;else if(2==ea)if(gc%2===0)var nc=L;else var nc=M;else if(gc%2===0)var nc=N;else var nc=O;var oc=aa[da];if(jc++,null===ea)fb.append("rect").attr("fill",u).attr("x",cb(gc)).attr("y",ab-db(0)-10-ia/20*f*3-10-(g+1)*jc).attr("width",bb).attr("height",g);else if("gender"===da){var pc=g,pb=ab-db(0)-10-ia/20*f*3-10-(g+1)*jc+(g-pc);fb.append("rect").attr("fill",mc).attr("x",cb(gc)).attr("y",pb).attr("width",bb).attr("height",pc)}else if("eye_color"===da){var pc=g,pb=ab-db(0)-10-ia/20*f*3-10-(g+1)*jc+(g-pc);fb.append("rect").attr("fill",nc).attr("x",cb(gc)).attr("y",pb).attr("width",bb).attr("height",pc)}else{var pc=g/oc*ea,pb=ab-db(0)-10-ia/20*f*3-10-(g+1)*jc+(g-pc);fb.append("rect").attr("fill",hc).attr("x",cb(gc)).attr("y",pb).attr("width",bb).attr("height",pc)}}else fb.append("rect").attr("fill",u).attr("x",cb(gc)).attr("y",ab-db(0)-10-ia/20*f*3-10-(g+1)*(Z-fa)).attr("width",bb).attr("height",(g+1)*(Z-1-fa)-1);gc++}if("expressionData"===e){var jc=0,$b=va[e]["sample type"];if($b.p||0===$b.p){var Fa=$b.p;if("failed"!==Fa){var dc="#aaa",ec="normal",fc=parseFloat(Fa);.05>fc&&(dc="#666",ec="bold"),Fa=fc<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+Fa,fb.append("text").attr("x",cb(d)+4*bb).attr("y",ab-db(0)-10-ia/20*f*3-10-(g+1)*jc-4).attr("font-size",k).attr("font-weight",ec).attr("font-family",l).attr("fill",dc).text(Fa)}}"BRCA breast invasive carcinoma"===c&&jc++;for(var da in aa){jc++;var $b=va[e][da];if($b.p||0===$b.p){var Fa=$b.p;if("failed"!==Fa){var dc="#aaa",ec="normal",fc=parseFloat(Fa);.05>fc&&(dc="#666",ec="bold"),Fa=fc<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+Fa,fb.append("text").attr("x",cb(d)+4*bb).attr("y",ab-db(0)-10-ia/20*f*3-10-(g+1)*jc-4).attr("font-size",k).attr("font-weight",ec).attr("font-family",l).attr("fill",dc).text(Fa)}}else if($b.r){var _b=$b.r;if("failed"!==_b){var Fa=parseFloat($b.rp),ac=formatCorrelation(_b,Fa),bc="#aaa",cc="normal";.05>Fa&&(bc="#666",cc="bold"),fb.append("text").attr("x",cb(d)+4*bb).attr("y",ab-db(0)-10-ia/20*f*3-10-(g+1)*jc-4).attr("font-size",k).attr("font-weight",cc).attr("font-family",l).attr("fill",bc).text(ac)}}}var qc=Z-fa;for(field in ga){var rc=ga[field],$b=va.expressionData[rc];if($b.r){var _b=$b.r;if("failed"!==_b){var Fa=parseFloat($b.rp),ac=formatCorrelation(_b,Fa),bc="#aaa",cc="normal";
.05>Fa&&(bc="#666",cc="bold"),fb.append("text").attr("x",cb(gc)+4*bb).attr("y",ab-db(0)-10-ia/20*f*3-10-(g+1)*qc-4).attr("class",rc).attr("font-size",k).attr("font-weight",cc).attr("font-family",l).attr("fill",bc).text(ac)}}qc++}}else if("sample type"===e){var $b=va[e].expressionData;if($b.n){var Ea=$b.n;fb.append("text").attr("x",cb(d)+4*bb).attr("y",ab-db(0)-10-ia/20*f).attr("font-size",k).attr("font-family",l).attr("fill","#aaa").text(Ea)}else if($b.p||0===$b.p){var Fa=$b.p;if("failed"!==Fa){var dc="#aaa",ec="normal",fc=parseFloat(Fa);.05>fc&&(dc="#666",ec="bold"),Fa=fc<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+Fa,fb.append("text").attr("x",cb(d)+4*bb).attr("y",ab-db(0)-10-ia/20*f).attr("font-size",k).attr("font-weight",ec).attr("font-family",l).attr("fill",dc).text(Fa)}}var tb=0;for(var pa in Yb){tb++;var $b=va[e][Yb[pa]];if($b.p||0===$b.p){var Fa=$b.p;if("failed"!==Fa){var dc="#aaa",ec="normal",fc=parseFloat(Fa);.05>fc&&(dc="#666",ec="bold"),Fa=fc<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+Fa,fb.append("text").attr("x",cb(d)+4*bb).attr("y",ab-db(tb-1)+f-4).attr("font-size",k).attr("font-weight",ec).attr("font-family",l).attr("fill",dc).text(Fa)}}}}else{var $b=va[e].expressionData;if($b.p||0===$b.p){var Fa=$b.p;if("failed"!==Fa){var dc="#aaa",ec="normal",fc=parseFloat(Fa);.05>fc&&(dc="#666",ec="bold"),Fa=fc<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+Fa,fb.append("text").attr("x",cb(d)+4*bb).attr("y",ab-db(0)-10-ia/20*f).attr("font-size",k).attr("font-weight",ec).attr("font-family",l).attr("fill",dc).text(Fa)}}else if($b.r){var _b=$b.r;if("failed"!==_b){var Fa=parseFloat($b.rp),ac=formatCorrelation(_b,Fa),bc="#aaa",cc="normal";.05>Fa&&(bc="#666",cc="bold"),fb.append("text").attr("x",cb(d)+4*bb).attr("y",ab-db(0)-10-ia/20*f).attr("font-size",k).attr("font-weight",cc).attr("font-family",l).attr("fill",bc).text(ac)}}}var jc=0;fb.append("text").attr("x",-4).attr("y",ab-db(0)-10-ia/20*f*3-10-(f+1)*jc-4).attr("class","clickable").attr("font-size","12px").attr("fill","#aaa").attr("id","sample type").attr("text-anchor","end").text("sample type").on("mouseup",function(){var f=$(this).text();f=f.replace(/\u2192 /,""),f!==e&&updatePlot(a,b,c,d,f)}),"BRCA breast invasive carcinoma"===c&&(jc++,fb.append("text").attr("x",-4).attr("y",ab-db(0)-10-ia/20*f*3-10-(f+1)*jc).attr("class","clickable").attr("font-size","12px").attr("fill","#aaa").attr("id","PAM50 subtype").attr("text-anchor","end").text("PAM50 subtype").on("mouseup",function(){var f=$(this).text();f=f.replace(/\u2192 /,""),f!==e&&updatePlot(a,b,c,d,f)}));for(var da in aa){jc++,da=da.replace(/_/g," "),fb.append("text").attr("x",-4).attr("y",ab-db(0)-10-ia/20*f*3-10-(g+1)*jc-4).attr("class","clickable").attr("font-size","12px").attr("fill","#aaa").attr("id",da.replace(/ /g,"_")).attr("text-anchor","end").text(da).on("mouseup",function(){var f=$(this).text();f=f.replace(/ /g,"_"),f=f.replace(/\u2192_/,""),f!==e&&updatePlot(a,b,c,d,f)});var wa=da.replace(/ /g,"_");if(wa!==e&&"expressionData"!==e){var $b=va[e][wa];if($b.p||0===$b.p){var Fa=$b.p;if("failed"!==Fa){var dc="#aaa",ec="normal",fc=parseFloat(Fa);.05>fc&&(dc="#666",ec="bold"),Fa=fc<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+Fa,fb.append("text").attr("x",cb(d)+4*bb).attr("y",ab-db(0)-10-ia/20*f*3-10-(g+1)*jc-4).attr("font-size",k).attr("font-weight",ec).attr("font-family",l).attr("fill",dc).text(Fa)}}else if($b.r){var _b=$b.r;if("failed"!==_b){var Fa=parseFloat($b.rp),ac=formatCorrelation(_b,Fa),bc="#aaa",cc="normal";.05>Fa&&(bc="#666",cc="bold"),fb.append("text").attr("x",cb(d)+4*bb).attr("y",ab-db(0)-10-ia/20*f*3-10-(g+1)*jc-4).attr("font-size",k).attr("font-weight",cc).attr("font-family",l).attr("fill",bc).text(ac)}}}}}if("no_data"!==a.slide){var gc=0,ga=(a.slide.numberOfSlideFields,[]);for(var sa in ra){var ca=ra[sa];if("no_data"!==na[ca]){for(var sc in na[ca])-1===$.inArray(sc,ga)&&ga.push(sc);break}}for(var sa in ra){var ca=ra[sa];if("no_data"!==na[ca]){if(gc%2===0)var tc=D;else var tc=E;var qc=Z-fa;for(var sc in na[ca])if(qc++,slideFieldValue=na[ca][sc],"undefined"!=typeof na[ca][sc]){var pc=g/100*slideFieldValue,pb=ab-db(0)-10-ia/20*f*3-10-(g+1)*qc+(g-pc);fb.append("rect").attr("fill",tc).attr("x",cb(gc)).attr("y",pb).attr("width",bb).attr("height",pc).attr("class",sc)}}else{var qc=Z-fa;for(field in ga)qc++,fb.append("rect").attr("fill",u).attr("x",cb(gc)).attr("y",ab-db(0)-10-ia/20*f*3-10-(g+1)*qc-1).attr("width",bb).attr("height",g+1).attr("class",ga[field])}gc++}var qc=Z-fa;for(field in ga){var rc=ga[field],da=rc.replace(/_/g," ");fb.append("text").attr("x",-4).attr("y",ab-db(0)-10-ia/20*f*3-10-(g+1)*qc-4).attr("class",rc+" clickable").attr("font-size","12px").attr("fill","#aaa").attr("id",rc).attr("text-anchor","end").text(da).on("mouseup",function(){var f=$(this).text();f=f.replace(/ /g,"_"),f=f.replace(/\u2192_/,""),f!==e&&updatePlot(a,b,c,d,f)})}var qc=Z-fa;for(field in ga){var rc=ga[field];if(rc!==e&&"expressionData"!==e){var $b=va[e][rc];if($b.r){var _b=$b.r;if("failed"!==_b){var Fa=parseFloat($b.rp),ac=formatCorrelation(_b,Fa),bc="#aaa",cc="normal";.05>Fa&&(bc="#666",cc="bold"),fb.append("text").attr("x",cb(gc)+4*bb).attr("y",ab-db(0)-10-ia/20*f*3-10-(g+1)*qc-4).attr("class",rc).attr("font-size",k).attr("font-weight",cc).attr("font-family",l).attr("fill",bc).text(ac)}}else if($b.p||0===$b.p){var Fa=$b.p;if("failed"!==Fa){var dc="#aaa",ec="normal",fc=parseFloat(Fa);.05>fc&&(dc="#666",ec="bold"),Fa=fc<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+Fa,fb.append("text").attr("x",cb(d)+4*bb).attr("y",ab-db(0)-10-ia/20*f*3-10-(g+1)*qc-4).attr("class",rc).attr("font-size",k).attr("font-weight",ec).attr("font-family",l).attr("fill",dc).text(Fa)}}}qc++}}document.getElementById(e).setAttribute("font-weight","bold"),document.getElementById(e).setAttribute("font-size","13px"),document.getElementById(e).setAttribute("fill","rgb(100,100,100)");var uc=e.replace(/_/g," ");uc=uc.replace(/Data/,"");var vc=document.getElementById(e).firstChild;vc.nodeValue="► "+uc,fb.append("text").attr("x",$a+Ya-12).attr("y",ab-db(0)-10-ia/20*f*3-10-(g+1)*Z-14).attr("font-size",k).attr("font-family",l).attr("text-anchor","end").attr("fill","#aaa").text("comparison to: "+uc),fb.append("line").attr("x1",$a+Ya-12).attr("x2",$a+Ya-12-6.6*uc.length).attr("y1",ab-db(0)-10-ia/20*f*3-10-(g+1)*Z-10).attr("y2",ab-db(0)-10-ia/20*f*3-10-(g+1)*Z-10).style("stroke","#aaa").attr("stroke-width",1).attr("shape-rendering","crispEdges");var wc=a.geneInfo.ensembl,xc=a.geneInfo.hgnc,yc=a.geneInfo.chr,zc=a.geneInfo.start;zc=zc.toString();for(var Ac="";zc.length>=3;)Ac=zc.substring(zc.length-3)+","+Ac,zc=zc.substring(0,zc.length-3);Ac=zc+","+Ac,Ac=Ac.replace(/,$/,""),Ac=Ac.replace(/^,/,"");var Bc=a.geneInfo.end;Bc=Bc.toString();for(var Cc="";Bc.length>=3;)Cc=Bc.substring(Bc.length-3)+","+Cc,Bc=Bc.substring(0,Bc.length-3);Cc=Bc+","+Cc,Cc=Cc.replace(/,$/,""),Cc=Cc.replace(/^,/,"");var Dc="chr"+yc+":"+Ac+"-"+Cc;""===xc?$(".plotInfo").html("<p><strong>"+wc+"</strong> <a href='http://genome.ucsc.edu/cgi-bin/hgTracks?db=hg19&position="+Dc+"' target='_blank' title='This link will take you to the UCSC Genome Browser'>"+Dc+"</a></p>"):$(".plotInfo").html("<p><strong><a href='http://www.genecards.org/cgi-bin/carddisp.pl?gene="+xc+"' target='_blank' title='This link will take you to the GeneCards.org page for "+xc+".'>"+xc+"</a></strong> <span class='ensembl'>"+wc+"</span> <a href='http://genome.ucsc.edu/cgi-bin/hgTracks?db=hg19&position="+Dc+"' target='_blank' title='This link will take you to the UCSC Genome Browser'>"+Dc+"</a></p>"),$(".plotInfo").append("<div class='promoterSelectionButton noselect'>highlight promoter probes</div>"),$(".promoterSelectionButton").click(function(){$(".prom").each(function(){var a=$(this);if(a.is("path"))if(a.attr("class").match(/line/)){var b=a.attr("stroke");b===z?a.attr("stroke",B):a.attr("stroke",z)}else{var b=a.attr("fill");b===y?a.attr("fill",A):a.attr("fill",y)}else if(a.is("text")){var b=a.attr("fill");b===C?a.attr("fill",B):a.attr("fill",C)}else if(a.is("line")){var b=a.attr("stroke");b===s?a.attr("stroke",t):a.attr("stroke",s)}})}),prepareSvgForDownload(b,c,e)}function checkUserInput(){$("#userInputForm .inputButton").toggleClass("inactive"),removeMessages();var a=$("#gene").val();a=a.replace(/[<>\\\/;'"()=\[\]\{\}]/g,"");var b=$(".sampleSelectionList").find(".selectedSample").text();""===a?($("#userInputForm .inputButton").toggleClass("inactive"),$("#userInputForm .inputButton").click(!0),$("#gene").focus(),$('<div class="warningMessage">Don\'t forget to enter a gene name!</div>').hide().appendTo("#userInputForm").fadeIn(200)):""===b?($("#userInputForm .inputButton").toggleClass("inactive"),$("#userInputForm .inputButton").click(!0),$('<div class="warningMessage">Don\'t forget to select a source!</div>').hide().appendTo("#userInputForm").fadeIn(200)):""!==a&&""!==b&&plotPreparation()}function plotPreparation(){removeMessages();var a=$("#gene").val();a=a.replace(/[<>\\\/;'"()=\[\]\{\}]/g,"");var b=$(".sampleSelectionList").find(".selectedSample").find(".sourceName").text(),c=$(".sampleSelectionList").find(".selectedSample").find(".fullSourceName").attr("title"),d=b+" "+c;$(".downloadButton").remove(),$(".loadingAnimation").show(),$(".plotContainer").css("background","#FFF"),$(".plotContainer").css("border","none"),$(".plotWindow").toggleClass("transparent"),$(".plotInfo").toggleClass("transparent"),$("svg").length&&($(".plotInfo").empty(),$(".plotWindow").empty());$.ajax({type:"POST",url:"php/numberOfSamples.php?source="+d,dataType:"json",success:function(b){var c=b.nrow;$('<div class="infoMessage">'+c+" samples selected</div>").hide().appendTo("#userInputForm").fadeIn(500),createNewPlot(a,d,c)},error:function(){$('<div class="errorMessage">Database error.<br>(could not retrieve the number of samples)</div>').hide().appendTo("#userInputForm").fadeIn(500),$(".plotWindow").toggleClass("hidden"),$("#userInputForm .inputButton").toggleClass("inactive"),$(".loadingAnimation").hide(),$(".plotContainer").css("background","#f6f6f6"),$(".plotContainer").css("border","4px solid #efefef")}})}function removeMessages(){$(".errorMessage").length>0&&$(".errorMessage").remove(),$(".warningMessage").length>0&&$(".warningMessage").remove(),$(".infoMessage").length>0&&$(".infoMessage").remove()}function numberOfLevels(b){var c=[];for(a in b){var d=b[a];-1===$.inArray(d,c)&&null!==d&&void 0!==d&&c.push(d)}var e=c.length;return e}$(function(){$(window).scroll(function(){$("header").css({left:$(this).scrollLeft()})}),$("input[type=text]").focus(),windowWidth=$(window).width(),inputWidth=$(".userInput").outerWidth(),plotWidth=windowWidth-inputWidth-28,$(".plotContainer").width(plotWidth);var a,b;$(function(){a={serviceUrl:"php/autocomplete.php",minChars:1,maxHeight:200,deferResquestBy:0},b=$("#gene").autocomplete(a)}),$(".sampleSelectionElement").click(function(){var a=$(this);$(".sampleSelectionElement").each(function(){$(this).hasClass("selectedSample")&&$(this).toggleClass("selectedSample")}),a.toggleClass("selectedSample")})});