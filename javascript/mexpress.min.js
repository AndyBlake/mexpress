function isNumeric(a){return!isNaN(parseFloat(a))&&isFinite(a)}function pAdjust(a,b){var c;if("bh"===b){var d=a.length,e=[];for(c=d;c>0;c--)e.push(c);var f=[];for(c=0;d>c;c++)f[c]=[a[c],c];var g,h=nestedArraySort(f,!0,0);for(c=0;d>c;c++){var i=h[c][0]*d/e[c];0!==c?g>i?g=i:i=g:g=i,i>1&&(i=1),h[c][0]=i}for(h=nestedArraySort(h,!1,1),result=[],c=0;c<h.length;c++)result.push(h[c][0]);return result}}function pearsonCorrelation(a,b){var c;if(a.length!==b.length)return"failed";var d=[],e=[];for(c in b)isNaN(b[c])||isNaN(a[c])||(e.push(+b[c]),d.push(+a[c]));if(e.length>10){var f=e.length,g=0,h=0,i=0,j=0,k=0;for(c in e)g+=d[c],i+=Math.pow(d[c],2),h+=e[c],j+=Math.pow(e[c],2),k+=d[c]*e[c];var l=k-g*h/f,m=Math.sqrt(i-Math.pow(g,2)/f)*Math.sqrt(j-Math.pow(h,2)/f),n=l/m,o=e.length-2,p=Math.abs(n/Math.sqrt((1-Math.pow(n,2))/o)),q=tDistribution(o,p);return{r:n,p:q}}return"failed"}function mean(a){for(var b=a.length,c=0,d=0;b>d;d++)c+=a[d];var e=c/b;return e}function variance(a){for(var b=a.length,c=mean(a),d=0,e=0;b>e;e++)d+=Math.pow(a[e]-c,2);var f=d/b;return f}function degreesOfFreedom(a,b){var c=a.length,d=b.length,e=variance(a),f=variance(b),g=Math.pow(e/c+f/d,2),h=Math.pow(e/c,2)/(c-1)+Math.pow(f/d,2)/(d-1),i=g/h;return i}function tDistribution(a,b){var c=.049867347,d=.0211410061,e=.0032776263,f=380036e-10,g=488906e-10,h=5383e-9,i=b*(1-1/(4*a))/Math.sqrt(1+Math.pow(b,2)/(2*a)),j=2*(1/(2*Math.pow(1+c*i+d*Math.pow(i,2)+e*Math.pow(i,3)+f*Math.pow(i,4)+g*Math.pow(i,5)+h*Math.pow(i,6),16)));return j}function tTest(a,b){var c;for(c in a)isNaN(a[c])&&(a[c]=null);for(c in b)isNaN(b[c])&&(b[c]=null);if(a.some(function(a){return null!==a})){if(b.some(function(a){return null!==a})){var d=a.length,e=b.length;if(d>=3&&e>=3){var f=mean(a),g=mean(b),h=variance(a),i=variance(b),j=(f-g)/Math.sqrt(h/d+i/e);j=Math.abs(j);var k=degreesOfFreedom(a,b),l=tDistribution(k,j);return l}return"failed"}return"failed"}return"failed"}function nestedArraySort(a,b,c){return b?a.sort(function(a,b){return a=a[c],b=b[c],a===b?0:a>b?-1:1}):a.sort(function(a,b){return a=a[c],b=b[c],a===b?0:b>a?-1:1}),a}function wilcoxonRankSumTest(a,b){var c,d=[],e=[];for(c in a)a[c]&&"null"!==a[c]&&isNumeric(c)&&d.push(+a[c]);for(c in b)b[c]&&"null"!==b[c]&&isNumeric(c)&&e.push(+b[c]);var f=d.length,g=e.length;if(3>f||3>g)return"failed";var h=f*g/2,i=Math.sqrt(f*g*(f+g+1)/12),j=[];for(c in d)j.push([d[c],1]);for(c in e)j.push([e[c],2]);var k=nestedArraySort(j,!1,0),l=[],m=[];for(c in k)l.push(k[c][0]),m.push(k[c][1]);var n=[];for(c in k){var o=k[c][0],p=l.indexOf(o)+1;n.push(p)}var q=0,r=0;for(c in m){var s=m[c];1===s?q+=n[c]:r+=n[c]}var t=f*g+f*(f+1)/2-q,u=(t-h)/i;u=Math.abs(u);var v=u/Math.sqrt(2),w=1/(1+.5*v),x=w*Math.exp(-Math.pow(v,2)-1.26551223+1.00002368*w+.37409196*Math.pow(w,2)+.09678418*Math.pow(w,3)-.18628806*Math.pow(w,4)+.27886807*Math.pow(w,5)-1.13520398*Math.pow(w,6)+1.48851587*Math.pow(w,7)-.82215223*Math.pow(w,8)+.17087277*Math.pow(w,9)),y=1-x,z=2*(1-.5*(1+y));return z}function prepareSvgForDownload(a,b,c){$(".downloadButton").remove(),$(".downloadText").remove(),$(".plotInfo p").append('<div class="download"></div>'),$(".download").append('<div class="downloadButton png">png</div>'),$(".download").append('<div class="downloadButton svg">svg</div>'),$(".download").append('<div class="downloadText">download a png or svg version of the figure</div>'),$(".downloadButton").css("visibility","visible").hide().fadeIn(1e3),$(".downloadButton").mouseenter(function(){$(".downloadText").css("visibility","visible").hide().fadeIn(100)}).mouseleave(function(){$(".downloadText").css("visibility","hidden")}),$(".downloadButton.png").click(function(){var d=d3.select("svg").attr("version",1.1).attr("xlmns","http://www.w3.org/2000/svg").node().parentNode.innerHTML;$(this).html('<img src="images/arrowLoader.gif">'),downloadSvg(a,b,c,d,"png")}),$(".downloadButton.svg").click(function(){var d=d3.select("svg").attr("version",1.1).attr("xlmns","http://www.w3.org/2000/svg").node().parentNode.innerHTML;$(this).html('<img src="images/arrowLoader.gif">'),downloadSvg(a,b,c,d,"svg")})}function createDownloadLink(a,b){var c=a.replace(/^.+\//,""),d=document.createElement("a");d["class"]="downloadLink",d.download=c,d.target="_blank",d.href=a,document.body.appendChild(d),d.click(),"png"===b?$(".downloadButton.png").html("png"):"svg"===b&&$(".downloadButton.svg").html("svg")}function downloadSvg(a,b,c,d,e){var f=encodeURIComponent(d),g=$(".containsProbeId").attr("id"),h="";void 0!==g&&(h=g.replace(/^.+?_/,""),h=h.replace(/_.+$/,"")),$.ajax({data:"fileType="+e+"&gene="+a+"&source="+b+"&sorter="+c+"&probe="+h+"&svgHtml="+f,url:"php/svg2png.php",method:"POST",success:function(a){var b=a;b="php/"+b,createDownloadLink(b,e)}})}function removeMessages(){$(".errorMessage").length>0&&$(".errorMessage").remove(),$(".warningMessage").length>0&&$(".warningMessage").remove(),$(".infoMessage").length>0&&$(".infoMessage").remove()}function formatCorrelation(a,b){var c=a.toPrecision(3);return a>0&&(c="+"+c),c="r = "+c,.001>b?c+=" ***":.01>b?c+=" **":.05>b&&(c+=" *"),c}function numberOfLevels(a){var b=[];for(var c in a){var d=a[c];-1===$.inArray(d,b)&&null!==d&&void 0!==d&&b.push(d)}var e=b.length;return e}function sortData(a,b){var c,d,e,f,g,h,i=[],j=[],k=[];for(c in a.expressionData)j.push(c);var l=j;if("expressionData"===b){var m=[];for(c in a.expressionData){var n=a.expressionData[c];m.push({key:c,val:n})}m.sort(function(a,b){return b.val-a.val});for(d in m)i.push(m[d].key)}else if("sample type"===b){k=[];for(c in a.expressionData){var o=c.replace(/^.+_(\d\d)$/,"$1");k.push({key:c,val:o})}k.sort(function(a,b){return b.val-a.val});for(d in k)i.push(k[d].key)}else if("PAM50 subtype"===b){k=[];var p=[];for(e in j)c=j[e],c in a.pam50?k.push({key:c,val:a.pam50[c]}):p.push(c);k.sort(function(a,b){var c=a.val.toLowerCase(),d=b.val.toLowerCase();return d>c?-1:c>d?1:0});for(d in k)i.push(k[d].key);i=i.concat(p)}else{var q,r;for(f in a.annotation){q=a.annotation[f];break}for(e in a.slide){r=a.slide[e];break}var s,t,u;if(b in q){s="annotation",t=[],u=[];for(e in a[s])"numberOfAnnotationFields"!==e&&(g=a[s][e][b],void 0!==g&&null!==g?(g=+g,t.push({key:e,val:g})):u.push({key:e,val:g}));t.sort(function(a,b){return b.val-a.val}),t=t.concat(u);for(d in t){var v=t[d].key,w=RegExp(v);for(h=j.length-1;h>=0;h--){var x=j[h],y=x.match(w);if(null!==y){i.push(x);var z=$.inArray(x,l);l.splice(z,1)}}}i=i.concat(l)}else if(b in r){s="slide",t=[],u=[];for(e in a[s])"numberOfSlideFields"!==e&&(g=a[s][e][b],void 0!==g&&null!==g?(g=+g,t.push({key:e,val:g})):u.push({key:e,val:g}));t.sort(function(a,b){return b.val-a.val}),t=t.concat(u);for(d in t)for(c=t[d].key,h=j.length-1;h>=0;h--)j[h]===c&&(i.push(c),j.splice(h,1));i=i.concat(j)}}return i}function calculateStats(a,b,c,d,e,f,g,h,i,j){var k={};k.expressionData={},k["sample type"]={},k["PAM50 subtype"]={};var l,m;for(l in a.annotation){for(m in a.annotation[l])k[m]={};break}for(l in a.slide){for(m in a.slide[l])k[m]={};break}var n,o,p,q;for(n in k){var r={},s=[];if("expressionData"===n)r=a[n];else if(-1!==$.inArray(n,d))for(o in a.annotation)r[o]=a.annotation[o][n];else if(-1!==$.inArray(n,b))for(l in a.slide)r[l]=a.slide[l][n];else if("sample type"===n)for(p in c)l=c[p],q=l.replace(/^.+_(\d\d)$/,"$1"),"10"===q||"11"===q||"12"===q||"13"===q||"14"===q?r[l]="1":r[l]="0";else if("PAM50 subtype"===n)for(p in c)l=c[p],l in a.pam50?r[l]=a.pam50[l]:r[l]="no data";for(var t in r)s.push(r[t]);var u,v,w,x,y,z=numberOfLevels(s);if("expressionData"!==n)if(2===z){u=[],v=[];for(l in f)o=l.replace(/_\d\d$/,""),"no_annotation"!==e[o]&&(w="sample type"!==n?e[o][n]:r[l],"1"===w?u.push(f[l]):"0"===w&&v.push(f[l]));x=wilcoxonRankSumTest(u,v),k[n].expressionData={p:x}}else if(z>2&&"PAM50 subtype"!==n&&"eye_color"!==n&&"batch number"!==n){u=[],v=[];for(p in c)l=c[p],u.push(f[l]),-1!==$.inArray(n,d)?(o=l.replace(/_\d\d$/,""),v.push(r[o])):v.push(r[l]);x=pearsonCorrelation(u,v),k[n].expressionData={r:x.r,rp:x.p}}else k[n].expressionData={n:"no normals"};for(y in i)if(2===z){u=[],v=[];for(p in c)l=c[p],o=l.replace(/_\d\d$/,""),"no_annotation"!==e[o]&&(w="sample type"!==n?e[o][n]:r[l],"1"===w?u.push(g[l][i[y]]):"0"===w&&v.push(g[l][i[y]]));x=wilcoxonRankSumTest(u,v),k[n][i[y]]={p:x}}else if(z>2&&"PAM50 subtype"!==n&&"eye_color"!==n&&"batch number"!==n){u=[],v=[];for(p in c)l=c[p],u.push(g[l][i[y]]),-1!==$.inArray(n,d)?(o=l.replace(/_\d\d$/,""),v.push(r[o])):v.push(r[l]);x=pearsonCorrelation(u,v),k[n][i[y]]={r:x.r,rp:x.p}}else k[n][i[y]]={n:"failed"};if("no_data"!==h)if(2===z){u=[],v=[];for(p in c)l=c[p],o=l.replace(/_\d\d$/,""),"no_annotation"!==e[o]&&(w="sample type"!==n?e[o][n]:r[l],"1"===w?u.push(h[l]):"0"===w&&v.push(h[l]));x=wilcoxonRankSumTest(u,v),k[n]["copy number"]={p:x}}else if(z>2&&"PAM50 subtype"!==n&&"eye_color"!==n&&"batch number"!==n){u=[],v=[];for(p in c)l=c[p],u.push(h[l]),-1!==$.inArray(n,d)?(o=l.replace(/_\d\d$/,""),v.push(r[o])):v.push(r[l]);x=pearsonCorrelation(u,v),k[n]["copy number"]={r:x.r,rp:x.p}}else k[n]["copy number"]={n:"failed"};var A,B;for(B in d)if(A=d[B],A!==n){var C=[];for(y in e)C.push(e[y][A]);var D=numberOfLevels(C);if(2===z)if(2===D)k[n][A]={n:"failed"};else if(D>2){u=[],v=[];for(p in c)l=c[p],o=l.replace(/_\d\d$/,""),"no_annotation"!==e[o]&&(w="sample type"!==n?e[o][n]:r[l],"1"===w?u.push(e[o][A]):"0"===w&&v.push(e[o][A]));x=wilcoxonRankSumTest(u,v),k[n][A]={p:x}}else k[n][A]={n:"failed"};else if(z>2&&"PAM50 subtype"!==n&&"eye_color"!==n&&"batch number"!==n)if(2===D){u=[],v=[];for(p in c)l=c[p],o=l.replace(/_\d\d$/,""),"no_annotation"!==e[o]&&(w=e[o][A],"1"===w?-1!==$.inArray(n,d)?r[o]&&u.push(r[o]):r[l]&&u.push(r[l]):"0"===w&&(-1!==$.inArray(n,d)?r[o]&&v.push(r[o]):r[l]&&v.push(r[l])));x=wilcoxonRankSumTest(u,v),k[n][A]={p:x}}else if(D>2){u=[],v=[];for(p in c)l=c[p],o=l.replace(/_\d\d$/,""),-1!==$.inArray(n,d)?r[o]&&(u.push(r[o]),v.push(e[o][A])):r[l]&&(u.push(r[l]),v.push(e[o][A]));x=pearsonCorrelation(u,v),k[n][A]={r:x.r,rp:x.p}}else k[n][A]={n:"failed"};else k[n][A]={n:"failed"}}for(p in b)if(A=b[p],A!==n)if(2===z){u=[],v=[];for(p in c)l=c[p],o=l.replace(/_\d\d$/,""),w="sample type"!==n?e[o][n]:r[l],"1"===w?u.push(j[l][A]):"0"===w&&v.push(j[l][A]);x=wilcoxonRankSumTest(u,v),k[n][A]={p:x}}else if(z>2&&"PAM50 subtype"!==n&&"eye_color"!==n&&"batch number"!==n){u=[],v=[];for(p in c)l=c[p],o=l.replace(/_\d\d$/,""),-1!==$.inArray(n,d)?r[o]&&(u.push(r[o]),v.push(j[l][A])):(u.push(r[l]),v.push(j[l][A]));x=pearsonCorrelation(u,v),k[n][A]={r:x.r,rp:x.p}}else k[n][A]={n:"failed"};if("sample type"!==n){var E={},F=[];for(p in c)l=c[p],q=l.replace(/^.+_(\d\d)$/,"$1"),"10"===q||"11"===q||"12"===q||"13"===q||"14"===q?(E[l]="1",F.push("1")):(E[l]="0",F.push("0"));var G=numberOfLevels(F);if(2===G){if(2===z)k[n]["sample type"]={n:"failed"};else if(z>2&&"PAM50 subtype"!==n&&"eye_color"!==n&&"batch number"!==n){u=[],v=[];for(p in c){l=c[p],o=l.replace(/_\d\d$/,"");var H=E[l];"1"===H?-1!==$.inArray(n,d)?r[o]&&u.push(r[o]):r[l]&&u.push(r[l]):"0"===H&&(-1!==$.inArray(n,d)?r[o]&&v.push(r[o]):r[l]&&v.push(r[l]))}x=wilcoxonRankSumTest(u,v),k[n]["sample type"]={p:x}}}else k[n]["sample type"]={n:"no normal samples"}}}return k}function drawLegend(a,b,c,d,e,f,g,h,j,k,l,m,n,o,p,q,r,s,t,u,v,w){var x,y;if(x=-c+1,y=-d+24,b.append("text").attr("x",x).attr("y",y).attr("font-weight","bold").text("annotation"),b.append("rect").attr("fill",e).attr("x",x).attr("y",y+8).attr("width",3).attr("height",12),b.append("text").attr("x",x+8).attr("y",y+18).text("gene"),b.append("rect").attr("fill",f).attr("x",x).attr("y",y+8+18).attr("width",3).attr("height",12),b.append("text").attr("x",x+8).attr("y",y+36).text("transcript"),b.append("rect").attr("fill",g).attr("x",x).attr("y",y+8+36).attr("width",3).attr("height",12),b.append("text").attr("x",x+8).attr("y",y+54).text("CpG island"),x+=90,b.append("text").attr("x",x).attr("y",y).attr("font-weight","bold").text("data"),b.append("rect").attr("fill",h).attr("x",x).attr("y",y+8).attr("width",3).attr("height",12),b.append("text").attr("x",x+8).attr("y",y+18).text("RNA-seq v2 (log2)"),b.append("rect").attr("fill",j).attr("x",x).attr("y",y+8+18).attr("width",3).attr("height",12),b.append("text").attr("x",x+8).attr("y",y+36).text(a.platform),b.append("rect").attr("fill",m).attr("x",x).attr("y",y+8+36).attr("width",3).attr("height",12),b.append("text").attr("x",x+8).attr("y",y+54).text("slide/clinical data"),b.append("rect").attr("fill",n).attr("x",x).attr("y",y+8+54).attr("width",3).attr("height",12),b.append("text").attr("x",x+8).attr("y",y+72).text("missing data"),k&&(b.append("rect").attr("fill",l).attr("x",x).attr("y",y+8+72).attr("width",3).attr("height",12),b.append("text").attr("x",x+8).attr("y",y+90).text("copy number")),x+=120,o&&(b.append("text").attr("x",x).attr("y",y).attr("font-weight","bold").text("gender"),b.append("rect").attr("fill",p).attr("x",x).attr("y",y+8).attr("width",3).attr("height",12),b.append("text").attr("x",x+8).attr("y",y+18).text("female"),b.append("rect").attr("fill",q).attr("x",x).attr("y",y+8+18).attr("width",3).attr("height",12),b.append("text").attr("x",x+8).attr("y",y+36).text("male"),x+=70),b.append("text").attr("x",x).attr("y",y).attr("font-weight","bold").text("statistics"),b.append("text").attr("x",x).attr("y",y+18).attr("font-size","14px").attr("font-family",r).text("p"),b.append("text").attr("x",x+16).attr("y",y+18).text("Wilcoxon rank-sum test"),b.append("text").attr("x",x+16).attr("y",y+18+14).attr("font-weight","bold").attr("font-size","11px").attr("font-family",r).text("p < 0.05"),b.append("text").attr("x",x+16+72).attr("y",y+18+14).attr("fill","#aaa").attr("font-size","11px").attr("font-family",r).text("p ≥ 0.05"),b.append("text").attr("x",x).attr("y",y+54).attr("font-size","14px").attr("font-family",r).text("r"),b.append("text").attr("x",x+16).attr("y",y+54).text("Pearson correlation"),b.append("text").attr("x",x+16).attr("y",y+54+14).attr("font-weight","bold").attr("font-size","11px").attr("font-family",r).text("***"),b.append("text").attr("x",x+16+32).attr("y",y+54+14).attr("font-weight","bold").attr("font-size","11px").attr("font-family",r).text("p < 0.001"),b.append("text").attr("x",x+16).attr("y",y+54+28).attr("font-weight","bold").attr("font-size","11px").attr("font-family",r).text("**"),b.append("text").attr("x",x+16+32).attr("y",y+54+28).attr("font-weight","bold").attr("font-size","11px").attr("font-family",r).text("p < 0.01"),b.append("text").attr("x",x+16).attr("y",y+54+42).attr("font-weight","bold").attr("font-size","11px").attr("font-family",r).text("*"),b.append("text").attr("x",x+16+32).attr("y",y+54+42).attr("font-weight","bold").attr("font-size","11px").attr("font-family",r).text("p < 0.05"),b.append("text").attr("x",x+16+32).attr("y",y+54+56).attr("fill","#aaa").attr("font-size","11px").attr("font-family",r).text("p ≥ 0.05"),x+=160,"BRCA breast invasive carcinoma"===s){b.append("text").attr("x",x).attr("y",y).attr("font-weight","bold").text("BRCA subtype"),i=0;for(var z in t)"no data"!==z&&(b.append("rect").attr("fill",t[z]).attr("x",x).attr("y",y+8+18*i).attr("width",3).attr("height",12),b.append("text").attr("x",x+8).attr("y",y+18*(i+1)).text(z),i++);x+=106}b.append("text").attr("x",x).attr("y",y).attr("font-weight","bold").text("sample type");var A=0;for(var B in u){var C=u[B],D=v[C];D.length>26&&(D=D.substring(0,23),D+="..."),b.append("rect").attr("fill",w[C]).attr("x",x).attr("y",y+8+18*A).attr("width",3).attr("height",12),b.append("text").attr("x",x+8).attr("y",y+18*(A+1)).text(D),A++}}function updatePlot(a,b,c,d,e){$(".plotInfo").empty(),$(".plotWindow").empty(),createPlot(a,b,c,d,e)}function createPlot(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K=$(window).width(),L=$(".userInput").outerWidth(),M=K-L-28,N=18,O=14,P=4,Q=3,R=2,S="11px",T="Courier New",U="#f59322",V="#4bc722",W="#ffedc2",X="#ffc842",Y="#999",Z="#acd2f2",_="#1a70ba",aa="#f9f9f9",ba="#ffd57a",ca="#f59322",da="#ffd161",ea="#ffbd7a",fa="#f55e22",ga="#aad5fa",ha="#4999de",ia="#63aceb",ja="#14568f",ka="#b6d3f2",la="#dce1e6",ma="#c5ccd4",na="#fa89ca",oa="#f272bb",pa="#98d3fa",qa="#7fc3f0",ra="#98d3fa",sa="#4999de",ta="#944e07",ua="#693705",va="#73cc5b",wa="#37ac19",xa={Normal:"#4999de",Basal:"#ffc03b",Her2:"#ff983b",LumA:"#73cc5b",LumB:"#37ac19","no data":aa},ya={"01":"primary solid tumor","02":"recurrent solid tumor","03":"primary blood derived cancer - peripheral blood","04":"recurrent blood derived cancer - bone marrow","05":"additional - new primary","06":"metastatic","07":"additional metastatic","08":"human tumor original cells","09":"primary blood derived cancer - bone marrow",10:"blood derived normal",11:"solid tissue normal",12:"buccal cell normal",13:"EBV immortalized normal",14:"bone marrow normal",20:"control analyte",40:"recurrent blood derived cancer - peripheral blood",50:"cell lines",60:"primary xenograft tissue",61:"cell line derived xenograft tissue"},za={"01":"#98d3fa","02":"#f7a972","03":"#f2766f","04":"#db7346","05":"#3fd19b","06":"#ffd161","07":"#d13f75","08":"#6ff0f2","09":"#f29b6f",10:"#9dc9f5",11:"#4999de",12:"#4198f0",13:"#0f73d6",14:"#90d8f5",20:"#46bff0",40:"#db4e46",50:"#f07746",60:"#a17fad",61:"#8a38a8"},Aa=a.numberOfProbes,Ba=a.geneInfo,Ca=+Ba.start,Da=+Ba.end,Ea=Ba.strand,Fa=a.transcripts,Ga=a.cpgi,Ha=0,Ia=!1,Ja={},Ka=[];n=+a.annotation.numberOfAnnotationFields,n>Ha&&(Ha=n);for(D in a.annotation)for(g in a.annotation[D])-1===$.inArray(g,Ka)&&Ka.push(g),"gender"===g&&(Ia=!0),i=parseFloat(a.annotation[D][g]),isNaN(i)?Ja.hasOwnProperty(g)||(Ja[g]=0):Ja.hasOwnProperty(g)?i>Ja[g]&&(Ja[g]=i):Ja[g]=i;Ha++;var La=0,Ma=[];if("no_data"!==a.slide){n=+a.slide.numberOfSlideFields,n>La&&(La=n);for(D in a.slide)if("numberOfSlideFields"!==D){for(q in a.slide[D])Ma.push(q);break}}Ha+=La,"BRCA breast invasive carcinoma"===c&&Ha++;var Na=0;for(D in a.expressionData)expr=+a.expressionData[D],expr>Na&&(Na=expr);if(0!==a.copyNumberData.length){var Oa=0;for(D in a.copyNumberData)cn=a.copyNumberData[D],isNaN(cn)||(cn=Math.abs(+cn),cn>Oa&&(Oa=cn))}var Pa=sortData(a,e),Qa=[],Ra=[],Sa=[],Ta=[],Ua=[],Va=[];for(D in a.methylationData){for(y in a.methylationData[D])Va.push(y);break}var Wa={};for(y in Va)Wa[Va[y]]=[];var Xa=[];for(C in Pa)if(D=Pa[C],a.methylationData[D]){Xa.push(D),Qa[D]=a.methylationData[D];for(y in Va)Wa[Va[y]].push(a.methylationData[D][Va[y]]);w=D.replace(/_\d\d$/,""),a.annotation[w]?Ta[w]=a.annotation[w]:Ta[w]="no_annotation",a.slide[D]?Ua[D]=a.slide[D]:Ua[D]="no_data",r=a.expressionData[D],Ra[D]=r,0==a.copyNumberData.length?Sa="no_data":a.copyNumberData[D]?Sa[D]=a.copyNumberData[D]:Sa[D]="no_data"}var Ya=calculateStats(a,Ma,Xa,Ka,Ta,Ra,Qa,Sa,Va,Ua),Za=[],$a=[];for(o in Ya[e])p=Ya[e][o],p.rp&&"failed"!==p.rp?(Za.push(p.rp),$a.push(o)):p.p&&"failed"!==p.p&&(Za.push(p.p),$a.push(o));var _a=pAdjust(Za,"bh");for(u=0;u<_a.length;u++){var ab=_a[u];ab=+ab.toPrecision(3);var bb=1e3*ab;1>bb&&(ab=ab.toExponential()),p=$a[u],Ya[e][p].rp?Ya[e][p].rp=ab:Ya[e][p].p&&(Ya[e][p].p=ab)}Hb=0;var cb;for(cb in Fa)Fa.hasOwnProperty(cb)&&Hb++;Fb=0;for(cb in Ga)Ga.hasOwnProperty(cb)&&Fb++;var db=8+4*Hb;Fb>0&&(db+=5);var eb=Math.abs(Ca-Da),fb=148,gb=[];if("no_annotation"!==a.annotation)for(C in Xa)D=Xa[C],k=D.replace(/^.+_(\d\d)$/,"$1"),-1===$.inArray(k,gb)&&gb.push(k);gb.length>7&&(fb=148+18*gb.length);var hb=10+Na/20*N*3+10+(O+1)*Ha+20+fb;"no_data"!==Sa&&(hb=10+Na/20*N*3+10+Oa/3*N*3+20+(O+1)*Ha+20+fb);var ib,jb=170+db,kb=110,lb={top:hb,left:jb,bottom:40,right:kb},mb=M-jb-kb,nb=600;Ia&&(nb=750),nb>mb&&(mb=nb),ib=10>Aa?10*N:eb>1e5&&40>Aa?40*N:Aa*N;var ob=Math.floor(mb/d);1>ob?ob=1:ob>6&&(ob=6),mb=ob*d;var pb=d3.scale.linear().range([0,mb]),qb=d3.scale.linear().range([ib,0]),rb=(d3.svg.axis().scale(pb).orient("top"),d3.svg.line().defined(function(a){return null!==a}).x(function(a,b){return pb(b)+ob/2}).y(function(a){return a}));$(".plotWindow").removeClass("hidden");var sb=d3.select(".plotWindow").append("svg").attr("width",mb+lb.left+lb.right).attr("height",ib+lb.top+lb.bottom).attr("text-rendering","geometricPrecision").attr("font-family","arial").attr("font-size","12px").attr("fill","#666").append("g").attr("transform","translate("+lb.left+","+lb.top+")");pb.domain([0,d]),qb.domain([0,Aa]);var tb=1e3;eb/10>1e3&&(tb=eb/10),tb>5e3&&(tb=5e3);var ub,vb,wb=Ca-tb,xb=Da+tb,yb=(xb-wb)/Aa,zb=(Ca-wb)/yb,Ab=(Da-wb)/yb;if("1"===Ea?(ub=Ca-1e3,vb=Ca+500):(ub=Da-500,vb=Da+1e3),0===a.copyNumberData.length)var Bb=!1;else Bb=!0;drawLegend(a,sb,jb,hb,U,W,V,ba,ga,Bb,ea,la,aa,Ia,na,pa,T,c,xa,gb,ya,za);var Cb,Db;for(D in a.methylationData){Db=0;for(y in a.methylationData[D]){Db++,Cb="",y>=ub&&vb>=y&&(Cb="prom");var Eb=(y-wb)/yb;sb.append("line").attr("x1",-jb).attr("x2",-jb+db+80).attr("y1",ib-qb(Eb)).attr("y2",ib-qb(Eb)).attr("stroke",Z).attr("stroke-opacity",.5).attr("stroke-width",1).attr("class",Cb).attr("id","annotationLine"+y),sb.append("line").attr("x1",-jb+db+80).attr("x2",pb(1)).attr("y1",ib-qb(Eb)).attr("y2",ib-qb(Db-1)+N/2).attr("stroke",Z).attr("stroke-opacity",.5).attr("stroke-width",1).attr("class",Cb)}break}sb.append("rect").attr("fill",U).attr("x",-jb+7).attr("y",ib-qb(zb)).attr("width",P).attr("height",qb(Aa-(Ab-zb))),"1"===Ea?(sb.append("line").attr("x1",-jb+4).attr("x2",-jb+9).attr("y1",qb(Aa-(Ab-zb))+ib-qb(zb)-7).attr("y2",qb(Aa-(Ab-zb))+ib-qb(zb)).style("stroke",U).attr("stroke-width",P-1).attr("stroke-linecap","round"),sb.append("line").attr("x1",-jb+9).attr("x2",-jb+14).attr("y1",qb(Aa-(Ab-zb))+ib-qb(zb)).attr("y2",qb(Aa-(Ab-zb))+ib-qb(zb)-7).style("stroke",U).attr("stroke-width",P-1).attr("stroke-linecap","round")):(sb.append("line").attr("x1",-jb+4).attr("x2",-jb+9).attr("y1",ib-qb(zb)+7).attr("y2",ib-qb(zb)).style("stroke",U).attr("stroke-width",P-1).attr("stroke-linecap","round"),sb.append("line").attr("x1",-jb+9).attr("x2",-jb+14).attr("y1",ib-qb(zb)).attr("y2",ib-qb(zb)+7).style("stroke",U).attr("stroke-width",P-1).attr("stroke-linecap","round"));var Fb=0;for(var Gb in Ga)Fb++,cStart=Ga[Gb].start,cEnd=Ga[Gb].end,cStart<wb&&(cStart=wb),cEnd>xb&&(cEnd=xb),cStartPlot=(cStart-wb)/yb,cEndPlot=(cEnd-wb)/yb,sb.append("rect").attr("fill",V).attr("x",-jb+18).attr("y",ib-qb(cStartPlot)).attr("width",Q).attr("height",qb(Aa-(cEndPlot-cStartPlot)));var Hb=0;for(var Ib in Fa){Hb++;var Jb=+Fa[Ib].start,Kb=+Fa[Ib].end,Lb=(Jb-wb)/yb,Mb=(Kb-wb)/yb;sb.append("rect").attr("fill",W).attr("x",-jb+22+6*Hb).attr("y",ib-qb(Lb)).attr("width",R).attr("height",qb(Aa-(Mb-Lb))).html("<title>"+Ib+"</title");var Nb=a.transcripts[Ib].exons;for(o in Nb){var Ob=+Nb[o].start,Pb=+Nb[o].end;eStartPlot=(Ob-wb)/yb,eEndPlot=(Pb-wb)/yb,sb.append("rect").attr("fill",X).attr("x",-jb+22+6*Hb).attr("y",ib-qb(eStartPlot)).attr("width",R).attr("height",qb(Aa-(eEndPlot-eStartPlot)))}}var Qb=Math.round(Math.log(eb)/Math.log(10)),Rb=Math.pow(10,Qb-1);1e3>Rb&&5e3>eb&&(Rb=1e3);var Sb,Tb;"1"===Ea?(Sb=Ca-Rb/2,Tb=Ca+Rb/2):(Sb=Da-Rb/2,Tb=Da+Rb/2);var Ub=(Sb-wb)/yb,Vb=(Tb-wb)/yb;sb.append("rect").attr("fill",Y).attr("x",-jb+2).attr("y",ib-qb(Ub)).attr("width",2).attr("id","scaleBar").attr("height",qb(Aa-(Vb-Ub)));var Wb=Rb/1e3;Wb+="kb";var Xb;if(Xb="1"==Ea?qb(Ub)+2:qb(Vb)-10,sb.append("text").attr("x",-jb+1).attr("y",ib-Xb).attr("font-size","9px").attr("fill",Y).text(Wb),"no_data"!==Sa){var Yb=[];for(C in Xa){D=Xa[C];var Zb=Sa[D];isNaN(Zb)?Yb.push(null):Yb.push(ib-qb(0)-Na/20*N*3-10-Zb/2*N*3-20)}var $b=0;100>d?$b=2:200>d&&($b=1);var _b=d3.svg.area().defined(function(a){return a}).x(function(a,b){return pb(b)+$b}).y1(function(a){return a}).y0(ib-qb(0)-Na/20*N*3-30);sb.append("path").attr("d",_b(Yb)).attr("fill",ea),sb.append("path").attr("d",rb(Yb)).style("stroke",fa).attr("stroke-width",1).attr("fill","none"),sb.append("text").attr("x",-4).attr("y",ib-qb(0)-Na/20*N*3-10-Oa/2*N-10).attr("text-anchor","end").attr("font-size","12px").attr("fill","#aaa").text("copy number")}var ac=[];for(C in Xa)D=Xa[C],r=Ra[D],ac.push(ib-qb(0)-r/20*N*3-10);var $b=0;100>d?$b=2:200>d&&($b=1);var bc=d3.svg.area().defined(function(a){return a}).x(function(a,b){return pb(b)+$b}).y1(function(a){return a}).y0(ib-qb(0)-10);sb.append("path").attr("d",bc(ac)).attr("fill",ba),sb.append("line").attr("x1",pb(1)).attr("x2",pb(d)).attr("y1",ib-qb(0)-Na/20*N*3-10).attr("y2",ib-qb(0)-Na/20*N*3-10).style("stroke",da).attr("stroke-width",1).attr("shape-rendering","crispEdges").attr("stroke-dasharray","5,5"),sb.append("path").attr("d",rb(ac)).style("stroke",ca).attr("stroke-width",1).attr("fill","none"),sb.append("text").attr("x",-4).attr("y",ib-qb(0)-10-Na/20*N).attr("class","clickable").attr("id","expressionData").attr("text-anchor","end").attr("font-size","12px").attr("fill","#aaa").text("expression").on("mouseup",function(){"expressionData"!==e&&updatePlot(a,b,c,d,"expressionData")});var cc=0;for(y in Wa){cc++;var dc=Wa[y],ec=[];for(C in dc){var fc=dc[C];if(isNaN(fc))ec.push(null);else{var gc=ib-qb(cc-1)+(1-fc)*N;ec.push(gc)}}if(Cb="",y>=ub&&vb>=y&&(Cb="prom"),ec.some(function(a){return null!==a})){var hc=d3.svg.area().defined(function(a){return a}).x(function(a,b){return pb(b)+$b}).y1(function(a){return a}).y0(ib-qb(cc-1)+N);sb.append("path").attr("d",hc(ec)).attr("class",Cb).attr("fill",ga),sb.append("path").attr("d",rb(ec)).attr("stroke",ha).attr("class",Cb+" line").attr("stroke-width",1).attr("fill","none")}else sb.append("text").attr("x",4).attr("y",ib-qb(cc-1)+.75*N).attr("text-anchor","start").attr("font-size","9px").attr("class",Cb).attr("fill",ka).text("no data")}var ic=[];for(C in Xa)if(D=Xa[C],Db=0,Qa[D]){for(y in Qa[D]){Db++,ic.push(y);var jc=a.probeIds[y];sb.append("rect").attr("fill","#fff").attr("fill-opacity",0).attr("x",pb(0)).attr("y",ib-qb(Db-1)).attr("width",ob*d).attr("height",N).attr("id",y+"_"+jc+"_"+Db).attr("class","clickable").on("mouseover",function(){var a=$(this).attr("id"),b=a.replace(/_.+$/,""),c=a.replace(/^.+?_/,"");c=c.replace(/_.+$/,"");var d=(b-wb)/yb;sb.append("text").attr("x",-74).attr("y",ib-qb(d)-6).attr("text-anchor","end").attr("class","probeId").attr("font-size","11px").attr("stroke","#fff").attr("stroke-width",4).text(c),sb.append("text").attr("x",-74).attr("y",ib-qb(d)-6).attr("text-anchor","end").attr("class","probeId").attr("font-size","11px").attr("fill",ha).text(c),sb.append("line").attr("x1",-jb).attr("x2",-jb+db+80).attr("y1",ib-qb(d)).attr("y2",ib-qb(d)).style("stroke",ha).attr("stroke-width",2).attr("class","focusLine")}).on("mouseout",function(){$(".focusLine").remove(),$(".probeId").remove()}).on("mouseup",function(){var b=$(this).attr("id"),c=$(".probeIdClicked").attr("id");if($(".focusLineClicked").remove(),$(".probeIdClicked").remove(),$(".probeInfo").remove(),c!==b){var d=a.geneInfo.chr,e=b.replace(/_.+$/,""),f=b.replace(/^.+?_/,"");f=f.replace(/_.+$/,"");var g=b.replace(/^.+_/,""),h=(e-wb)/yb;sb.append("text").attr("x",-74).attr("y",ib-qb(h)-6).attr("text-anchor","end").attr("class","probeIdClicked containsProbeId").attr("id",b).attr("font-size","11px").attr("stroke","#fff").attr("stroke-width",4).text(f),sb.append("text").attr("x",-74).attr("y",ib-qb(h)-6).attr("text-anchor","end").attr("class","probeIdClicked clickable").attr("font-size","11px").attr("fill",ha).text(f).on("mouseup",function(){var b=a.probeAnnotation[e];b=b.replace(/-/g," ± ");var c=140;b.length>20&&(c=180),sb.append("rect").attr("x",-142).attr("y",ib-qb(h)-24).attr("width",c).attr("height",66).attr("fill","#fff").attr("stroke",ha).attr("stroke-width",2).attr("class","probeInfo clickable").on("mouseup",function(){$(".probeInfo").remove()}),sb.append("text").attr("x",-136).attr("y",ib-qb(h)-6).attr("class","probeInfo").attr("font-weight","bold").text(f),sb.append("text").attr("x",-136).attr("y",ib-qb(h)+14).attr("class","probeInfo").text("chr"+d+":"+e),sb.append("text").attr("x",-136).attr("y",ib-qb(h)+30).attr("class","probeInfo").text(b),sb.append("text").attr("x",-142+c-20).attr("y",ib-qb(h)-4).attr("class","probeInfo clickable").attr("font-size","18px").attr("font-weight","bold").attr("fill",ha).text("×").on("mouseup",function(){$(".probeInfo").remove()})}),sb.append("line").attr("x1",-jb).attr("x2",-jb+db+80).attr("y1",ib-qb(h)).attr("y2",ib-qb(h)).style("stroke",ha).attr("stroke-width",2).attr("class","focusLineClicked"),sb.append("line").attr("x1",-jb+db+80).attr("x2",pb(1)).attr("y1",ib-qb(h)).attr("y2",ib-qb(g-1)+N/2).style("stroke",ha).attr("stroke-width",2).attr("class","focusLineClicked")}})}break}if(Db=0,"expressionData"===e)for(y in ic)Db++,J=Ya[e][ic[y]],J.r&&(z=J.r,"failed"!==z&&(v=parseFloat(J.rp),B=formatCorrelation(z,v),l="#aaa",m="normal",.05>v&&(l="#666",m="bold"),sb.append("text").attr("x",pb(d)+4*ob).attr("y",ib-qb(Db-1)+N-4).attr("font-size",S).attr("font-weight",m).attr("font-family",T).attr("fill",l).text(B)));else for(y in ic)Db++,J=Ya[e][ic[y]],J.p||0===J.p?(v=J.p,"failed"!==v&&(F="#aaa",G="normal",x=parseFloat(v),.05>x&&(F="#666",G="bold"),v=x<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+v,sb.append("text").attr("x",pb(d)+4*ob).attr("y",ib-qb(Db-1)+N-4).attr("font-size",S).attr("font-weight",G).attr("font-family",T).attr("fill",F).text(v))):J.r&&(z=J.r,"failed"!==z&&(v=parseFloat(J.rp),B=formatCorrelation(z,v),l="#aaa",m="normal",.05>v&&(l="#666",m="bold"),sb.append("text").attr("x",pb(d)+4*ob).attr("y",ib-qb(Db-1)+N-4).attr("font-size",S).attr("font-weight",m).attr("font-family",T).attr("fill",l).text(B)));if(0!==a.copyNumberData.length){var gc=ib-qb(0)-Na/20*N*3-10-Oa/2*N-10;"expressionData"===e?(J=Ya[e]["copy number"],J.r&&(z=J.r,"failed"!==z&&(v=parseFloat(J.rp),B=formatCorrelation(z,v),l="#aaa",m="normal",.05>v&&(l="#666",m="bold"),sb.append("text").attr("x",pb(d)+4*ob).attr("y",gc).attr("font-size",S).attr("font-weight",m).attr("font-family",T).attr("fill",l).text(B)))):(J=Ya[e]["copy number"],J.p||0===J.p?(v=J.p,"failed"!==v&&(F="#aaa",G="normal",x=parseFloat(v),.05>x&&(F="#666",G="bold"),v=x<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+v,sb.append("text").attr("x",pb(d)+4*ob).attr("y",gc).attr("font-size",S).attr("font-weight",G).attr("font-family",T).attr("fill",F).text(v))):J.r&&(z=J.r,"failed"!==z&&(v=parseFloat(J.rp),B=formatCorrelation(z,v),l="#aaa",m="normal",.05>v&&(l="#666",m="bold"),sb.append("text").attr("x",pb(d)+4*ob).attr("y",gc).attr("font-size",S).attr("font-weight",m).attr("font-family",T).attr("fill",l).text(B))))}if("no_annotation"!==a.annotation){E=0;for(C in Xa){D=Xa[C],w=D.replace(/_\d\d$/,"");var kc;kc=E%2===0?la:ma,k=D.replace(/^.+_(\d\d)$/,"$1");var lc=(ya[k],za[k]);h=1;var gc=ib-qb(0)-10-Na/20*N*3-10-(O+1)*h;if(0!==a.copyNumberData.length&&(gc=ib-qb(0)-10-Na/20*N*3-10-Oa/3*N*3-20-(O+1)*h),sb.append("rect").attr("fill",lc).attr("x",pb(E)).attr("y",gc).attr("width",ob).attr("height",O),"BRCA breast invasive carcinoma"===c){h++;var mc;mc=D in a.pam50?a.pam50[D]:"no data";var nc=xa[mc],gc=ib-qb(0)-10-Na/20*N*3-10-(O+1)*h;0!==a.copyNumberData.length&&(gc=ib-qb(0)-10-Na/20*N*3-10-Oa/3*N*3-20-(O+1)*h),sb.append("rect").attr("fill",nc).attr("x",pb(E)).attr("y",gc).attr("width",ob).attr("height",O)}if("no_annotation"!==Ta[w])for(g in Ta[w]){i=Ta[w][g];var oc;"gender"===g&&(oc=1==i?E%2===0?na:oa:E%2===0?pa:qa);var pc;"eye_color"===g&&(pc=1==i?E%2===0?ra:sa:2==i?E%2===0?ta:ua:E%2===0?va:wa);var qc=Ja[g];h++;var gc=ib-qb(0)-10-Na/20*N*3-10-(O+1)*h;if(0!==a.copyNumberData.length&&(gc=ib-qb(0)-10-Na/20*N*3-10-Oa/3*N*3-20-(O+1)*h),null===i)sb.append("rect").attr("fill",aa).attr("x",pb(E)).attr("y",gc).attr("width",ob).attr("height",O);else if("gender"===g){A=O;var gc=ib-qb(0)-10-Na/20*N*3-10-(O+1)*h+(O-A);0!==a.copyNumberData.length&&(gc=ib-qb(0)-10-Na/20*N*3-10-Oa/3*N*3-20-(O+1)*h+(O-A)),sb.append("rect").attr("fill",oc).attr("x",pb(E)).attr("y",gc).attr("width",ob).attr("height",A)}else if("eye_color"===g){A=O;var gc=ib-qb(0)-10-Na/20*N*3-10-(O+1)*h+(O-A);0!==a.copyNumberData.length&&(gc=ib-qb(0)-10-Na/20*N*3-10-Oa/3*N*3-20-(O+1)*h+(O-A)),sb.append("rect").attr("fill",pc).attr("x",pb(E)).attr("y",gc).attr("width",ob).attr("height",A)}else{A=O/qc*i;var gc=ib-qb(0)-10-Na/20*N*3-10-(O+1)*h+(O-A);0!==a.copyNumberData.length&&(gc=ib-qb(0)-10-Na/20*N*3-10-Oa/3*N*3-20-(O+1)*h+(O-A)),sb.append("rect").attr("fill",kc).attr("x",pb(E)).attr("y",gc).attr("width",ob).attr("height",A);
}}else{var gc=ib-qb(0)-10-Na/20*N*3-10-(O+1)*(Ha-La);0!==a.copyNumberData.length&&(gc=ib-qb(0)-10-Na/20*N*3-10-Oa/3*N*3-20-(O+1)*(Ha-La)),sb.append("rect").attr("fill",aa).attr("x",pb(E)).attr("y",gc).attr("width",ob).attr("height",(O+1)*(Ha-1-La)-1)}E++}if("expressionData"===e){if(h=0,J=Ya[e]["sample type"],(J.p||0===J.p)&&(v=J.p,"failed"!==v)){F="#aaa",G="normal",x=parseFloat(v),.05>x&&(F="#666",G="bold"),v=x<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+v;var gc=ib-qb(0)-10-Na/20*N*3-10-(O+1)*h-4;0!==a.copyNumberData.length&&(gc=ib-qb(0)-10-Na/20*N*3-10-Oa/3*N*3-20-(O+1)*h-4),sb.append("text").attr("x",pb(d)+4*ob).attr("y",gc).attr("font-size",S).attr("font-weight",G).attr("font-family",T).attr("fill",F).text(v)}"BRCA breast invasive carcinoma"===c&&h++;for(g in Ja)if(h++,J=Ya[e][g],J.p||0===J.p){if(v=J.p,"failed"!==v){F="#aaa",G="normal",x=parseFloat(v),.05>x&&(F="#666",G="bold"),v=x<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+v;var gc=ib-qb(0)-10-Na/20*N*3-10-(O+1)*h-4;0!==a.copyNumberData.length&&(gc=ib-qb(0)-10-Na/20*N*3-10-Oa/3*N*3-20-(O+1)*h-4),sb.append("text").attr("x",pb(d)+4*ob).attr("y",gc).attr("font-size",S).attr("font-weight",G).attr("font-family",T).attr("fill",F).text(v)}}else if(J.r&&(z=J.r,"failed"!==z)){v=parseFloat(J.rp),B=formatCorrelation(z,v),l="#aaa",m="normal",.05>v&&(l="#666",m="bold");var gc=ib-qb(0)-10-Na/20*N*3-10-(O+1)*h-4;0!==a.copyNumberData.length&&(gc=ib-qb(0)-10-Na/20*N*3-10-Oa/3*N*3-20-(O+1)*h-4),sb.append("text").attr("x",pb(d)+4*ob).attr("y",gc).attr("font-size",S).attr("font-weight",m).attr("font-family",T).attr("fill",l).text(B)}I=Ha-La;for(s in Ma){if(t=Ma[s],J=Ya.expressionData[t],J.r&&(z=J.r,"failed"!==z)){v=parseFloat(J.rp),B=formatCorrelation(z,v),l="#aaa",m="normal",.05>v&&(l="#666",m="bold");var gc=ib-qb(0)-10-Na/20*N*3-10-(O+1)*I-4;0!==a.copyNumberData.length&&(gc=ib-qb(0)-10-Na/20*N*3-10-Oa/3*N*3-20-(O+1)*I-4),sb.append("text").attr("x",pb(E)+4*ob).attr("y",gc).attr("class",t).attr("font-size",S).attr("font-weight",m).attr("font-family",T).attr("fill",l).text(B)}I++}}else if("sample type"===e){J=Ya[e].expressionData;var gc=ib-qb(0)-10-Na/20*N;J.n?(j=J.n,sb.append("text").attr("x",pb(d)+4*ob).attr("y",gc).attr("font-size",S).attr("font-family",T).attr("fill","#aaa").text(j)):(J.p||0===J.p)&&(v=J.p,"failed"!==v&&(F="#aaa",G="normal",x=parseFloat(v),.05>x&&(F="#666",G="bold"),v=x<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+v,sb.append("text").attr("x",pb(d)+4*ob).attr("y",gc).attr("font-size",S).attr("font-weight",G).attr("font-family",T).attr("fill",F).text(v))),Db=0;for(y in ic)Db++,J=Ya[e][ic[y]],(J.p||0===J.p)&&(v=J.p,"failed"!==v&&(F="#aaa",G="normal",x=parseFloat(v),.05>x&&(F="#666",G="bold"),v=x<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+v,sb.append("text").attr("x",pb(d)+4*ob).attr("y",ib-qb(Db-1)+N-4).attr("font-size",S).attr("font-weight",G).attr("font-family",T).attr("fill",F).text(v)))}else{J=Ya[e].expressionData;var gc=ib-qb(0)-10-Na/20*N;J.p||0===J.p?(v=J.p,"failed"!==v&&(F="#aaa",G="normal",x=parseFloat(v),.05>x&&(F="#666",G="bold"),v=x<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+v,sb.append("text").attr("x",pb(d)+4*ob).attr("y",gc).attr("font-size",S).attr("font-weight",G).attr("font-family",T).attr("fill",F).text(v))):J.r&&(z=J.r,"failed"!==z&&(v=parseFloat(J.rp),B=formatCorrelation(z,v),l="#aaa",m="normal",.05>v&&(l="#666",m="bold"),sb.append("text").attr("x",pb(d)+4*ob).attr("y",gc).attr("font-size",S).attr("font-weight",m).attr("font-family",T).attr("fill",l).text(B)))}h=0;var gc=ib-qb(0)-10-Na/20*N*3-10-(N+1)*h-4;if(0!==a.copyNumberData.length&&(gc=ib-qb(0)-10-Na/20*N*3-10-Oa/3*N*3-20-(N+1)*h-4),sb.append("text").attr("x",-4).attr("y",gc).attr("class","clickable").attr("font-size","12px").attr("fill","#aaa").attr("id","sample type").attr("text-anchor","end").text("sample type").on("mouseup",function(){var f=$(this).text();f=f.replace(/\u2192 /,""),f!==e&&updatePlot(a,b,c,d,f)}),"BRCA breast invasive carcinoma"===c){h++;var gc=ib-qb(0)-10-Na/20*N*3-10-(N+1)*h;0!==a.copyNumberData.length&&(gc=ib-qb(0)-10-Na/20*N*3-10-Oa/3*N*3-20-(N+1)*h),sb.append("text").attr("x",-4).attr("y",gc).attr("class","clickable").attr("font-size","12px").attr("fill","#aaa").attr("id","PAM50 subtype").attr("text-anchor","end").text("PAM50 subtype").on("mouseup",function(){var f=$(this).text();f=f.replace(/\u2192 /,""),f!==e&&updatePlot(a,b,c,d,f)})}for(g in Ja){h++,g=g.replace(/_/g," ");var gc=ib-qb(0)-10-Na/20*N*3-10-(O+1)*h-4;if(0!==a.copyNumberData.length&&(gc=ib-qb(0)-10-Na/20*N*3-10-Oa/3*N*3-20-(O+1)*h-4),sb.append("text").attr("x",-4).attr("y",gc).attr("class","clickable").attr("font-size","12px").attr("fill","#aaa").attr("id",g.replace(/ /g,"_")).attr("text-anchor","end").text(g).on("mouseup",function(){var f=$(this).text();f=f.replace(/ /g,"_"),f=f.replace(/\u2192_/,""),f!==e&&updatePlot(a,b,c,d,f)}),f=g.replace(/ /g,"_"),f!==e&&"expressionData"!==e){J=Ya[e][f];var gc=ib-qb(0)-10-Na/20*N*3-10-(O+1)*h-4;0!==a.copyNumberData.length&&(gc=ib-qb(0)-10-Na/20*N*3-10-Oa/3*N*3-20-(O+1)*h-4),J.p||0===J.p?(v=J.p,"failed"!==v&&(F="#aaa",G="normal",x=parseFloat(v),.05>x&&(F="#666",G="bold"),v=x<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+v,sb.append("text").attr("x",pb(d)+4*ob).attr("y",gc).attr("font-size",S).attr("font-weight",G).attr("font-family",T).attr("fill",F).text(v))):J.r&&(z=J.r,"failed"!==z&&(v=parseFloat(J.rp),B=formatCorrelation(z,v),l="#aaa",m="normal",.05>v&&(l="#666",m="bold"),sb.append("text").attr("x",pb(d)+4*ob).attr("y",gc).attr("font-size",S).attr("font-weight",m).attr("font-family",T).attr("fill",l).text(B)))}}}if("no_data"!==a.slide){E=0;a.slide.numberOfSlideFields;Ma=[];for(C in Xa)if(D=Xa[C],"no_data"!==Ua[D]){for(H in Ua[D])-1===$.inArray(H,Ma)&&Ma.push(H);break}for(C in Xa){if(D=Xa[C],"no_data"!==Ua[D]){var rc;rc=E%2===0?la:ma,I=Ha-La;for(H in Ua[D])if(I++,slideFieldValue=Ua[D][H],"undefined"!=typeof Ua[D][H]){A=O/100*slideFieldValue;var gc=ib-qb(0)-10-Na/20*N*3-10-(O+1)*I+(O-A);0!==a.copyNumberData.length&&(gc=ib-qb(0)-10-Na/20*N*3-10-Oa/3*N*3-20-(O+1)*I+(O-A)),sb.append("rect").attr("fill",rc).attr("x",pb(E)).attr("y",gc).attr("width",ob).attr("height",A).attr("class",H)}}else{I=Ha-La;for(s in Ma){I++;var gc=ib-qb(0)-10-Na/20*N*3-10-(O+1)*I-1;0!==a.copyNumberData.length&&(gc=ib-qb(0)-10-Na/20*N*3-10-Oa/3*N*3-20-(O+1)*I-1),sb.append("rect").attr("fill",aa).attr("x",pb(E)).attr("y",gc).attr("width",ob).attr("height",O+1).attr("class",Ma[s])}}E++}I=Ha-La;for(s in Ma){t=Ma[s],g=t.replace(/_/g," ");var gc=ib-qb(0)-10-Na/20*N*3-10-(O+1)*I-4;0!==a.copyNumberData.length&&(gc=ib-qb(0)-10-Na/20*N*3-10-Oa/3*N*3-20-(O+1)*I-4),sb.append("text").attr("x",-4).attr("y",gc).attr("class",t+" clickable").attr("font-size","12px").attr("fill","#aaa").attr("id",t).attr("text-anchor","end").text(g).on("mouseup",function(){var f=$(this).text();f=f.replace(/ /g,"_"),f=f.replace(/\u2192_/,""),f!==e&&updatePlot(a,b,c,d,f)})}I=Ha-La;for(s in Ma){if(t=Ma[s],t!==e&&"expressionData"!==e){J=Ya[e][t];var gc=ib-qb(0)-10-Na/20*N*3-10-(O+1)*I-4;0!==a.copyNumberData.length&&(gc=ib-qb(0)-10-Na/20*N*3-10-Oa/3*N*3-20-(O+1)*I-4),J.r?(z=J.r,"failed"!==z&&(v=parseFloat(J.rp),B=formatCorrelation(z,v),l="#aaa",m="normal",.05>v&&(l="#666",m="bold"),sb.append("text").attr("x",pb(E)+4*ob).attr("y",gc).attr("class",t).attr("font-size",S).attr("font-weight",m).attr("font-family",T).attr("fill",l).text(B))):(J.p||0===J.p)&&(v=J.p,"failed"!==v&&(F="#aaa",G="normal",x=parseFloat(v),.05>x&&(F="#666",G="bold"),v=x<10*Math.pow(10,-16)?"p < 2.2e-16":"p = "+v,sb.append("text").attr("x",pb(d)+4*ob).attr("y",gc).attr("class",t).attr("font-size",S).attr("font-weight",G).attr("font-family",T).attr("fill",F).text(v)))}I++}}document.getElementById(e).setAttribute("font-weight","bold"),document.getElementById(e).setAttribute("font-size","13px"),document.getElementById(e).setAttribute("fill","rgb(100,100,100)");var sc=e.replace(/_/g," ");sc=sc.replace(/Data/,"");var tc=document.getElementById(e).firstChild;tc.nodeValue="► "+sc;var gc=ib-qb(0)-10-Na/20*N*3-10-(O+1)*Ha-14;0!==a.copyNumberData.length&&(gc=ib-qb(0)-10-Na/20*N*3-10-Oa/3*N*3-20-(O+1)*Ha-14),sb.append("text").attr("x",mb+kb-12).attr("y",gc).attr("font-size",S).attr("font-family",T).attr("text-anchor","end").attr("fill","#aaa").text("comparison to: "+sc),sb.append("line").attr("x1",mb+kb-12).attr("x2",mb+kb-12-6.6*sc.length).attr("y1",gc+4).attr("y2",gc+4).style("stroke","#aaa").attr("stroke-width",1).attr("shape-rendering","crispEdges");var uc=a.geneInfo.ensembl,vc=a.geneInfo.hgnc,wc=a.geneInfo.chr,xc=a.geneInfo.start;xc=xc.toString();for(var yc="";xc.length>=3;)yc=xc.substring(xc.length-3)+","+yc,xc=xc.substring(0,xc.length-3);yc=xc+","+yc,yc=yc.replace(/,$/,""),yc=yc.replace(/^,/,"");var zc=a.geneInfo.end;zc=zc.toString();for(var Ac="";zc.length>=3;)Ac=zc.substring(zc.length-3)+","+Ac,zc=zc.substring(0,zc.length-3);Ac=zc+","+Ac,Ac=Ac.replace(/,$/,""),Ac=Ac.replace(/^,/,"");var Bc="chr"+wc+":"+yc+"-"+Ac;""===vc?$(".plotInfo").html("<p><strong>"+uc+'</strong> <a href="http://genome.ucsc.edu/cgi-bin/hgTracks?db=hg19&position='+Bc+'" target="_blank" title="This link will take you to the UCSC Genome Browser">'+Bc+"</a></p>"):$(".plotInfo").html('<p><strong><a href="http://www.genecards.org/cgi-bin/carddisp.pl?gene='+vc+'" target="_blank" title="This link will take you to the GeneCards.org page for '+vc+'.">'+vc+'</a></strong> <span class="ensembl">'+uc+'</span> <a href="http://genome.ucsc.edu/cgi-bin/hgTracks?db=hg19&position='+Bc+'" target="_blank" title="This link will take you to the UCSC Genome Browser">'+Bc+"</a></p>"),$(".plotInfo").append('<div class="promoterSelectionButton noselect">highlight promoter probes</div>'),$(".promoterSelectionButton").on("click",function(){$(".prom").each(function(){var a,b=$(this);b.is("path")?b.attr("class").match(/line/)?(a=b.attr("stroke"),a===ha?b.attr("stroke",ja):b.attr("stroke",ha)):(a=b.attr("fill"),a===ga?b.attr("fill",ia):b.attr("fill",ga)):b.is("text")?(a=b.attr("fill"),a===ka?b.attr("fill",ja):b.attr("fill",ka)):b.is("line")&&(a=b.attr("stroke"),a===Z?b.attr("stroke",_):b.attr("stroke",Z))})}),prepareSvgForDownload(b,c,e)}function checkUserInput(){$("#userInputForm .inputButton").toggleClass("inactive"),removeMessages();var a=$("#gene").val();a=a.replace(/[<>\\\/;'"()=\[\]\{\}]/g,"");var b=$(".sampleSelectionList").find(".selectedSample").text();""===a?($("#userInputForm .inputButton").toggleClass("inactive"),$("#userInputForm .inputButton").click(!0),$("#gene").focus(),$('<div class="warningMessage">Don\'t forget to enter a gene name!</div>').hide().appendTo("#userInputForm").fadeIn(200)):""===b?($("#userInputForm .inputButton").toggleClass("inactive"),$("#userInputForm .inputButton").click(!0),$('<div class="warningMessage">Don\'t forget to select a source!</div>').hide().appendTo("#userInputForm").fadeIn(200)):""!==a&&""!==b&&plotPreparation()}function plotPreparation(){removeMessages();var a=$("#gene").val();a=a.replace(/[<>\\\/;'"()=\[\]\{\}]/g,"");var b=$(".sampleSelectionList").find(".selectedSample").find(".sourceName").text(),c=$(".sampleSelectionList").find(".selectedSample").find(".fullSourceName").attr("title"),d=b+" "+c;$(".downloadButton").remove(),$(".loadingAnimation").show(),$(".plotContainer").css("background","#fff"),$(".plotContainer").css("border","none"),$(".plotWindow").toggleClass("transparent"),$(".plotInfo").toggleClass("transparent"),$("svg").length&&($(".plotInfo").empty(),$(".plotWindow").empty());$.ajax({type:"POST",url:"php/numberOfSamples.php?source="+d,dataType:"json",success:function(b){var c=b.nrow;$('<div class="infoMessage">'+c+" samples selected</div>").hide().appendTo("#userInputForm").fadeIn(500),createNewPlot(a,d,c)},error:function(){$('<div class="errorMessage">Database error.<br>(could not retrieve the number of samples)</div>').hide().appendTo("#userInputForm").fadeIn(500),$(".plotWindow").toggleClass("hidden"),$("#userInputForm .inputButton").toggleClass("inactive"),$(".loadingAnimation").hide(),$(".plotContainer").css("background","#f6f6f6"),$(".plotContainer").css("border","4px solid #efefef")}})}function createNewPlot(a,b,c){d3.json("php/geneNameQuery.php?gene="+a+"&source="+b,function(d,e){var f=e,g=f.success;if(g){var h="expressionData";createPlot(f,a,b,c,h)}else{var i=f.message;$('<div class="errorMessage">'+i+"</div>").hide().appendTo("#userInputForm").fadeIn(200),$(".plotWindow").toggleClass("hidden"),$(".plotContainer").css("background","#f6f6f6"),$(".plotContainer").css("border-bottom","4px solid #efefef;")}$(".loadingAnimation").hide(),$(".plotWindow").toggleClass("transparent"),$(".plotInfo").toggleClass("transparent"),$("#userInputForm .inputButton").toggleClass("inactive"),$("#extraSelectionForm .inputButton").toggleClass("inactive")})}$(function(){$(window).scroll(function(){$("header").css({left:$(this).scrollLeft()})}),$("input[type=text]").focus(),windowWidth=$(window).width(),inputWidth=$(".userInput").outerWidth(),plotWidth=windowWidth-inputWidth-28,$(".plotContainer").width(plotWidth);var a,b;$(function(){a={serviceUrl:"php/autocomplete.php",minChars:1,maxHeight:200,deferResquestBy:0},b=$("#gene").autocomplete(a)}),$(".sampleSelectionElement").on("click",function(){var a=$(this);$(".sampleSelectionElement").each(function(){$(this).hasClass("selectedSample")&&$(this).toggleClass("selectedSample")}),a.toggleClass("selectedSample")})});